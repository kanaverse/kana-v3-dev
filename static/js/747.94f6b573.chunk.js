!function(){"use strict";var e={9747:function(e,n,t){var r,o=t(3324),s=t(7762),a=t(4165),c=t(5861),u=t(2754),i=t(5831),l=t(5137),f=null;function p(e){return d.apply(this,arguments)}function d(){return d=(0,c.Z)((0,a.Z)().mark((function e(n){var t,o,s,c,u,i,l,p,d,m,h,y,v=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.length>1&&void 0!==v[1]?v[1]:null,o=v.length>2&&void 0!==v[2]&&v[2],e.next=4,f;case 4:if(o){e.next=13;break}return s=r.result.transaction(["downloads"],"readonly"),c=s.objectStore("downloads"),u=new Promise((function(e){var t=c.get(n);t.onsuccess=function(n){void 0!==t.result?e(t.result.payload):e(null)},t.onerror=function(n){e(null)}})),e.next=10,u;case 10:if(null===(i=e.sent)){e.next=13;break}return e.abrupt("return",i);case 13:return l=null==t?fetch(n):fetch(n,t),e.next=16,l;case 16:if((p=e.sent).ok){e.next=19;break}throw"failed to download '"+n+"' ("+p.status+")";case 19:return e.next=21,p.arrayBuffer();case 21:return d=e.sent,m=r.result.transaction(["downloads"],"readwrite"),h=m.objectStore("downloads"),y=new Promise((function(e){var t=h.put({url:n,payload:d});t.onsuccess=function(n){e(!0)},t.onerror=function(n){e(!1)}})),e.next=27,y;case 27:if(e.sent){e.next=30;break}throw"failed to download resources for '"+n+"'";case 30:return e.abrupt("return",d);case 31:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}t(7462);function m(e,n){if(e)if(Array.isArray(e)){var t,r=(0,s.Z)(e);try{for(r.s();!(t=r.n()).done;){m(t.value,n)}}catch(i){r.e(i)}finally{r.f()}}else if(e.constructor==Object)for(var a=0,c=Object.entries(e);a<c.length;a++){var u=(0,o.Z)(c[a],2);u[0];m(u[1],n)}else if(ArrayBuffer.isView(e)){if(!(e.buffer instanceof ArrayBuffer))throw"only ArrayBuffers should be in the message payload";n.push(e.buffer)}}function h(e){postMessage({type:"".concat(e,"_START")})}function y(e,n){if("undefined"==typeof n)postMessage({type:"".concat(e,"_CACHE")});else{var t=[];m(n,t),postMessage({type:"".concat(e,"_DATA"),resp:n},t)}}function v(e,n,t){postMessage({type:"".concat(e,"_ERROR"),resp:{reason:n.toString(),fatal:t}})}t(3841);var g="K@\ud835\udf02a#$c3ll";t(6886);var w="https://cors-proxy.aaron-lun.workers.dev";function b(e){return S.apply(this,arguments)}function S(){return(S=(0,c.Z)((0,a.Z)().mark((function e(n){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(w+"/"+encodeURIComponent(n));case 2:return t=e.sent,e.abrupt("return",new Uint8Array(t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}u.ES.setDownload(b),u.ii.setDownload(b),u.E4.setDownload(b),l.ao(function(){var e=(0,c.Z)((0,a.Z)().mark((function e(n,t,r){var o,s,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=l.XZ()+"/"+n,s=w+"/"+encodeURIComponent(o),null!=t||null!=r){e.next=9;break}return e.next=5,p(s);case 5:return c=e.sent,e.abrupt("return",new Response(c));case 9:return e.abrupt("return",fetch(s+"?start="+String(t)+"&end="+String(r)));case 10:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}()),l.d9(function(){var e=(0,c.Z)((0,a.Z)().mark((function e(n){var t,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.Kk()+"/"+n,e.next=3,p(w+"/"+encodeURIComponent(t));case 3:return r=e.sent,e.abrupt("return",new Response(r));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());"".concat(g,"::CLUSTERS");var x="".concat(g,"::SELECTION"),_={},O={},E=null,k={},R=null,Z=null;function M(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("H5AD"==e.format)return new u.nN(e.h5,n?e.options:{});if("SummarizedExperiment"==e.format)return new u.CM(e.rds,n?e.options:{});throw new Error("unknown format '"+e.format+"'")}function C(e,n){var t,r={},a=(0,s.Z)(e.cells.columnNames());try{for(a.s();!(t=a.n()).done;){var c=t.value;r[c]=u.Qr(e.cells.column(c))}}catch(_){a.e(_)}finally{a.f()}var i={cells:{columns:r,numberOfCells:e.cells.numberOfRows()}};if("SummarizedExperiment"===n.format){if(i.modality_features={},"modality_features"in e)for(var l=0,f=Object.entries(e.modality_features);l<f.length;l++){var p,d=(0,o.Z)(f[l],2),m=d[0],h=d[1],y={},v=(0,s.Z)(h.columnNames());try{for(v.s();!(p=v.n()).done;){var g=p.value;Array.isArray(h.column(g))&&(y[g]=u.Qr(h.column(g)))}}catch(_){v.e(_)}finally{v.f()}i.modality_features[m]={columns:y,numberOfFeatures:h.numberOfRows()}}}else{i.all_features={};var w,b={},S=(0,s.Z)(e.all_features.columnNames());try{for(S.s();!(w=S.n()).done;){var x=w.value;b[x]=u.Qr(e.all_features.column(x))}}catch(_){S.e(_)}finally{S.f()}i.all_features={columns:b,numberOfFeatures:e.all_features.numberOfRows()}}return"H5AD"===n.format?i.all_assay_names=e.all_assay_names:"SummarizedExperiment"===n.format&&(i.modality_assay_names=e.modality_assay_names),i.reduced_dimension_names=e.reduced_dimension_names,i}function T(e,n){var t;return e in k||((t=new u.J6(F(),n.ids.slice())).computeAll(),k[e]=t),k[e]}var j,A=function(e){return E.cells.column(e)},F=function(){return E.matrix};onmessage=function(e){var n=e.data,t=n.type,l=n.payload;console.log("EXPLORE WORKER::RCV::",t,l);var p=!1;if("INIT"==t){p=!0;var d=Math.round(2*navigator.hardwareConcurrency/3),g=u.j2({numberOfThreads:d}),w=g.then((function(){return u.TN()}));w.then((function(e){e,postMessage({type:t,msg:"Success: analysis state created"})}));var b=(null===f&&(f=new Promise((function(e,n){(r=indexedDB.open("DownloadsDB",3)).onupgradeneeded=function(e){var n=e.target.result;try{n.deleteObjectStore("downloads")}catch(e){}n.createObjectStore("downloads",{keyPath:"url"})},r.onsuccess=function(){e(null)},r.onerror=function(){n("failed to initialize DownloadsDB")}}))),f);b.then((function(e){postMessage({type:"DownloadsDB_store",resp:e,msg:"Success: DownloadsDB initialized"})})).catch((function(e){console.error(e),postMessage({type:"DownloadsDB_ERROR",msg:"Error: Cannot initialize DownloadsDB"})})),(j=Promise.all([g,w,b])).then((function(){postMessage({type:t,msg:"Success: bakana initialized"})})).catch((function(e){console.error(e),v(t,e,p)}))}else"EXPLORE"==t?(p=!0,j.then(function(){var e=(0,c.Z)((0,a.Z)().mark((function e(n){var t,r,c,f,p,d,m,v,g,w,b,S,x,O,k,Z,C,T,j,A,F,P,N,D,I,U,V,G,B,z,L,J,Y,H,K;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.inputs,null!==(r=t.files)){for(c={},f=0,p=Object.entries(r);f<p.length;f++)d=(0,o.Z)(p[f],2),m=d[0],"uid"in(v=d[1])&&v.uid in _&&(_[v.uid].clear(),delete _[m]),c[m]=M(v,!0);for(g=0,w=Object.entries(c);g<w.length;g++){if(b=(0,o.Z)(w[g],2),S=b[0],x=b[1],E=x.load(),!r[S].options.normalized){O=(0,s.Z)(E.matrix.available());try{for(O.s();!(k=O.n()).done;)Z=k.value,C=E.matrix.get(Z),T=i.gk(C,{allowZeros:!0}),E.matrix.add(Z,T)}catch(n){O.e(n)}finally{O.f()}}for(h(j="inputs"),A={annotations:E.cells.columnNames(),genes:{},num_cells:E.cells.numberOfRows(),num_genes:{}},F=0,P=Object.entries(E.features);F<P.length;F++){N=(0,o.Z)(P[F],2),D=N[0],I=N[1],A.genes[D]={},A.num_genes[D]=I.numberOfRows(),U=(0,s.Z)(I.columnNames());try{for(U.s();!(V=U.n()).done;)G=V.value,A.genes[D][G]=I.column(G)}catch(n){U.e(n)}finally{U.f()}I.rowNames()&&(A.genes[D].rowNames=I.rowNames())}for(y(j,A),h(B="embedding"),z={},L=0,J=Object.entries(E.reduced_dimensions);L<J.length;L++)Y=(0,o.Z)(J[L],2),H=Y[0],K=Y[1],"pca"!==H.toLowerCase()&&(z[H]={x:K[0].slice(),y:K[1].slice()});y(B,z),R&&R.free(),R=new u.sF(E.matrix)}}case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),v(t,e,p)}))):"PREFLIGHT_INPUT"==t?j.then(function(){var e=(0,c.Z)((0,a.Z)().mark((function e(n){var t,r,s,c,u,i,f,p,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={},e.prev=1,r={},s={},c=0,u=Object.entries(l.inputs.files);case 5:if(!(c<u.length)){e.next=23;break}if(i=(0,o.Z)(u[c],2),f=i[0],!("uid"in(p=i[1]))){e.next=17;break}if(p.uid in _){e.next=13;break}return _[p.uid]=M(p),e.next=12,_[p.uid].summary();case 12:O[p.uid]=e.sent;case 13:r[f]=_[p.uid],s[f]=C(O[p.uid],p),e.next=20;break;case 17:d=M(p),r[f]=d,s[f]=C(r[f],p);case 20:c++,e.next=5;break;case 23:t.status="SUCCESS",t.details=s,e.next=32;break;case 27:e.prev=27,e.t0=e.catch(1),console.error(e.t0),t.status="ERROR",t.reason=e.t0.toString();case 32:postMessage({type:"PREFLIGHT_INPUT_DATA",resp:t,msg:"Success: PREFLIGHT_INPUT done"});case 33:case"end":return e.stop()}}),e,null,[[1,27]])})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),v(t,e,p)})):"computeVersusClusters"==t?j.then((function(e){var n=l.rank_type,t=l.modality,r=l.annotation,o=i.Yh(A(r)),s=T(r,o).computeVersus(o.levels.indexOf(l.left),o.levels.indexOf(l.right)),a=u.jJ(s.results[t],s.left,n),c=[];m(a,c),postMessage({type:"computeVersusClusters",resp:a,msg:"Success: COMPUTE_VERSUS_CLUSTERS done"},c)})).catch((function(e){console.error(e),v(t,e,p)})):"computeVersusSelections"==t?j.then((function(e){var n=l.rank_type,t=R.computeVersus(l.left,l.right),r=u.jJ(t.results[l.modality],l.left,n),o=[];m(r,o),postMessage({type:"computeVersusSelections",resp:r,msg:"Success: COMPUTE_VERSUS_SELECTIONS done"},o)})).catch((function(e){console.error(e),v(t,e,p)})):"getMarkersForCluster"==t?j.then((function(e){var n=l.cluster,t=l.rank_type,r=l.modality,o=l.annotation,s=i.Yh(A(o)),a=T(o,s).fetchResults()[r],c=u.jJ(a,s.levels.indexOf(n),t),f=[];m(c,f),postMessage({type:"setMarkersForCluster",resp:c,msg:"Success: GET_MARKER_GENE done"},f)})).catch((function(e){console.error(e),v(t,e,p)})):"getGeneExpression"==t?j.then((function(e){var n=l.gene,t=l.modality.toLowerCase(),r=E.matrix.get(t).row(n);postMessage({type:"setGeneExpression",resp:{gene:n,expr:r},msg:"Success: GET_GENE_EXPRESSION done"},[r.buffer])})).catch((function(e){console.error(e),v(t,e,p)})):"computeCustomMarkers"==t?j.then((function(e){R.addSelection(l.id,l.selection),postMessage({type:"computeCustomMarkers",msg:"Success: COMPUTE_CUSTOM_MARKERS done"})})).catch((function(e){console.error(e),v(t,e,p)})):"getMarkersForSelection"==t?j.then((function(e){var n=l.rank_type.replace(/-.*/,""),t=R.fetchResults(l.cluster)[l.modality],r=u.jJ(t,l.cluster,n),o=[];m(r,o),postMessage({type:"setMarkersForCustomSelection",resp:r,msg:"Success: GET_MARKER_GENE done"},o)})).catch((function(e){console.error(e),v(t,e,p)})):"removeCustomMarkers"==t?j.then((function(e){R.removeSelection(l.id)})).catch((function(e){console.error(e),v(t,e,p)})):"getAnnotation"==t?j.then((function(e){var n,t,r=l.annotation;if(n=E.cells.column(r),ArrayBuffer.isView(n))t={type:"array",values:n.slice()};else{var o=[],s={},a=new Int32Array(n.length);n.map((function(e,n){e in s||(s[e]=o.length,o.push(e)),a[n]=s[e]})),t={type:"factor",index:a,levels:o}}var c=[];m(t,c),postMessage({type:"setAnnotation",resp:{annotation:r,values:t},msg:"Success: GET_ANNOTATION done"},c)})).catch((function(e){console.error(e),v(t,e,p)})):"computeFeaturesetSummary"==t?j.then(function(){var e=(0,c.Z)((0,a.Z)().mark((function e(n){var t,r,o,s,c,u,f,p,d,m,h,v,g,w;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=l.annotation,r=l.rank_type,o=l.cluster,s=l.modality,c=r.indexOf("-"),x===t?(u=R.fetchSelectionIndices(o),f=E.cells.numberOfRows(),p=new Uint8Array(f),u.map((function(e){return p.set([1],e)})),d=i.Yh(p),m=T(t,d),h=m.fetchResults()[s],Z.ready().then((function(e){y("computeFeaturesetSummary",Z.computeEnrichment(h,d.levels.indexOf(1),r.slice(0,c),r.slice(c+1)))}))):(v=i.Yh(A(t)),g=T(t,v),w=g.fetchResults()[s],Z.ready().then((function(e){y("computeFeaturesetSummary",Z.computeEnrichment(w,v.levels.indexOf(o),r.slice(0,c),r.slice(c+1)))})));case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),v(t,e,p)})):"computeFeaturesetVSSummary"==t?j.then(function(){var e=(0,c.Z)((0,a.Z)().mark((function e(n){var t,r,o,s,c,u,f,p,d,m;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=l.annotation,r=l.rank_type,o=l.left,s=l.right,c=l.modality,u=r.indexOf("-"),x===t?(f=R.computeVersus(o,s),Z.ready().then((function(e){y("computeFeaturesetVSSummary",Z.computeEnrichment(f.results[c],0,r.slice(0,u),r.slice(u+1)))}))):(p=i.Yh(A(t)),d=T(t,p),m=d.computeVersus(p.levels.indexOf(l.left),p.levels.indexOf(l.right)),Z.ready().then((function(e){y("computeFeaturesetVSSummary",Z.computeEnrichment(m.results[c],m.left,r.slice(0,u),r.slice(u+1)))})));case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.error(e),v(t,e,p)})):"getFeatureScores"===t?j.then((function(e){l.collection;var n=l.index;y("setFeatureScores",Z.computePerCellScores(n))})).catch((function(e){console.error(e),v(t,e,p)})):"getFeatureGeneIndices"===t?j.then((function(e){var n,t,r=l.index,s=l.cluster,a=l.annotation,c=l.modality,f=l.rank_type,p=Z.fetchFeatureSetIndices(r);if(x===a)n=R.fetchResults(l.cluster)[l.modality],t=u.jJ(n,l.cluster,l.rank_type);else{var d=i.Yh(A(a));n=T(a,d).fetchResults()[c],t=u.jJ(n,d.levels.indexOf(s),f)}for(var m=t.ordering.map((function(e,n){return p.includes(e)?n:-100})).filter((function(e){return-100!==e})),h={},v=0,g=Object.entries(t);v<g.length;v++){var w=(0,o.Z)(g[v],2),b=w[0],S=w[1];h[b]=S.map((function(e,n){return m.includes(n)?e:-100})).filter((function(e){return-100!==e}))}y("setFeatureGeneIndices",h)})).catch((function(e){console.error(e),v(t,e,p)})):"initFeaturesetEnrich"===t?j.then(function(){var e=(0,c.Z)((0,a.Z)().mark((function e(n){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=l.modality,Z&&Z.free(),(Z=new u.Y(E.features[t],{normalized:E.matrix.get(t)})).ready().then((function(e){var n=Z.fetchCollectionDetails(),t=Z.fetchSetDetails();y("feature_set_enrichment",{collections:n,sets:{names:t.names,descriptions:t.descriptions,sizes:t.sizes.slice(),collections:t.collections.slice()}})}));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()):(console.error("MIM:::msg type incorrect"),v(t,"Type not defined",p))}}},n={};function t(r){var o=n[r];if(void 0!==o)return o.exports;var s=n[r]={id:r,loaded:!1,exports:{}};return e[r].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}t.m=e,t.x=function(){var e=t.O(void 0,[319,551,795],(function(){return t(9747)}));return e=t.O(e)},function(){var e=[];t.O=function(n,r,o,s){if(!r){var a=1/0;for(l=0;l<e.length;l++){r=e[l][0],o=e[l][1],s=e[l][2];for(var c=!0,u=0;u<r.length;u++)(!1&s||a>=s)&&Object.keys(t.O).every((function(e){return t.O[e](r[u])}))?r.splice(u--,1):(c=!1,s<a&&(a=s));if(c){e.splice(l--,1);var i=o();void 0!==i&&(n=i)}}return n}s=s||0;for(var l=e.length;l>0&&e[l-1][2]>s;l--)e[l]=e[l-1];e[l]=[r,o,s]}}(),t.d=function(e,n){for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},t.f={},t.e=function(e){return Promise.all(Object.keys(t.f).reduce((function(n,r){return t.f[r](e,n),n}),[]))},t.u=function(e){return"static/js/"+e+"."+{319:"0c72d2be",484:"ebd432e3",551:"8e5084b5",795:"c463ec86",909:"e5ca9c2a",933:"4ecc3de1"}[e]+".chunk.js"},t.miniCssF=function(e){},t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},t.p="/kana-v3-dev/",function(){t.b=self.location+"/../../../";var e={747:1};t.f.i=function(n,r){e[n]||importScripts(t.p+t.u(n))};var n=self.webpackChunkkana=self.webpackChunkkana||[],r=n.push.bind(n);n.push=function(n){var o=n[0],s=n[1],a=n[2];for(var c in s)t.o(s,c)&&(t.m[c]=s[c]);for(a&&a(t);o.length;)e[o.pop()]=1;r(n)}}(),function(){var e=t.x;t.x=function(){return Promise.all([319,551,795].map(t.e,t)).then(e)}}();t.x()}();
//# sourceMappingURL=747.94f6b573.chunk.js.map