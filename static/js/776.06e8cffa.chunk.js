/*! For license information please see 776.06e8cffa.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkkana=self.webpackChunkkana||[]).push([[776],{8109:function(e,t,n){n.d(t,{FB:function(){return z}});var r=n(4165),i=n(5671),a=n(3144);function s(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(t){a(t)}}function o(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((r=r.apply(e,t||[])).next())}))}var o,l=function(){function e(){(0,i.Z)(this,e),this.mutex=Promise.resolve()}return(0,a.Z)(e,[{key:"lock",value:function(){var e=function(){};return this.mutex=this.mutex.then((function(){return new Promise(e)})),new Promise((function(t){e=t}))}},{key:"dispatch",value:function(e){return s(this,void 0,void 0,(0,r.Z)().mark((function t(){var n;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.lock();case 2:return n=t.sent,t.prev=3,t.next=6,Promise.resolve(e());case 6:return t.abrupt("return",t.sent);case 7:return t.prev=7,n(),t.finish(7);case 10:case"end":return t.stop()}}),t,this,[[3,,7,10]])})))}}]),e}();var u="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:n.g,c=null!==(o=u.Buffer)&&void 0!==o?o:null,h=u.TextEncoder?new u.TextEncoder:null;function f(e,t){return(15&e)+(e>>6|e>>3&8)<<4|(15&t)+(t>>6|t>>3&8)}function d(e,t){for(var n=t.length>>1,r=0;r<n;r++){var i=r<<1;e[r]=f(t.charCodeAt(i),t.charCodeAt(i+1))}}function v(e,t){if(e.length!==2*t.length)return!1;for(var n=0;n<t.length;n++){var r=n<<1;if(t[n]!==f(e.charCodeAt(r),e.charCodeAt(r+1)))return!1}return!0}var p="a".charCodeAt(0)-10,m="0".charCodeAt(0);function w(e,t,n){for(var r=0,i=0;i<n;i++){var a=t[i]>>>4;e[r++]=a>9?a+p:a+m,a=15&t[i],e[r++]=a>9?a+p:a+m}return String.fromCharCode.apply(null,e)}for(var Z=null!==c?function(e){if("string"===typeof e){var t=c.from(e,"utf8");return new Uint8Array(t.buffer,t.byteOffset,t.length)}if(c.isBuffer(e))return new Uint8Array(e.buffer,e.byteOffset,e.length);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")}:function(e){if("string"===typeof e)return h.encode(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")},_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g=new Uint8Array(256),b=0;b<_.length;b++)g[_.charCodeAt(b)]=b;function y(e){var t=Math.floor(.75*e.length),n=e.length;return"="===e[n-1]&&(t-=1,"="===e[n-2]&&(t-=1)),t}function k(e){for(var t=y(e),n=e.length,r=new Uint8Array(t),i=0,a=0;a<n;a+=4){var s=g[e.charCodeAt(a)],o=g[e.charCodeAt(a+1)],l=g[e.charCodeAt(a+2)],u=g[e.charCodeAt(a+3)];r[i]=s<<2|o>>4,r[i+=1]=(15&o)<<4|l>>2,r[i+=1]=(3&l)<<6|63&u,i+=1}return r}var A=16384,x=4,E=new l,S=new Map;function C(e,t){return s(this,void 0,void 0,(0,r.Z)().mark((function n(){var i,a,o,l,u,c,h,f,p,m,_,g,b,y,C,I,B,R,F,z,N=this;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=null,a=null,o=!1,"undefined"!==typeof WebAssembly){n.next=5;break}throw new Error("WebAssembly is not supported in this environment!");case 5:l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;a.set(e,t)},u=function(){return a},c=function(){return i.exports},h=function(e){i.exports.Hash_SetMemorySize(e);var t=i.exports.Hash_GetBuffer(),n=i.exports.memory.buffer;a=new Uint8Array(n,t,e)},f=function(){return new DataView(i.exports.memory.buffer).getUint32(i.exports.STATE_SIZE,!0)},p=E.dispatch((function(){return s(N,void 0,void 0,(0,r.Z)().mark((function t(){var n,a,s;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return S.has(e.name)||(n=k(e.data),a=WebAssembly.compile(n),S.set(e.name,a)),t.next=3,S.get(e.name);case 3:return s=t.sent,t.next=6,WebAssembly.instantiate(s,{});case 6:i=t.sent;case 7:case"end":return t.stop()}}),t)})))})),m=function(){return s(N,void 0,void 0,(0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=3;break}return e.next=3,p;case 3:t=i.exports.Hash_GetBuffer(),n=i.exports.memory.buffer,a=new Uint8Array(n,t,A);case 6:case"end":return e.stop()}}),e)})))},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;o=!0,i.exports.Hash_Init(e)},g=function(e){for(var t=0;t<e.length;){var n=e.subarray(t,t+A);t+=n.length,a.set(n),i.exports.Hash_Update(n.length)}},b=function(e){if(!o)throw new Error("update() called before init()");var t=Z(e);g(t)},y=new Uint8Array(2*t),C=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!o)throw new Error("digest() called before init()");return o=!1,i.exports.Hash_Final(n),"binary"===e?a.slice(0,t):w(y,a,t)},I=function(){if(!o)throw new Error("save() can only be called after init() and before digest()");var t=i.exports.Hash_GetState(),n=f(),r=i.exports.memory.buffer,a=new Uint8Array(r,t,n),s=new Uint8Array(x+n);return d(s,e.hash),s.set(a,x),s},B=function(t){if(!(t instanceof Uint8Array))throw new Error("load() expects an Uint8Array generated by save()");var n=i.exports.Hash_GetState(),r=f(),a=x+r,s=i.exports.memory.buffer;if(t.length!==a)throw new Error("Bad state length (expected ".concat(a," bytes, got ").concat(t.length,")"));if(!v(e.hash,t.subarray(0,x)))throw new Error("This state was written by an incompatible hash implementation");var l=t.subarray(x);new Uint8Array(s,n,r).set(l),o=!0},R=function(e){return"string"===typeof e?e.length<A/4:e.byteLength<A},F=R,n.t0=e.name,n.next="argon2"===n.t0||"scrypt"===n.t0?24:"blake2b"===n.t0||"blake2s"===n.t0?26:"blake3"===n.t0?28:"xxhash64"===n.t0||"xxhash3"===n.t0||"xxhash128"===n.t0?30:32;break;case 24:return F=function(){return!0},n.abrupt("break",32);case 26:return F=function(e,t){return t<=512&&R(e)},n.abrupt("break",32);case 28:return F=function(e,t){return 0===t&&R(e)},n.abrupt("break",32);case 30:return F=function(){return!1},n.abrupt("break",32);case 32:return z=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!F(e,n))return _(n),b(e),C("hex",r);var s=Z(e);return a.set(s),i.exports.Hash_Calculate(s.length,n,r),w(y,a,t)},n.next=35,m();case 35:return n.abrupt("return",{getMemory:u,writeMemory:l,getExports:c,setMemorySize:h,init:_,update:b,digest:C,save:I,load:B,calculate:z,hashLength:t});case 36:case"end":return n.stop()}}),n)})))}function I(e,t,n){return s(this,void 0,void 0,(0,r.Z)().mark((function i(){var a,s;return(0,r.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.lock();case 2:return a=r.sent,r.next=5,C(t,n);case 5:return s=r.sent,a(),r.abrupt("return",s);case 8:case"end":return r.stop()}}),i)})))}new l;new l;new DataView(new ArrayBuffer(4));new l;new l;new l;new l;new l;var B={name:"md5",data:"AGFzbQEAAAABEgRgAAF/YAAAYAF/AGACf38BfwMIBwABAgMBAAIEBQFwAQEBBQQBAQICBg4CfwFBoIoFC38AQYAICwdwCAZtZW1vcnkCAA5IYXNoX0dldEJ1ZmZlcgAACUhhc2hfSW5pdAABC0hhc2hfVXBkYXRlAAIKSGFzaF9GaW5hbAAEDUhhc2hfR2V0U3RhdGUABQ5IYXNoX0NhbGN1bGF0ZQAGClNUQVRFX1NJWkUDAQqzFgcFAEGACQstAEEAQv6568XpjpWZEDcCkIkBQQBCgcaUupbx6uZvNwKIiQFBAEIANwKAiQEL6AIBA39BAEEAKAKAiQEiASAAakH/////AXEiAjYCgIkBQQAoAoSJASEDAkAgAiABTw0AQQAgA0EBaiIDNgKEiQELQQAgAyAAQR12ajYChIkBAkACQAJAAkACQAJAIAFBP3EiAw0AQYAJIQIMAQtBwAAgA2siAiAASw0BIANBGGohA0EAIQEDQCADIAFqQYCJAWogAUGACWotAAA6AAAgAyABQQFqIgFqQdgARw0AC0GYiQFBwAAQAxogACACayEAIAJBgAlqIQILIABBwABPDQEgACEDDAILIABFDQJBACEBIANBmIkBakEALQCACToAACAAQQFGDQIgA0GZiQFqIQMgAEF/aiECA0AgAyABaiABQYEJai0AADoAACACIAFBAWoiAUcNAAwDCwsgAEE/cSEDIAIgAEFAcRADIQILIANFDQBBACEBA0AgAUGYiQFqIAIgAWotAAA6AAAgAyABQQFqIgFHDQALCwu0EAEZf0EAKAKUiQEhAkEAKAKQiQEhA0EAKAKMiQEhBEEAKAKIiQEhBQNAIABBCGooAgAiBiAAQRhqKAIAIgcgAEEoaigCACIIIABBOGooAgAiCSAAQTxqKAIAIgogAEEMaigCACILIABBHGooAgAiDCAAQSxqKAIAIg0gDCALIAogDSAJIAggByADIAZqIAIgAEEEaigCACIOaiAFIAQgAiADc3EgAnNqIAAoAgAiD2pB+Miqu31qQQd3IARqIhAgBCADc3EgA3NqQdbunsZ+akEMdyAQaiIRIBAgBHNxIARzakHb4YGhAmpBEXcgEWoiEmogAEEUaigCACITIBFqIABBEGooAgAiFCAQaiAEIAtqIBIgESAQc3EgEHNqQe6d9418akEWdyASaiIQIBIgEXNxIBFzakGvn/Crf2pBB3cgEGoiESAQIBJzcSASc2pBqoyfvARqQQx3IBFqIhIgESAQc3EgEHNqQZOMwcF6akERdyASaiIVaiAAQSRqKAIAIhYgEmogAEEgaigCACIXIBFqIAwgEGogFSASIBFzcSARc2pBgaqaampBFncgFWoiECAVIBJzcSASc2pB2LGCzAZqQQd3IBBqIhEgECAVc3EgFXNqQa/vk9p4akEMdyARaiISIBEgEHNxIBBzakGxt31qQRF3IBJqIhVqIABBNGooAgAiGCASaiAAQTBqKAIAIhkgEWogDSAQaiAVIBIgEXNxIBFzakG+r/PKeGpBFncgFWoiECAVIBJzcSASc2pBoqLA3AZqQQd3IBBqIhEgECAVc3EgFXNqQZPj4WxqQQx3IBFqIhUgESAQc3EgEHNqQY6H5bN6akERdyAVaiISaiAHIBVqIA4gEWogCiAQaiASIBUgEXNxIBFzakGhkNDNBGpBFncgEmoiECAScyAVcSASc2pB4sr4sH9qQQV3IBBqIhEgEHMgEnEgEHNqQcDmgoJ8akEJdyARaiISIBFzIBBxIBFzakHRtPmyAmpBDncgEmoiFWogCCASaiATIBFqIA8gEGogFSAScyARcSASc2pBqo/bzX5qQRR3IBVqIhAgFXMgEnEgFXNqQd2gvLF9akEFdyAQaiIRIBBzIBVxIBBzakHTqJASakEJdyARaiISIBFzIBBxIBFzakGBzYfFfWpBDncgEmoiFWogCSASaiAWIBFqIBQgEGogFSAScyARcSASc2pByPfPvn5qQRR3IBVqIhAgFXMgEnEgFXNqQeabh48CakEFdyAQaiIRIBBzIBVxIBBzakHWj9yZfGpBCXcgEWoiEiARcyAQcSARc2pBh5vUpn9qQQ53IBJqIhVqIAYgEmogGCARaiAXIBBqIBUgEnMgEXEgEnNqQe2p6KoEakEUdyAVaiIQIBVzIBJxIBVzakGF0o/PempBBXcgEGoiESAQcyAVcSAQc2pB+Me+Z2pBCXcgEWoiEiARcyAQcSARc2pB2YW8uwZqQQ53IBJqIhVqIBcgEmogEyARaiAZIBBqIBUgEnMgEXEgEnNqQYqZqel4akEUdyAVaiIQIBVzIhUgEnNqQcLyaGpBBHcgEGoiESAVc2pBge3Hu3hqQQt3IBFqIhIgEXMiGiAQc2pBosL17AZqQRB3IBJqIhVqIBQgEmogDiARaiAJIBBqIBUgGnNqQYzwlG9qQRd3IBVqIhAgFXMiFSASc2pBxNT7pXpqQQR3IBBqIhEgFXNqQamf+94EakELdyARaiISIBFzIgkgEHNqQeCW7bV/akEQdyASaiIVaiAPIBJqIBggEWogCCAQaiAVIAlzakHw+P71e2pBF3cgFWoiECAVcyIVIBJzakHG/e3EAmpBBHcgEGoiESAVc2pB+s+E1X5qQQt3IBFqIhIgEXMiCCAQc2pBheG8p31qQRB3IBJqIhVqIBkgEmogFiARaiAHIBBqIBUgCHNqQYW6oCRqQRd3IBVqIhEgFXMiECASc2pBuaDTzn1qQQR3IBFqIhIgEHNqQeWz7rZ+akELdyASaiIVIBJzIgcgEXNqQfj5if0BakEQdyAVaiIQaiAMIBVqIA8gEmogBiARaiAQIAdzakHlrLGlfGpBF3cgEGoiESAVQX9zciAQc2pBxMSkoX9qQQZ3IBFqIhIgEEF/c3IgEXNqQZf/q5kEakEKdyASaiIQIBFBf3NyIBJzakGnx9DcempBD3cgEGoiFWogCyAQaiAZIBJqIBMgEWogFSASQX9zciAQc2pBucDOZGpBFXcgFWoiESAQQX9zciAVc2pBw7PtqgZqQQZ3IBFqIhAgFUF/c3IgEXNqQZKZs/h4akEKdyAQaiISIBFBf3NyIBBzakH96L9/akEPdyASaiIVaiAKIBJqIBcgEGogDiARaiAVIBBBf3NyIBJzakHRu5GseGpBFXcgFWoiECASQX9zciAVc2pBz/yh/QZqQQZ3IBBqIhEgFUF/c3IgEHNqQeDNs3FqQQp3IBFqIhIgEEF/c3IgEXNqQZSGhZh6akEPdyASaiIVaiANIBJqIBQgEWogGCAQaiAVIBFBf3NyIBJzakGho6DwBGpBFXcgFWoiECASQX9zciAVc2pBgv3Nun9qQQZ3IBBqIhEgFUF/c3IgEHNqQbXk6+l7akEKdyARaiISIBBBf3NyIBFzakG7pd/WAmpBD3cgEmoiFSAEaiAWIBBqIBUgEUF/c3IgEnNqQZGnm9x+akEVd2ohBCAVIANqIQMgEiACaiECIBEgBWohBSAAQcAAaiEAIAFBQGoiAQ0AC0EAIAI2ApSJAUEAIAM2ApCJAUEAIAQ2AoyJAUEAIAU2AoiJASAAC6ECAQN/QQAoAoCJASIAQT9xIgFBmIkBakGAAToAAAJAAkACQCABQT9zIgJBB0sNAAJAIAJFDQAgAUGZiQFqIQADQCAAQQA6AAAgAEEBaiEAIAJBf2oiAg0ACwtBwAAhAkGYiQFBwAAQAxpBACEADAELIAJBCEYNASABQQFqIQALIABBj4kBaiEBA0AgASACakEAOgAAIAJBd2ohACACQX9qIQIgAEEASg0AC0EAKAKAiQEhAAtBACAAQRV2OgDTiQFBACAAQQ12OgDSiQFBACAAQQV2OgDRiQFBACAAQQN0IgI6ANCJAUEAIAI2AoCJAUEAQQAoAoSJATYC1IkBQZiJAUHAABADGkEAQQApAoiJATcDgAlBAEEAKQKQiQE3A4gJCwYAQYCJAQszAEEAQv6568XpjpWZEDcCkIkBQQBCgcaUupbx6uZvNwKIiQFBAEIANwKAiQEgABACEAQLCwsBAEGACAsEmAAAAA==",hash:"9b0fac7d"},R=new l,F=null;function z(e){if(null===F)return I(R,B,16).then((function(t){return(F=t).calculate(e)}));try{var t=F.calculate(e);return Promise.resolve(t)}catch(n){return Promise.reject(n)}}new l;new l;new l;new l;new l;new l;new l;new l;new l,new ArrayBuffer(8);new l,new ArrayBuffer(8);new l,new ArrayBuffer(8);new l;new l;new l},9807:function(e,t,n){n.d(t,{M:function(){return Ir}});var r=n(7762),i=n(4165),a=n(5861),s=n(5671),o=n(3144),l=n(8652),u=n(2346),c=n(3889),h=n(2793),f=n(3966),d=n(9902),v=n(8916),p=n(3324),m=n(5831),w=n(7462),Z=n(1413),_=n(2415);function g(e){m.gd(e)}function b(e,t,n,r){if(!n&&(e instanceof ArrayBuffer||ArrayBuffer.isView(e)))throw new Error("parameters cannot contain ArrayBuffers or their views");if(!r&&(t instanceof ArrayBuffer||ArrayBuffer.isView(t)))throw new Error("parameters cannot contain ArrayBuffers or their views")}function y(e,t){if(typeof e!=typeof t)return b(e,t,!1,!1),!0;if("object"!=typeof e)return e!=t;var n=null===e,r=null===t;if(n!==r)return b(e,t,n,r),!0;if(n)return!1;var i=e instanceof Array,a=t instanceof Array;if(i!=a)return b(e,t,i,a),!0;if(i){if(e.length!=t.length)return!0;for(var s=0;s<e.length;s++)if(y(e[s],t[s]))return!0;return!1}b(e,t,!1,!1);var o=Object.keys(e),l=Object.keys(t);if(o.length!=l.length)return!0;o.sort(),l.sort();for(s=0;s<o.length;s++)if(o[s]!=l[s])return!0;for(var u=0,c=o;u<c.length;u++){var h=c[u];if(y(e[h],t[h]))return!0}return!1}function k(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"buffer",i=!0;if(r in n){var a=n[r];a.size!=e||a.constructor.className!=t||null!==a.owner?a.free():i=!1}if(i)switch(t){case"Uint8Array":n[r]=m.TS(e);break;case"Int32Array":n[r]=m.Wf(e);break;case"Float64Array":n[r]=m.RJ(e);break;default:throw"allocating '"+t+"' not yet supported"}return n[r]}function A(e,t){for(var n=[],r=0,i=Object.entries(e);r<i.length;r++){var a=(0,p.Z)(i[r],2),s=a[0];a[1].valid()&&n.push(s)}if(0==n.length)throw new Error("expected at least one valid upstream "+t+" state");return n}function x(e){return E.apply(this,arguments)}function E(){return(E=(0,a.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:if((n=e.sent).ok){e.next=5;break}throw new Error("failed to fetch content at "+t+"("+n.status+")");case 5:return e.t0=Uint8Array,e.next=8,n.arrayBuffer();case 8:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var S=new WeakMap,C=new WeakMap,I=new WeakMap,B=new WeakMap,R=function(){function e(t){var n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).name,r=void 0===n?null:n;if((0,s.Z)(this,e),(0,u.Z)(this,S,{writable:!0,value:void 0}),(0,u.Z)(this,C,{writable:!0,value:void 0}),(0,u.Z)(this,I,{writable:!0,value:void 0}),(0,u.Z)(this,B,{writable:!0,value:void 0}),t instanceof File)(0,h.Z)(this,S,"file"),(0,h.Z)(this,I,t),null===r&&(r=t.name),(0,h.Z)(this,B,r);else{if(!(t instanceof Uint8Array))throw new Error("unknown type '"+typeof t+"' for SimpleFile constructor");if((0,h.Z)(this,S,"buffer"),(0,h.Z)(this,C,t),null===r)throw new Error("'name' must be provided for Uint8Array inputs in SimpleFile constructor");(0,h.Z)(this,B,r)}}return(0,o.Z)(e,[{key:"buffer",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).copy,t=void 0!==e&&e;if("file"==(0,v.Z)(this,S)){var n=(new FileReaderSync).readAsArrayBuffer((0,v.Z)(this,I));return new Uint8Array(n)}return t?(0,v.Z)(this,C).slice():(0,v.Z)(this,C)}},{key:"size",value:function(){return"file"==(0,v.Z)(this,S)?(0,v.Z)(this,I).size:(0,v.Z)(this,C).length}},{key:"name",value:function(){return(0,v.Z)(this,B)}},{key:"content",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).copy,t=void 0!==e&&e;return this.buffer({copy:t})}}]),e}(),F=n(714),z=n(1025);function N(e,t,n,r,i){i("no support for file paths in the browser context")}function D(e,t){return null!==t?t:(n=e instanceof Uint8Array?e:function(e,t){throw new Error("no support for file paths in the browser context")}()).length>=3&&31==n[0]&&139==n[1]&&8==n[2]?"gz":"none";var n}function M(e,t){var n,i=0,a=(0,r.Z)(e);try{for(a.s();!(n=a.n()).done;){i+=n.value.length}}catch(c){a.e(c)}finally{a.f()}var s=new Uint8Array(i);i=0;var o,l=(0,r.Z)(e);try{for(l.s();!(o=l.n()).done;){var u=o.value;s.set(u,i),i+=u.length}}catch(c){l.e(c)}finally{l.f()}return t.decode(s)}function O(e,t,n,r){return W.apply(this,arguments)}function W(){return(W=(0,a.Z)((0,i.Z)().mark((function e(t,n,r,a){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t||t instanceof Uint8Array||(t=t instanceof R?t.content():new R(t,{name:"dummy"}).content()),"gz"!=D(t,n)){e.next=5;break}return e.next=4,new Promise((function(e,n){var i=new F.T_({chunkSize:r});i.onData=a,i.onEnd=function(t){t?n("gzip decompression failed; "+i.msg):e(null)},"string"==typeof t?N(0,0,0,0,n):i.push(t)}));case 4:case 8:return e.abrupt("return");case 5:if("string"!=typeof t){e.next=9;break}return e.next=8,new Promise((function(e,t){return N(0,0,0,0,t)}));case 9:return a(t),e.abrupt("return");case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e){return j.apply(this,arguments)}function j(){return j=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r,a,s,o,l,u,c,h,f=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=f.length>1&&void 0!==f[1]?f[1]:{}).compression,a=void 0===r?null:r,s=n.chunkSize,o=void 0===s?65536:s,l=new TextDecoder,u=[],c=[],h=function(e){for(var t=0,n=0;n<e.length;n++)if(10==e[n]){var r=e.subarray(t,n);u.length?(u.push(r),c.push(M(u,l)),u=[]):c.push(l.decode(r)),t=n+1}t!=e.length&&u.push(e.slice(t))},e.next=7,O(t,a,o,h);case 7:return u.length&&c.push(M(u,l)),e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)}))),j.apply(this,arguments)}function q(e){return U.apply(this,arguments)}function U(){return U=(0,a.Z)((0,i.Z)().mark((function e(t){var n,a,s,o,l,u,c,h,f,d,v,p,m,w,Z=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(n=Z.length>1&&void 0!==Z[1]?Z[1]:{}).compression,s=void 0===a?null:a,o=n.delim,l=void 0===o?"\t":o,u=n.chunkSize,c=void 0===u?1048576:u,h=new TextDecoder,f=[],d=function(e){var t=z.parse(e,{delimiter:l});if(t.meta.aborted){var n,i="failed to parse delimited file",a=(0,r.Z)(t.errors);try{for(a.s();!(n=a.n()).done;){i+="; "+n.value.message}}catch(c){a.e(c)}finally{a.f()}throw new Error(i)}var s,o=(0,r.Z)(t.data);try{for(o.s();!(s=o.n()).done;){var u=s.value;f.push(u)}}catch(c){o.e(c)}finally{o.f()}},v=[],p=0,m=function(e){for(var t=0,n=0;n<e.length;n++)if(10==e[n]&&n-t+p>=c){var r=e.subarray(t,n);v.length?(v.push(r),d(M(v,h)),v=[]):d(h.decode(r)),t=n+1,p=0}t!=e.length&&(v.push(e.slice(t)),p+=e.length-t)},e.next=9,O(t,s,c,m);case 9:return v.length&&(w=M(v,h),d(w),"\n"==w[w.length-1]&&f.pop()),e.abrupt("return",f);case 11:case"end":return e.stop()}}),e)}))),U.apply(this,arguments)}n(7326);var T=n(136),P=n(9388);n(5587);var G="raw_subset_indices",L=new WeakMap,H=new WeakMap,V=new WeakMap,Y=new WeakMap,J=new WeakSet,X=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(0,s.Z)(this,e),(0,l.Z)(this,J),(0,u.Z)(this,L,{writable:!0,value:void 0}),(0,u.Z)(this,H,{writable:!0,value:void 0}),(0,u.Z)(this,V,{writable:!0,value:void 0}),(0,u.Z)(this,Y,{writable:!0,value:void 0}),(0,h.Z)(this,L,null===t?{}:t),(0,h.Z)(this,H,null===n?{}:n),(0,h.Z)(this,V,null===r?{}:r),(0,h.Z)(this,Y,!1),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){g((0,v.Z)(this,H).matrix),g((0,v.Z)(this,H).raw_matrix),g((0,v.Z)(this,H).block_ids),g((0,v.Z)(this,H).raw_block_ids),g((0,v.Z)(this,H).multi_block_ids)}},{key:"fetchCountMatrix",value:function(){return(0,v.Z)(this,H).matrix}},{key:"fetchFeatureAnnotations",value:function(){return(0,v.Z)(this,H).genes}},{key:"fetchRowIds",value:function(){return(0,v.Z)(this,H).row_ids}},{key:"fetchCellAnnotations",value:function(){return(0,v.Z)(this,H).annotations}},{key:"fetchBlock",value:function(){return(0,v.Z)(this,H).block_ids}},{key:"fetchBlockLevels",value:function(){return(0,v.Z)(this,H).block_levels}},{key:"fetchParameters",value:function(){var t,n=(0,Z.Z)({},(0,v.Z)(this,L));return n.subset=(0,_.Z)(t=this.constructor,e,$).call(t,n.subset),n}},{key:"fetchDatasets",value:function(){return(0,v.Z)(this,H).datasets}},{key:"fetchDirectSubset",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).copy,t=void 0===e||e;if(G in(0,v.Z)(this,H)){var n=(0,v.Z)(this,H)[G];return t?n.slice():n}return null}},{key:"guessRnaFeatureTypes",value:function(){return"RNA"in(0,v.Z)(this,H).genes?("inferred_rna_types"in(0,v.Z)(this,H)||((0,v.Z)(this,H).inferred_rna_types=function(e){var t={columns:{}},n=e.rowNames();null!==n&&(t.row_names=m.gn(n,{forceTaxonomy:!0}));var i,a=(0,r.Z)(e.columnNames());try{for(a.s();!(i=a.n()).done;){var s=i.value;e.column(s)instanceof Array&&(t.columns[s]=m.gn(e.column(s),{forceTaxonomy:!0}))}}catch(o){a.e(o)}finally{a.f()}return t}((0,v.Z)(this,H).genes.RNA)),(0,v.Z)(this,H).inferred_rna_types):null}},{key:"enableDatasetCache",value:function(e){(0,h.Z)(this,Y,e)}},{key:"compute",value:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(n,r){var a,s,o,l,u,c,f,d,m;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=r.block_factor,s=r.subset,this.changed=!1,null===n){t.next=12;break}for(o={},l=0,u=Object.entries(n);l<u.length;l++)c=(0,p.Z)(u[l],2),f=c[0],d=c[1],o[f]={format:d.constructor.format(),details:d.abbreviate()};if(!y(o,(0,v.Z)(this,V))){t.next=12;break}return t.next=8,le(n,(0,v.Z)(this,H),(0,v.Z)(this,Y));case 8:(0,h.Z)(this,V,o),(0,v.Z)(this,H).datasets=(0,Z.Z)({},n),delete(0,v.Z)(this,H).inferred_rna_types,this.changed=!0;case 12:return(this.changed||(0,v.Z)(this,L).block_factor!==a)&&(ce(a,(0,v.Z)(this,H)),(0,v.Z)(this,L).block_factor=a,this.changed=!0),(this.changed||!(G in(0,v.Z)(this,H))&&y(s,(0,v.Z)(this,L).subset)||!("matrix"in(0,v.Z)(this,H)))&&(he(s,(0,v.Z)(this,H)),(0,v.Z)(this,L).subset=(0,_.Z)(m=this.constructor,e,$).call(m,s),this.changed=!0),t.abrupt("return",null);case 15:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"undoSubset",value:function(e){if("matrix"in(0,v.Z)(this,H)){var t,n=this.fetchCountMatrix().numberOfColumns(),i=(0,r.Z)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a<0||a>=n)throw new Error("entries of 'indices' should be less than the number of cells in the dataset")}}catch(l){i.e(l)}finally{i.f()}}var s=null;"subset"in(0,v.Z)(this,L)&&(s=(0,v.Z)(this,L).subset);var o=oe(s,(0,v.Z)(this,H));null!==o&&e.forEach((function(t,n){e[n]=o[t]}))}},{key:"setDirectSubset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.copy,r=void 0===n||n,i=t.onOriginal,a=void 0!==i&&i;null!==e?(0,v.Z)(this,H)[G]=(0,c.Z)(this,J,K).call(this,e,r,a):delete(0,v.Z)(this,H)[G],m.gd((0,v.Z)(this,H).matrix),delete(0,v.Z)(this,H).matrix}},{key:"createDirectSubset",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.copy,i=void 0===r||r,a=n.onOriginal,s=void 0!==a&&a,o={};o[G]=(0,c.Z)(this,J,K).call(this,t,i,s),o.raw_matrix=(0,v.Z)(this,H).raw_matrix.clone();for(var l=0,u=["multi_block_ids","raw_block_ids"];l<u.length;l++){var h=u[l];h in(0,v.Z)(this,H)&&(null===(0,v.Z)(this,H)[h]?o[h]=null:o[h]=(0,v.Z)(this,H)[h].clone())}for(var f=0,d=["row_ids","raw_annotations","genes","multi_block_levels","raw_block_levels"];f<d.length;f++){var p=d[f];p in(0,v.Z)(this,H)&&(o[p]=(0,v.Z)(this,H)[p])}he(null,o);var m=this.fetchParameters();return m.subset=null,new e(m,o,(0,v.Z)(this,V))}}],[{key:"defaults",value:function(){return{block_factor:null,subset:null}}}]),e}();function $(e){if(null==e)return e;var t=(0,Z.Z)({},e);return"values"in t&&(t.values=t.values.slice()),"ranges"in t&&(t.ranges=t.ranges.map((function(e){return e.slice()}))),t}function K(e,t,n){return function(e,t){if(null!==t){var n,i=(0,r.Z)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a<0||a>=t)throw new Error("subset indices are out of range")}}catch(o){i.e(o)}finally{i.f()}}for(var s=1;s<e.length;s++)if(e[s]<=e[s-1])throw new Error("subset indices must be sorted and unique")}(e,null),t&&(e=e.slice()),n||this.undoSubset(e),e}var ee=["RNA","ADT","CRISPR"];function te(e,t){var n={};try{for(var r=[],i=[],a=0;a<t.length;a++){i.push(t[a].matrix.get(e));var s=t[a].primary_ids[e];if(null==s)throw new Error("modality '"+e+"' lacks a primary identifier for dataset "+String(a));r.push(s)}var o=m.KV(i,r);n.matrix=o.matrix,n.features=w.Nd(t[0].features[e],o.indices),n.row_ids=w.Nd(t[0].row_ids[e],o.indices)}catch(l){throw g(n.matrix),l}return n}function ne(e,t){var n,i,a=[],s=(0,r.Z)(ee);try{for(s.s();!(n=s.n()).done;){var o,l=n.value,u=!0,c=(0,r.Z)(t);try{for(c.s();!(o=c.n()).done;){if(!o.value.matrix.has(l)){u=!1;break}}}catch(y){c.e(y)}finally{c.f()}u&&a.push(l)}}catch(y){s.e(y)}finally{s.f()}if(0==a.length)throw new Error("failed to find common modalities across all datasets");var h={matrix:new m.VU,features:{},row_ids:{}};try{for(var f=0,d=a;f<d.length;f++){var v=d[f],p=te(v,t);h.matrix.add(v,p.matrix),h.features[v]=p.features,h.row_ids[v]=p.row_ids}var Z=t.map((function(e){return e.cells}));h.cells=w.sj(Z);var _=new Array(t.length);t.forEach((function(e,t){_[t]=e.matrix.numberOfColumns()})),i=m.j4(_),h.block_ids=i,h.block_levels=e;var b=new Array(i.length);i.forEach((function(t,n){b[n]=e[t]})),h.cells.$setColumn("__batch__",b)}catch(k){throw g(i),g(h.matrix),k}return h}function re(e){if(0==e.matrix.available().length)throw new Error("");var t={matrix:new m.VU,features:{},row_ids:{}};try{var n,i=(0,r.Z)(ee);try{for(i.s();!(n=i.n()).done;){var a=n.value;e.matrix.has(a)&&(t.matrix.add(a,e.matrix.get(a)),t.features[a]=e.features[a],t.row_ids[a]=e.row_ids[a])}}catch(s){i.e(s)}finally{i.f()}}catch(o){throw m.gd(t.matrix),o}return t.cells=e.cells,t.block_ids=null,t.block_levels=null,t}function ie(e,t){return ae.apply(this,arguments)}function ae(){return(ae=(0,a.Z)((0,i.Z)().mark((function e(t,n){var a,s,o,l,u,c,h,f,d,v,p,w;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(a=Object.keys(t)).sort(),s=[],e.prev=3,o=0,l=a;case 5:if(!(o<l.length)){e.next=15;break}return u=l[o],e.t0=s,e.next=10,t[u].load({cache:n});case 10:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 12:o++,e.next=5;break;case 15:e.next=22;break;case 17:e.prev=17,e.t2=e.catch(3),c=(0,r.Z)(s);try{for(c.s();!(h=c.n()).done;)f=h.value,m.gd(f.matrix)}catch(i){c.e(i)}finally{c.f()}throw e.t2;case 22:if(1!=a.length){e.next=33;break}e.prev=23,d=re(s[0]),e.next=31;break;case 27:throw e.prev=27,e.t3=e.catch(23),m.gd(s[0].matrix),e.t3;case 31:e.next=34;break;case 33:try{d=ne(a,s)}finally{v=(0,r.Z)(s);try{for(v.s();!(p=v.n()).done;)w=p.value,m.gd(w.matrix)}catch(i){v.e(i)}finally{v.f()}}case 34:return e.abrupt("return",d);case 35:case"end":return e.stop()}}),e,null,[[3,17],[23,27]])})))).apply(this,arguments)}var se=-1;function oe(e,t){var n;if(G in t)n=t[G];else if(null==e)n=null;else{if(!t.raw_annotations.hasColumn(e.field))throw new Error("failed to find '"+e.field+"' in the column annotations");var i=t.raw_annotations.column(e.field);if(n=[],"values"in e){var a=new Set(e.values);i.forEach((function(e,t){a.has(e)&&n.push(t)}))}else i.forEach((function(t,i){var a,s=(0,r.Z)(e.ranges);try{for(s.s();!(a=s.n()).done;){var o=a.value;if(t>=o[0]&&t<=o[1])return void n.push(i)}}catch(l){s.e(l)}finally{s.f()}}))}if("raw_block_ids"in t&&null!==t.raw_block_ids){var s=t.raw_block_ids.array(),o=[];if(null!==n){var l,u=(0,r.Z)(n);try{for(u.s();!(l=u.n()).done;){var c=l.value;s[c]!==se&&o.push(c)}}catch(f){u.e(f)}finally{u.f()}}else for(var h=0;h<s.length;h++)s[h]!==se&&o.push(h);n=o}return n}function le(e,t,n){return ue.apply(this,arguments)}function ue(){return(ue=(0,a.Z)((0,i.Z)().mark((function e(t,n,r){var a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g(n.raw_matrix),g(n.matrix),g(n.multi_block_ids),e.next=5,ie(t,r);case 5:a=e.sent,n.raw_matrix=a.matrix,n.row_ids=a.row_ids,n.raw_annotations=a.cells,n.multi_block_ids=a.block_ids,n.multi_block_levels=a.block_levels,n.genes=a.features;case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ce(e,t){g(t.raw_block_ids);var n=null,r=null;if(null!==e)try{var i=t.raw_annotations.column(e);if(i.length!=t.raw_matrix.numberOfColumns())throw new Error("length of blocking factor '"+e+"' should be equal to the number of cells");var a=m.Yh(i,{action:"none",placeholder:se});n=a.ids,r=a.levels}catch(s){throw g(n),s}else n=null!==t.multi_block_ids?t.multi_block_ids.view():null,r=t.multi_block_levels;t.raw_block_ids=n,t.raw_block_levels=r}function he(e,t){g(t.matrix),g(t.block_ids);var n,i,a,s,o=oe(e,t);try{if(null===o)n=t.raw_annotations,i=t.raw_matrix.clone(),null!==t.raw_block_ids?(a=t.raw_block_ids.view(),s=t.raw_block_levels):(a=null,s=null);else{if(n=w.Nd(t.raw_annotations,o),null!==t.raw_block_ids)a=m.DS(t.raw_block_ids,o),s=m.D4(a).map((function(e){return t.raw_block_levels[e]}));else a=null,s=null;i=new m.VU;var l,u=(0,r.Z)(t.raw_matrix.available());try{for(u.s();!(l=u.n()).done;){var c=l.value,h=t.raw_matrix.get(c);i.add(c,m.ZW(h,o))}}catch(f){u.e(f)}finally{u.f()}}}catch(d){throw g(i),g(a),d}t.annotations=n,t.block_levels=s,t.block_ids=a,t.matrix=i}var fe=n(4942),de="https://github.com/kanaverse/kana-special-features/releases/download/v1.0.0",ve=new WeakMap,pe=new WeakMap,me=new WeakMap,we=new WeakMap,Ze=new WeakSet,_e=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,s.Z)(this,e),(0,l.Z)(this,Ze),(0,u.Z)(this,ve,{writable:!0,value:void 0}),(0,u.Z)(this,pe,{writable:!0,value:void 0}),(0,u.Z)(this,me,{writable:!0,value:void 0}),(0,u.Z)(this,we,{writable:!0,value:void 0}),!(t instanceof X))throw new Error("'inputs' should be an InputsState object");(0,h.Z)(this,ve,t),(0,h.Z)(this,me,null===n?{}:n),(0,h.Z)(this,pe,null===r?{}:r),(0,h.Z)(this,we,!1),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){g((0,v.Z)(this,pe).metrics),g((0,v.Z)(this,pe).filters),g((0,v.Z)(this,pe).metrics_buffer),g((0,v.Z)(this,pe).discard_buffer)}},{key:"valid",value:function(){return(0,v.Z)(this,ve).fetchCountMatrix().has("RNA")}},{key:"fetchParameters",value:function(){var e=(0,Z.Z)({},(0,v.Z)(this,me));return e.species=w.bl(e.species),e}},{key:"fetchDiscards",value:function(){return(0,v.Z)(this,pe).discard_buffer}},{key:"fetchFilters",value:function(){return(0,v.Z)(this,pe).filters}},{key:"fetchMetrics",value:function(){return(0,v.Z)(this,pe).metrics}},{key:"compute",value:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(n){var r,a,s,o,l,u,h,f,d,p,Z,_,b,A,x,E,S,C,I,B,R,F;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.mito_prefix,a=n.nmads,"use_reference_mito"in n?(s=n.automatic,o=n.use_reference_mito,l=n.gene_id_column,u=n.species,h=n.gene_id_type):(s=!0,o=n.use_mito_default,f=e.defaults(),l=f.gene_id_column,u=f.species,h=f.gene_id_type),this.changed=!1,!((0,v.Z)(this,ve).changed||s!==(0,v.Z)(this,me).automatic||o!==(0,v.Z)(this,me).use_reference_mito||!s&&(l!==(0,v.Z)(this,me).gene_id_column||!o&&r!==(0,v.Z)(this,me).mito_prefix||o&&(y(u,(0,v.Z)(this,me).species)||h!==(0,v.Z)(this,me).gene_id_type)))){t.next=30;break}if(g((0,v.Z)(this,pe).metrics),!this.valid()){t.next=29;break}if(d=l,p=u,Z=h,s&&(_=(0,v.Z)(this,ve).guessRnaFeatureTypes(),b=e.configureFeatureParameters(o,_),d=b.gene_id_column,p=b.species,Z=b.gene_id_type),A=(0,v.Z)(this,ve).fetchFeatureAnnotations().RNA,x=null==d?A.rowNames():A.column(d),(E=k(A.numberOfRows(),"Uint8Array",(0,v.Z)(this,pe),"metrics_buffer")).fill(0),null===x){t.next=24;break}if(!o){t.next=23;break}return t.next=18,(0,c.Z)(this,Ze,ge).call(this,p,Z);case 18:S=t.sent,C=E.array(),x.forEach((function(e,t){S.has(e)&&(C[t]=1)})),t.next=24;break;case 23:null!==r&&(I=r.toLowerCase(),C=E.array(),x.forEach((function(e,t){e.toLowerCase().startsWith(I)&&(C[t]=1)})));case 24:B=(0,v.Z)(this,ve).fetchCountMatrix().get("RNA"),(0,v.Z)(this,pe).metrics=m.wj(B,[E]),this.changed=!0,t.next=30;break;case 29:delete(0,v.Z)(this,pe).metrics;case 30:return(0,v.Z)(this,me).automatic=s,(0,v.Z)(this,me).gene_id_column=l,(0,v.Z)(this,me).use_reference_mito=o,(0,v.Z)(this,me).species=w.bl(u),(0,v.Z)(this,me).gene_id_type=h,(0,v.Z)(this,me).mito_prefix=r,(this.changed||a!==(0,v.Z)(this,me).nmads)&&(g((0,v.Z)(this,pe).filters),this.valid()?(R=(0,v.Z)(this,ve).fetchBlock(),(0,v.Z)(this,pe).filters=m.Lw((0,v.Z)(this,pe).metrics,{numberOfMADs:a,block:R}),F=k((0,v.Z)(this,pe).metrics.numberOfCells(),"Uint8Array",(0,v.Z)(this,pe),"discard_buffer"),(0,v.Z)(this,pe).filters.filter((0,v.Z)(this,pe).metrics,{block:R,buffer:F}),this.changed=!0):delete(0,v.Z)(this,pe).filters,(0,v.Z)(this,me).nmads=a),t.abrupt("return");case 38:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}],[{key:"defaults",value:function(){return{automatic:!0,gene_id_column:null,use_reference_mito:!0,species:[],gene_id_type:"ENSEMBL",mito_prefix:"mt-",nmads:3}}},{key:"configureFeatureParameters",value:function(e,t){var n=null,r={type:"symbol",species:"human",confidence:0};if("row_names"in t){var i=t.row_names;i.confidence>r.confidence&&(e||"symbol"==i.type)&&(r=i)}for(var a=0,s=Object.entries(t.columns);a<s.length;a++){var o=(0,p.Z)(s[a],2),l=o[0],u=o[1];u.confidence>r.confidence&&(e||"symbol"==u.type)&&(r=u,n=l)}return{gene_id_column:n,species:[r.species],gene_id_type:r.type.toUpperCase()}}},{key:"flush",value:function(){(0,f.Z)(e,e,ye,{})}},{key:"setDownload",value:function(t){var n=(0,d.Z)(e,e,ke);return(0,f.Z)(e,e,ke,t),n}}]),e}();function ge(e,t){return be.apply(this,arguments)}function be(){return(be=(0,a.Z)((0,i.Z)().mark((function e(t,n){var a,s,o,l,u,c,h,f;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new Set,s=(0,d.Z)(_e,_e,ye),o=(0,r.Z)(t),e.prev=3,o.s();case 5:if((l=o.n()).done){e.next=19;break}if(u=l.value,(c=u+"-mito-"+n.toLowerCase()+".txt.gz")in s){e.next=16;break}return e.next=11,(0,d.Z)(_e,_e,ke).call(_e,de+"/"+c);case 11:return h=e.sent,e.next=14,Q(h,{compression:"gz"});case 14:f=e.sent,s[c]=f;case 16:s[c].forEach((function(e){a.add(e)}));case 17:e.next=5;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(3),o.e(e.t0);case 24:return e.prev=24,o.f(),e.finish(24);case 27:return e.abrupt("return",a);case 28:case"end":return e.stop()}}),e,null,[[3,21,24,27]])})))).apply(this,arguments)}(0,fe.Z)(_e,"mitochondriaSpecies",["9606","10090","6239","10116","9541","7227","7955","9598"]);var ye={writable:!0,value:{}},ke={writable:!0,value:x};var Ae=new WeakMap,xe=new WeakMap,Ee=new WeakMap,Se=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,s.Z)(this,e),(0,u.Z)(this,Ae,{writable:!0,value:void 0}),(0,u.Z)(this,xe,{writable:!0,value:void 0}),(0,u.Z)(this,Ee,{writable:!0,value:void 0}),!(t instanceof X))throw new Error("'inputs' should be a State object from './inputs.js'");(0,h.Z)(this,Ae,t),(0,h.Z)(this,Ee,null===n?{}:n),(0,h.Z)(this,xe,null===r?{}:r),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){g((0,v.Z)(this,xe).metrics),g((0,v.Z)(this,xe).filters),g((0,v.Z)(this,xe).metrics_buffer),g((0,v.Z)(this,xe).discard_buffer)}},{key:"valid",value:function(){return(0,v.Z)(this,Ae).fetchCountMatrix().has("ADT")}},{key:"fetchParameters",value:function(){return(0,Z.Z)({},(0,v.Z)(this,Ee))}},{key:"fetchFilters",value:function(){return(0,v.Z)(this,xe).filters}},{key:"fetchDiscards",value:function(){return(0,v.Z)(this,xe).discard_buffer}},{key:"fetchMetrics",value:function(){return(0,v.Z)(this,xe).metrics}},{key:"compute",value:function(t){var n,r,i=t.igg_prefix,a=t.nmads,s=t.min_detected_drop;if(this.changed=!1,"automatic"in t?(n=t.automatic,r=t.tag_id_column):(n=!0,r=null),(0,v.Z)(this,Ae).changed||n!==(0,v.Z)(this,Ee).automatic||i!==(0,v.Z)(this,Ee).igg_prefix||!n&&r!==(0,v.Z)(this,Ee).tag_id_column)if(g((0,v.Z)(this,xe).metrics),this.valid()){var o=(0,v.Z)(this,Ae).fetchFeatureAnnotations().ADT,l=k(o.numberOfRows(),"Uint8Array",(0,v.Z)(this,xe),"metrics_buffer");if(l.fill(0),null!==i){var u=i.toLowerCase(),c=r;n&&(c=e.configureFeatureParameters(u,o));var h=null==c?o.rowNames():o.column(c);if(null!==h){var f=l.array();h.forEach((function(e,t){e.toLowerCase().startsWith(u)&&(f[t]=1)}))}}var d=(0,v.Z)(this,Ae).fetchCountMatrix().get("ADT");(0,v.Z)(this,xe).metrics=m.vy(d,[l]),this.changed=!0}else delete(0,v.Z)(this,xe).metrics;if((0,v.Z)(this,Ee).automatic=n,(0,v.Z)(this,Ee).tag_id_column=r,(0,v.Z)(this,Ee).igg_prefix=i,this.changed||a!==(0,v.Z)(this,Ee).nmads||s!==(0,v.Z)(this,Ee).min_detected_drop){if(g((0,v.Z)(this,xe).filters),this.valid()){var p=(0,v.Z)(this,Ae).fetchBlock();(0,v.Z)(this,xe).filters=m.nO((0,v.Z)(this,xe).metrics,{numberOfMADs:a,minDetectedDrop:s,block:p});var w=k((0,v.Z)(this,xe).metrics.numberOfCells(),"Uint8Array",(0,v.Z)(this,xe),"discard_buffer");(0,v.Z)(this,xe).filters.filter((0,v.Z)(this,xe).metrics,{block:p,buffer:w}),this.changed=!0}else delete(0,v.Z)(this,xe).filters;(0,v.Z)(this,Ee).nmads=a,(0,v.Z)(this,Ee).min_detected_drop=s}}}],[{key:"defaults",value:function(){return{automatic:!0,tag_id_column:null,igg_prefix:"IgG",nmads:3,min_detected_drop:.1}}},{key:"configureFeatureParameters",value:function(e,t){var n=function(t){var n=0;return t.forEach((function(t){t.toLowerCase().startsWith(e)&&n++})),n},i=null,a=0,s=t.rowNames();null!==s&&(a=n(s));var o,l=(0,r.Z)(t.columnNames());try{for(l.s();!(o=l.n()).done;){var u=o.value,c=n(t.column(u));c>a&&(i=u,a=c)}}catch(h){l.e(h)}finally{l.f()}return i}}]),e}();var Ce=new WeakMap,Ie=new WeakMap,Be=new WeakMap,Re=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,s.Z)(this,e),(0,u.Z)(this,Ce,{writable:!0,value:void 0}),(0,u.Z)(this,Ie,{writable:!0,value:void 0}),(0,u.Z)(this,Be,{writable:!0,value:void 0}),!(t instanceof X))throw new Error("'inputs' should be a State object from './inputs.js'");(0,h.Z)(this,Ce,t),(0,h.Z)(this,Be,null===n?{}:n),(0,h.Z)(this,Ie,null===r?{}:r),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){g((0,v.Z)(this,Ie).metrics),g((0,v.Z)(this,Ie).filters),g((0,v.Z)(this,Ie).metrics_buffer),g((0,v.Z)(this,Ie).discard_buffer)}},{key:"valid",value:function(){return(0,v.Z)(this,Ce).fetchCountMatrix().has("CRISPR")}},{key:"fetchParameters",value:function(){return(0,Z.Z)({},(0,v.Z)(this,Be))}},{key:"fetchFilters",value:function(){return(0,v.Z)(this,Ie).filters}},{key:"fetchDiscards",value:function(){return(0,v.Z)(this,Ie).discard_buffer}},{key:"fetchMetrics",value:function(){return(0,v.Z)(this,Ie).metrics}},{key:"compute",value:function(e){var t=e.nmads;if(this.changed=!1,(0,v.Z)(this,Ce).changed)if(g((0,v.Z)(this,Ie).metrics),this.valid()){var n=(0,v.Z)(this,Ce).fetchCountMatrix().get("CRISPR");(0,v.Z)(this,Ie).metrics=m.J4(n),this.changed=!0}else delete(0,v.Z)(this,Ie).metrics;if(this.changed||t!==(0,v.Z)(this,Be).nmads){if(g((0,v.Z)(this,Ie).filters),this.valid()){var r=(0,v.Z)(this,Ce).fetchBlock();(0,v.Z)(this,Ie).filters=m.XU((0,v.Z)(this,Ie).metrics,{numberOfMADs:t,block:r});var i=k((0,v.Z)(this,Ie).metrics.numberOfCells(),"Uint8Array",(0,v.Z)(this,Ie),"discard_buffer");(0,v.Z)(this,Ie).filters.filter((0,v.Z)(this,Ie).metrics,{block:r,buffer:i}),this.changed=!0}else delete(0,v.Z)(this,Ie).filters;(0,v.Z)(this,Be).nmads=t}}}],[{key:"defaults",value:function(){return{nmads:3}}}]),e}();function Fe(e,t){var n,i=A(e),a=[],s=(0,r.Z)(i);try{for(s.s();!(n=s.n()).done;){var o=n.value;t[o]&&a.push(e[o])}}catch(l){s.e(l)}finally{s.f()}return a}var ze=new WeakMap,Ne=new WeakMap,De=new WeakMap,Me=new WeakMap,Oe=new WeakSet,We=new WeakSet,Qe=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,s.Z)(this,e),(0,l.Z)(this,We),(0,l.Z)(this,Oe),(0,u.Z)(this,ze,{writable:!0,value:void 0}),(0,u.Z)(this,Ne,{writable:!0,value:void 0}),(0,u.Z)(this,De,{writable:!0,value:void 0}),(0,u.Z)(this,Me,{writable:!0,value:void 0}),!(t instanceof X))throw new Error("'inputs' should be an InputsState object");if((0,h.Z)(this,ze,t),!(n.RNA instanceof _e))throw new Error("'qc_states.RNA' should be a RnaQualityControlState object");if(!(n.ADT instanceof Se))throw new Error("'qc_states.ADT' should be a AdtQualityControlState object");if(!(n.CRISPR instanceof Re))throw new Error("'qc_states.CRISPR' should be a CrisprQualityControlState object");(0,h.Z)(this,Ne,n),(0,h.Z)(this,Me,null===r?{}:r),(0,h.Z)(this,De,null===i?{}:i),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){g((0,v.Z)(this,De).block_buffer),g((0,v.Z)(this,De).discard_buffer),g((0,v.Z)(this,De).matrix)}},{key:"fetchFilteredMatrix",value:function(){return"matrix"in(0,v.Z)(this,De)||(0,c.Z)(this,Oe,je).call(this),(0,v.Z)(this,De).matrix}},{key:"fetchFilteredBlock",value:function(){return"block_buffer"in(0,v.Z)(this,De)||(0,c.Z)(this,We,qe).call(this),(0,v.Z)(this,De).block_buffer}},{key:"fetchDiscards",value:function(){return"discard_buffer"in(0,v.Z)(this,De)?(0,v.Z)(this,De).discard_buffer:null}},{key:"fetchParameters",value:function(){return(0,Z.Z)({},(0,v.Z)(this,Me))}},{key:"compute",value:function(e){var t=e.use_rna,n=e.use_adt,i=e.use_crispr;this.changed=!1,(0,v.Z)(this,ze).changed&&(this.changed=!0),(0,v.Z)(this,Me).use_rna===t&&(0,v.Z)(this,Me).use_adt===n&&(0,v.Z)(this,Me).use_crispr===i||((0,v.Z)(this,Me).use_rna=t,(0,v.Z)(this,Me).use_adt=n,(0,v.Z)(this,Me).use_crispr=i,this.changed=!0);var a=Fe((0,v.Z)(this,Ne),{RNA:t,ADT:n,CRISPR:i});if(!this.changed){var s,o=(0,r.Z)(a);try{for(o.s();!(s=o.n()).done;){if(s.value.changed){this.changed=!0;break}}}catch(p){o.e(p)}finally{o.f()}}if(this.changed){if(a.length>0){var l=a[0].fetchDiscards();if(a.length>1){var u=k(l.length,"Uint8Array",(0,v.Z)(this,De),"discard_buffer");u.fill(0);var h,f=u.array(),d=(0,r.Z)(a);try{for(d.s();!(h=d.n()).done;){h.value.fetchDiscards().forEach((function(e,t){f[t]|=e}))}}catch(p){d.e(p)}finally{d.f()}}else g((0,v.Z)(this,De).discard_buffer),(0,v.Z)(this,De).discard_buffer=l.view()}else g((0,v.Z)(this,De).discard_buffer),delete(0,v.Z)(this,De).discard_buffer;(0,c.Z)(this,Oe,je).call(this),(0,c.Z)(this,We,qe).call(this)}}},{key:"applyFilter",value:function(e){if((0,v.Z)(this,ze).fetchCountMatrix().numberOfColumns()!=e.length)throw new Error("length of 'x' should be equal to the number of cells in the unfiltered dataset");if("discard_buffer"in(0,v.Z)(this,De)){var t=(0,v.Z)(this,De).discard_buffer.array();return e.filter((function(e,n){return!t[n]}))}return e.slice()}},{key:"undoFilter",value:function(e){var t,n=this.fetchFilteredMatrix().numberOfColumns(),i=(0,r.Z)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a<0||a>=n)throw new Error("entries of 'indices' should be less than the number of cells in the filtered dataset")}}catch(o){i.e(o)}finally{i.f()}if("discard_buffer"in(0,v.Z)(this,De)){var s=[];(0,v.Z)(this,De).discard_buffer.forEach((function(e,t){0==e&&s.push(t)})),e.forEach((function(t,n){e[n]=s[t]}))}}}],[{key:"defaults",value:function(){return{use_rna:!0,use_adt:!0,use_crispr:!0}}}]),e}();function je(){g((0,v.Z)(this,De).matrix),(0,v.Z)(this,De).matrix=new m.VU;var e,t=(0,v.Z)(this,ze).fetchCountMatrix(),n=(0,r.Z)(t.available());try{for(n.s();!(e=n.n()).done;){var i=e.value,a=t.get(i),s=void 0;s="discard_buffer"in(0,v.Z)(this,De)?m.b_(a,(0,v.Z)(this,De).discard_buffer):a.clone(),(0,v.Z)(this,De).matrix.add(i,s)}}catch(o){n.e(o)}finally{n.f()}}function qe(){g((0,v.Z)(this,De).block_buffer);var e=(0,v.Z)(this,ze).fetchBlock();if(null!==e)if("discard_buffer"in(0,v.Z)(this,De)){var t=k(this.fetchFilteredMatrix().numberOfColumns(),"Int32Array",(0,v.Z)(this,De),"block_buffer");m.fw(e,(0,v.Z)(this,De).discard_buffer,{buffer:t})}else(0,v.Z)(this,De).block_buffer=e.view();else(0,v.Z)(this,De).block_buffer=null}function Ue(e,t,n,r,i){var a=k(n.numberOfColumns(),"Float64Array",r,i),s=t.fetchDiscards(),o=e.fetchMetrics().sums({copy:!1});if(null==s)a.set(o);else{var l=a.array(),u=0;if(s.forEach((function(e,t){if(!e){if(u==a.length)throw new Error("normalization and filtering are not in sync");l[u]=o[t],u++}})),u!==a.length)throw new Error("normalization and filtering are not in sync")}return a}var Te=new WeakMap,Pe=new WeakMap,Ge=new WeakMap,Le=new WeakMap,He=new WeakSet,Ve=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,s.Z)(this,e),(0,l.Z)(this,He),(0,u.Z)(this,Te,{writable:!0,value:void 0}),(0,u.Z)(this,Pe,{writable:!0,value:void 0}),(0,u.Z)(this,Ge,{writable:!0,value:void 0}),(0,u.Z)(this,Le,{writable:!0,value:void 0}),!(t instanceof _e))throw new Error("'qc' should be a RnaQualityControlState object");if((0,h.Z)(this,Te,t),!(n instanceof Qe))throw new Error("'filter' should be a CellFilteringState object");(0,h.Z)(this,Pe,n),(0,h.Z)(this,Ge,null===r?{}:r),(0,h.Z)(this,Le,null===i?{}:i),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){g((0,v.Z)(this,Le).matrix),g((0,v.Z)(this,Le).sum_buffer)}},{key:"valid",value:function(){return(0,v.Z)(this,Pe).fetchFilteredMatrix().has("RNA")}},{key:"fetchNormalizedMatrix",value:function(){return"matrix"in(0,v.Z)(this,Le)||(0,c.Z)(this,He,Ye).call(this),(0,v.Z)(this,Le).matrix}},{key:"fetchSizeFactors",value:function(){var e;return(0,v.Z)(this,Le).sum_buffer&&(e=k((0,v.Z)(this,Le).sum_buffer.length,"Float64Array",(0,v.Z)(this,Le),"centered_buffer"),m.v_((0,v.Z)(this,Le).sum_buffer,{buffer:e,block:(0,v.Z)(this,Pe).fetchFilteredBlock()})),e}},{key:"fetchParameters",value:function(){return(0,Z.Z)({},(0,v.Z)(this,Ge))}},{key:"compute",value:function(e){this.changed=!1,((0,v.Z)(this,Te).changed||(0,v.Z)(this,Pe).changed)&&this.valid()&&(this.changed=!0),this.changed&&(0,c.Z)(this,He,Ye).call(this)}}],[{key:"defaults",value:function(){return{}}}]),e}();function Ye(){var e=(0,v.Z)(this,Pe).fetchFilteredMatrix().get("RNA"),t=Ue((0,v.Z)(this,Te),(0,v.Z)(this,Pe),e,(0,v.Z)(this,Le),"sum_buffer"),n=(0,v.Z)(this,Pe).fetchFilteredBlock();g((0,v.Z)(this,Le).matrix),(0,v.Z)(this,Le).matrix=m.gk(e,{sizeFactors:t,block:n,allowZeros:!0})}var Je=new WeakMap,Xe=new WeakMap,$e=new WeakMap,Ke=new WeakMap,et=new WeakSet,tt=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,s.Z)(this,e),(0,l.Z)(this,et),(0,u.Z)(this,Je,{writable:!0,value:void 0}),(0,u.Z)(this,Xe,{writable:!0,value:void 0}),(0,u.Z)(this,$e,{writable:!0,value:void 0}),(0,u.Z)(this,Ke,{writable:!0,value:void 0}),!(t instanceof Se))throw new Error("'qc' should be a AdtQualityControlState object");if((0,h.Z)(this,Je,t),!(n instanceof Qe))throw new Error("'filter' should be a CellFilteringState object");(0,h.Z)(this,Xe,n),(0,h.Z)(this,$e,null===r?{}:r),(0,h.Z)(this,Ke,null===i?{}:i),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){g((0,v.Z)(this,Ke).matrix),g((0,v.Z)(this,Ke).total_buffer),g((0,v.Z)(this,Ke).sf_buffer),g((0,v.Z)(this,Ke).centered_sf_buffer)}},{key:"valid",value:function(){return(0,v.Z)(this,Xe).fetchFilteredMatrix().has("ADT")}},{key:"fetchNormalizedMatrix",value:function(){return"matrix"in(0,v.Z)(this,Ke)||(0,c.Z)(this,et,nt).call(this),(0,v.Z)(this,Ke).matrix}},{key:"fetchSizeFactors",value:function(){var e;return(0,v.Z)(this,Ke).sf_buffer&&(e=k((0,v.Z)(this,Ke).sf_buffer.length,"Float64Array",(0,v.Z)(this,Ke),"centered_sf_buffer"),m.v_((0,v.Z)(this,Ke).sf_buffer,{buffer:e,block:(0,v.Z)(this,Xe).fetchFilteredBlock()})),e}},{key:"fetchParameters",value:function(){return(0,Z.Z)({},(0,v.Z)(this,$e))}},{key:"compute",value:function(e){var t=e.num_pcs,n=e.num_clusters;if(this.changed=!1,(0,v.Z)(this,Je).changed||(0,v.Z)(this,Xe).changed||t!==(0,v.Z)(this,$e).num_pcs||n!=(0,v.Z)(this,$e).num_clusters){if(this.valid()){var r=(0,v.Z)(this,Xe).fetchFilteredMatrix().get("ADT"),i=Ue((0,v.Z)(this,Je),(0,v.Z)(this,Xe),r,(0,v.Z)(this,Ke),"total_buffer"),a=(0,v.Z)(this,Xe).fetchFilteredBlock(),s=k(r.numberOfColumns(),"Float64Array",(0,v.Z)(this,Ke),"sf_buffer");m.Cb(r,{totals:i,block:a,buffer:s,numberOfPCs:t,numberOfClusters:n}),this.changed=!0}(0,v.Z)(this,$e).num_pcs=t,(0,v.Z)(this,$e).num_clusters=n}this.changed&&this.valid()&&(0,c.Z)(this,et,nt).call(this)}}],[{key:"defaults",value:function(){return{num_pcs:25,num_clusters:20}}}]),e}();function nt(){var e=(0,v.Z)(this,Xe).fetchFilteredMatrix().get("ADT"),t=(0,v.Z)(this,Xe).fetchFilteredBlock(),n=(0,v.Z)(this,Ke).sf_buffer;if(n.length!=e.numberOfColumns())throw new Error("length of size factor vector should equal number of columns after QC");g((0,v.Z)(this,Ke).matrix),(0,v.Z)(this,Ke).matrix=m.gk(e,{sizeFactors:n,block:t,allowZeros:!0})}var rt="crispr_normalization",it=new WeakMap,at=new WeakMap,st=new WeakMap,ot=new WeakMap,lt=new WeakSet,ut=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,s.Z)(this,e),(0,l.Z)(this,lt),(0,u.Z)(this,it,{writable:!0,value:void 0}),(0,u.Z)(this,at,{writable:!0,value:void 0}),(0,u.Z)(this,st,{writable:!0,value:void 0}),(0,u.Z)(this,ot,{writable:!0,value:void 0}),!(t instanceof Re))throw new Error("'qc' should be a CrisprQualityControlState object");if((0,h.Z)(this,it,t),!(n instanceof Qe))throw new Error("'filter' should be a CellFilteringState object");(0,h.Z)(this,at,n),(0,h.Z)(this,st,null===r?{}:r),(0,h.Z)(this,ot,null===i?{}:i),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){g((0,v.Z)(this,ot).matrix),g((0,v.Z)(this,ot).total_buffer),g((0,v.Z)(this,ot).centered_buffer)}},{key:"valid",value:function(){return(0,v.Z)(this,at).fetchFilteredMatrix().has("CRISPR")}},{key:"fetchNormalizedMatrix",value:function(){return"matrix"in(0,v.Z)(this,ot)||(0,c.Z)(this,lt,ct).call(this),(0,v.Z)(this,ot).matrix}},{key:"fetchSizeFactors",value:function(){var e;return(0,v.Z)(this,ot).sum_buffer&&(e=k((0,v.Z)(this,ot).sum_buffer.length,"Float64Array",(0,v.Z)(this,ot),"centered_buffer"),m.v_((0,v.Z)(this,ot).sum_buffer,{buffer:e,block:(0,v.Z)(this,at).fetchFilteredBlock()})),e}},{key:"fetchParameters",value:function(){return(0,Z.Z)({},(0,v.Z)(this,st))}},{key:"compute",value:function(e){this.changed=!1,((0,v.Z)(this,it).changed||(0,v.Z)(this,at).changed)&&this.valid()&&((0,c.Z)(this,lt,ct).call(this),this.changed=!0)}},{key:"serialize",value:function(e){var t=e.createGroup(rt);t.createGroup("parameters"),t.createGroup("results")}}],[{key:"defaults",value:function(){return{}}}]),e}();function ct(){var e=(0,v.Z)(this,at).fetchFilteredMatrix().get("CRISPR"),t=Ue((0,v.Z)(this,it),(0,v.Z)(this,at),e,(0,v.Z)(this,ot),"sum_buffer"),n=(0,v.Z)(this,at).fetchFilteredBlock();g((0,v.Z)(this,ot).matrix),(0,v.Z)(this,ot).matrix=m.gk(e,{sizeFactors:t,block:n,allowZeros:!0})}var ht=new WeakMap,ft=new WeakMap,dt=new WeakMap,vt=new WeakMap,pt=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,s.Z)(this,e),(0,u.Z)(this,ht,{writable:!0,value:void 0}),(0,u.Z)(this,ft,{writable:!0,value:void 0}),(0,u.Z)(this,dt,{writable:!0,value:void 0}),(0,u.Z)(this,vt,{writable:!0,value:void 0}),!(t instanceof Qe))throw new Error("'filter' should be a CellFilteringState object");if((0,h.Z)(this,ht,t),!(n instanceof Ve))throw new Error("'norm' should be an RnaNormalizationState object");(0,h.Z)(this,ft,n),(0,h.Z)(this,vt,null===r?{}:r),(0,h.Z)(this,dt,null===i?{}:i),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){g((0,v.Z)(this,dt).matrix)}},{key:"valid",value:function(){return(0,v.Z)(this,ft).valid()}},{key:"fetchResults",value:function(){return(0,v.Z)(this,dt).results}},{key:"fetchSortedResiduals",value:function(){return(0,v.Z)(this,dt).sorted_residuals}},{key:"fetchParameters",value:function(){return(0,Z.Z)({},(0,v.Z)(this,vt))}},{key:"compute",value:function(e){var t=e.span;if(this.changed=!1,(0,v.Z)(this,ft).changed||t!=(0,v.Z)(this,vt).span){if(g((0,v.Z)(this,dt).results),this.valid()){var n=(0,v.Z)(this,ft).fetchNormalizedMatrix(),r=(0,v.Z)(this,ht).fetchFilteredBlock();(0,v.Z)(this,dt).results=m.rY(n,{span:t,block:r}),(0,v.Z)(this,dt).sorted_residuals=(0,v.Z)(this,dt).results.residuals().slice(),(0,v.Z)(this,dt).sorted_residuals.sort(),this.changed=!0}(0,v.Z)(this,vt).span=t}}}]),e}();var mt=new WeakMap,wt=new WeakMap,Zt=new WeakMap,_t=new WeakMap,gt=new WeakMap,bt=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if((0,s.Z)(this,e),(0,u.Z)(this,mt,{writable:!0,value:void 0}),(0,u.Z)(this,wt,{writable:!0,value:void 0}),(0,u.Z)(this,Zt,{writable:!0,value:void 0}),(0,u.Z)(this,_t,{writable:!0,value:void 0}),(0,u.Z)(this,gt,{writable:!0,value:void 0}),!(t instanceof Qe))throw new Error("'filter' should be a CellFilteringState object");if((0,h.Z)(this,mt,t),!(n instanceof Ve))throw new Error("'norm' should be an RnaNormalizationState object");if((0,h.Z)(this,wt,n),!(r instanceof pt))throw new Error("'feat' should be a FeatureSelectionState object");(0,h.Z)(this,Zt,r),(0,h.Z)(this,gt,null===i?{}:i),(0,h.Z)(this,_t,null===a?{}:a),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){g((0,v.Z)(this,_t).hvg_buffer),g((0,v.Z)(this,_t).pcs)}},{key:"valid",value:function(){return(0,v.Z)(this,wt).valid()}},{key:"fetchPCs",value:function(){return(0,v.Z)(this,_t).pcs}},{key:"fetchParameters",value:function(){return(0,Z.Z)({},(0,v.Z)(this,gt))}},{key:"compute",value:function(e){var t=e.num_hvgs,n=e.num_pcs,r=e.block_method;if(this.changed=!1,((0,v.Z)(this,Zt).changed||t!==(0,v.Z)(this,gt).num_hvgs)&&(this.valid()&&(yt(t,(0,v.Z)(this,Zt),(0,v.Z)(this,_t)),this.changed=!0),(0,v.Z)(this,gt).num_hvgs=t),this.changed||(0,v.Z)(this,wt).changed||n!==(0,v.Z)(this,gt).num_pcs||r!==(0,v.Z)(this,gt).block_method){if(g((0,v.Z)(this,_t).pcs),this.valid()){var i=(0,v.Z)(this,_t).hvg_buffer,a=(0,v.Z)(this,mt).fetchFilteredBlock(),s=(0,v.Z)(this,wt).fetchNormalizedMatrix();(0,v.Z)(this,_t).pcs=m.aG(s,{features:i,numberOfPCs:n,block:a,blockMethod:r}),this.changed=!0}(0,v.Z)(this,gt).num_pcs=n,(0,v.Z)(this,gt).block_method=r}}}],[{key:"defaults",value:function(){return{num_hvgs:2e3,num_pcs:20,block_method:"none"}}}]),e}();function yt(e,t,n){var r=t.fetchSortedResiduals(),i=k(r.length,"Uint8Array",n,"hvg_buffer");if(e<r.length){var a=r[r.length-e],s=t.fetchResults().residuals({copy:!1});i.array().forEach((function(e,t,n){n[t]=s[t]>=a}))}else i.fill(1);return i}var kt=new WeakMap,At=new WeakMap,xt=new WeakMap,Et=new WeakMap,St=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,s.Z)(this,e),(0,u.Z)(this,kt,{writable:!0,value:void 0}),(0,u.Z)(this,At,{writable:!0,value:void 0}),(0,u.Z)(this,xt,{writable:!0,value:void 0}),(0,u.Z)(this,Et,{writable:!0,value:void 0}),!(t instanceof Qe))throw new Error("'filter' should be a CellFilteringState object");if((0,h.Z)(this,kt,t),!(n instanceof tt))throw new Error("'norm' should be a AdtNormalizationState object");(0,h.Z)(this,At,n),(0,h.Z)(this,Et,null===r?{}:r),(0,h.Z)(this,xt,null===i?{}:i),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){g((0,v.Z)(this,xt).pcs)}},{key:"valid",value:function(){return(0,v.Z)(this,At).valid()}},{key:"fetchPCs",value:function(){return(0,v.Z)(this,xt).pcs}},{key:"fetchParameters",value:function(){return(0,Z.Z)({},(0,v.Z)(this,Et))}},{key:"compute",value:function(e){var t=e.num_pcs,n=e.block_method;if(this.changed=!1,(0,v.Z)(this,At).changed||t!==(0,v.Z)(this,Et).num_pcs||n!==(0,v.Z)(this,Et).block_method){if(this.valid()){var r=(0,v.Z)(this,kt).fetchFilteredBlock(),i=(0,v.Z)(this,At).fetchNormalizedMatrix();g((0,v.Z)(this,xt).pcs),(0,v.Z)(this,xt).pcs=m.aG(i,{numberOfPCs:t,block:r,blockMethod:n}),this.changed=!0}(0,v.Z)(this,Et).num_pcs=t,(0,v.Z)(this,Et).block_method=n}}}],[{key:"defaults",value:function(){return{num_pcs:20,block_method:"none"}}}]),e}();var Ct=new WeakMap,It=new WeakMap,Bt=new WeakMap,Rt=new WeakMap,Ft=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,s.Z)(this,e),(0,u.Z)(this,Ct,{writable:!0,value:void 0}),(0,u.Z)(this,It,{writable:!0,value:void 0}),(0,u.Z)(this,Bt,{writable:!0,value:void 0}),(0,u.Z)(this,Rt,{writable:!0,value:void 0}),!(t instanceof Qe))throw new Error("'filter' should be a CellFilteringState object");if((0,h.Z)(this,Ct,t),!(n instanceof ut))throw new Error("'norm' should be a CrisprNormalizationState object");(0,h.Z)(this,It,n),(0,h.Z)(this,Rt,null===r?{}:r),(0,h.Z)(this,Bt,null===i?{}:i),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){g((0,v.Z)(this,Bt).pcs)}},{key:"valid",value:function(){return(0,v.Z)(this,It).valid()}},{key:"fetchPCs",value:function(){return(0,v.Z)(this,Bt).pcs}},{key:"fetchParameters",value:function(){return(0,Z.Z)({},(0,v.Z)(this,Rt))}},{key:"compute",value:function(e){var t=e.num_pcs,n=e.block_method;if(this.changed=!1,(0,v.Z)(this,It).changed||t!==(0,v.Z)(this,Rt).num_pcs||n!==(0,v.Z)(this,Rt).block_method){if(this.valid()){var r=(0,v.Z)(this,Ct).fetchFilteredBlock(),i=(0,v.Z)(this,It).fetchNormalizedMatrix();g((0,v.Z)(this,Bt).pcs),(0,v.Z)(this,Bt).pcs=m.aG(i,{numberOfPCs:t,block:r,blockMethod:n}),this.changed=!0}(0,v.Z)(this,Rt).num_pcs=t,(0,v.Z)(this,Rt).block_method=n}}}],[{key:"defaults",value:function(){return{num_pcs:20,block_method:"none"}}}]),e}();function zt(e,t){var n,i=A(e),a=[],s=(0,r.Z)(i);try{for(s.s();!(n=s.n()).done;){var o=n.value;t[o]>0&&a.push(o)}}catch(l){s.e(l)}finally{s.f()}return a}var Nt=new WeakMap,Dt=new WeakMap,Mt=new WeakMap,Ot=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,s.Z)(this,e),(0,u.Z)(this,Nt,{writable:!0,value:void 0}),(0,u.Z)(this,Dt,{writable:!0,value:void 0}),(0,u.Z)(this,Mt,{writable:!0,value:void 0}),!(t.RNA instanceof bt))throw new Error("'pca_states.RNA' should be an RnaPcaState object");if(!(t.ADT instanceof St))throw new Error("'pca_states.ADT' should be an AdtPcaState object");if(!(t.CRISPR instanceof Ft))throw new Error("'pca_states.CRISPR' should be an CrisprPcaState object");(0,h.Z)(this,Nt,t),(0,h.Z)(this,Dt,null===n?{}:n),(0,h.Z)(this,Mt,null===r?{}:r),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){g((0,v.Z)(this,Mt).combined_buffer)}},{key:"fetchCombined",value:function(){return(0,v.Z)(this,Mt).combined_buffer}},{key:"fetchNumberOfCells",value:function(){return(0,v.Z)(this,Mt).num_cells}},{key:"fetchNumberOfDimensions",value:function(){return(0,v.Z)(this,Mt).total_dims}},{key:"fetchParameters",value:function(){return(0,Z.Z)({},(0,v.Z)(this,Dt))}},{key:"compute",value:function(e){var t=e.rna_weight,n=e.adt_weight,i=e.crispr_weight,a=e.approximate;this.changed=!1;for(var s=0,o=Object.values((0,v.Z)(this,Nt));s<o.length;s++){if(o[s].changed){this.changed=!0;break}}if(a!==(0,v.Z)(this,Dt).approximate&&((0,v.Z)(this,Dt).approximate=a,this.changed=!0),t===(0,v.Z)(this,Dt).rna_weight&&n===(0,v.Z)(this,Dt).adt_weight&&i===(0,v.Z)(this,Dt).crispr_weight||((0,v.Z)(this,Dt).rna_weight=t,(0,v.Z)(this,Dt).adt_weight=n,(0,v.Z)(this,Dt).crispr_weight=i,this.changed=!0),this.changed){var l={RNA:t,ADT:n,CRISPR:i},u=zt((0,v.Z)(this,Nt),l);if(u.length>1){var c,h=u.map((function(e){return l[e]})),f=[],d=0,p=null,w=(0,r.Z)(u);try{for(w.s();!(c=w.n()).done;){var Z=c.value,_=(0,v.Z)(this,Nt)[Z].fetchPCs();if(f.push(_.principalComponents({copy:"view"})),null==p)p=_.numberOfCells();else if(p!==_.numberOfCells())throw new Error("number of cells should be consistent across all embeddings");d+=_.numberOfPCs()}}catch(y){w.e(y)}finally{w.f()}var g=k(p*d,"Float64Array",(0,v.Z)(this,Mt),"combined_buffer");m.jX(f,p,{buffer:g,weights:h,approximate:a}),(0,v.Z)(this,Mt).num_cells=p,(0,v.Z)(this,Mt).total_dims=d}else{var b=(0,v.Z)(this,Nt)[u[0]].fetchPCs();this.constructor.createPcsView((0,v.Z)(this,Mt),b)}}}}],[{key:"defaults",value:function(){return{rna_weight:1,adt_weight:1,crispr_weight:0,approximate:!0}}},{key:"createPcsView",value:function(e,t){g(e.combined_buffer),e.combined_buffer=t.principalComponents({copy:"view"}).view(),e.num_cells=t.numberOfCells(),e.total_dims=t.numberOfPCs()}}]),e}();var Wt=new WeakMap,Qt=new WeakMap,jt=new WeakMap,qt=new WeakMap,Ut=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,s.Z)(this,e),(0,u.Z)(this,Wt,{writable:!0,value:void 0}),(0,u.Z)(this,Qt,{writable:!0,value:void 0}),(0,u.Z)(this,jt,{writable:!0,value:void 0}),(0,u.Z)(this,qt,{writable:!0,value:void 0}),!(t instanceof Qe))throw new Error("'filter' should be a CellFilteringState object");if((0,h.Z)(this,Wt,t),!(n instanceof Ot))throw new Error("'pca' should be a CombineEmbeddingsState object");(0,h.Z)(this,Qt,n),(0,h.Z)(this,jt,null===r?{}:r),(0,h.Z)(this,qt,null===i?{}:i),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){g((0,v.Z)(this,qt).corrected)}},{key:"fetchCorrected",value:function(){return(0,v.Z)(this,qt).corrected}},{key:"fetchNumberOfCells",value:function(){return(0,v.Z)(this,Qt).fetchNumberOfCells()}},{key:"fetchNumberOfDimensions",value:function(){return(0,v.Z)(this,Qt).fetchNumberOfDimensions()}},{key:"fetchParameters",value:function(){return(0,Z.Z)({},(0,v.Z)(this,jt))}},{key:"compute",value:function(e){var t=e.method,n=e.num_neighbors,r=e.approximate;this.changed=!1,((0,v.Z)(this,Wt).changed||(0,v.Z)(this,Qt).changed)&&(this.changed=!0);var i=(0,v.Z)(this,Wt).fetchFilteredBlock(),a="mnn"==t&&null!==i;if((this.changed||t!==(0,v.Z)(this,jt).method||n!==(0,v.Z)(this,jt).num_neighbors||r!==(0,v.Z)(this,jt).approximate)&&a){var s=(0,v.Z)(this,Qt).fetchCombined(),o=k(s.length,"Float64Array",(0,v.Z)(this,qt),"corrected");m.F5(s,i,{k:n,buffer:o,numberOfCells:(0,v.Z)(this,Qt).fetchNumberOfCells(),numberOfDims:(0,v.Z)(this,Qt).fetchNumberOfDimensions(),approximate:r}),this.changed=!0}this.changed&&(a||(g((0,v.Z)(this,qt).corrected),(0,v.Z)(this,qt).corrected=(0,v.Z)(this,Qt).fetchCombined().view())),(0,v.Z)(this,jt).method=t,(0,v.Z)(this,jt).num_neighbors=n,(0,v.Z)(this,jt).approximate=r}}],[{key:"defaults",value:function(){return{method:"mnn",num_neighbors:15,approximate:!0}}}]),e}();var Tt=new WeakMap,Pt=new WeakMap,Gt=new WeakMap,Lt=new WeakSet,Ht=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,s.Z)(this,e),(0,l.Z)(this,Lt),(0,u.Z)(this,Tt,{writable:!0,value:void 0}),(0,u.Z)(this,Pt,{writable:!0,value:void 0}),(0,u.Z)(this,Gt,{writable:!0,value:void 0}),!(t instanceof Ut))throw new Error("'correct' should be a BatchCorrectionState object");(0,h.Z)(this,Tt,t),(0,h.Z)(this,Pt,null===n?{}:n),(0,h.Z)(this,Gt,null===r?{}:r),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){g((0,v.Z)(this,Gt).raw)}},{key:"fetchIndex",value:function(){return"raw"in(0,v.Z)(this,Gt)||(0,c.Z)(this,Lt,Vt).call(this,(0,v.Z)(this,Pt).approximate),(0,v.Z)(this,Gt).raw}},{key:"fetchParameters",value:function(){return(0,Z.Z)({},(0,v.Z)(this,Pt))}},{key:"compute",value:function(e){var t=e.approximate;this.changed=!1,((0,v.Z)(this,Tt).changed||t!=(0,v.Z)(this,Pt).approximate)&&(g((0,v.Z)(this,Gt).raw),(0,c.Z)(this,Lt,Vt).call(this,t),(0,v.Z)(this,Pt).approximate=t,this.changed=!0)}}],[{key:"defaults",value:function(){return{approximate:!0}}}]),e}();function Vt(e){(0,v.Z)(this,Gt).raw=m.Fu((0,v.Z)(this,Tt).fetchCorrected(),{approximate:e,numberOfDims:(0,v.Z)(this,Tt).fetchNumberOfDimensions(),numberOfCells:(0,v.Z)(this,Tt).fetchNumberOfCells()})}var Yt=new WeakMap,Jt=new WeakMap,Xt=new WeakMap,$t=new WeakSet,Kt=new WeakSet,en=new WeakSet,tn=new WeakSet,nn=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,s.Z)(this,e),(0,l.Z)(this,tn),(0,l.Z)(this,en),(0,l.Z)(this,Kt),(0,l.Z)(this,$t),(0,u.Z)(this,Yt,{writable:!0,value:void 0}),(0,u.Z)(this,Jt,{writable:!0,value:void 0}),(0,u.Z)(this,Xt,{writable:!0,value:void 0}),!(t instanceof Ht))throw new Error("'index' should be a State object from './neighbor_index.js'");(0,h.Z)(this,Yt,t),(0,h.Z)(this,Jt,null===n?{}:n),(0,h.Z)(this,Xt,null===r?{}:r),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){g((0,v.Z)(this,Xt).neighbors),g((0,v.Z)(this,Xt).graph),g((0,v.Z)(this,Xt).clusters)}},{key:"fetchClusters",value:function(){if((0,c.Z)(this,$t,rn).call(this))return(0,v.Z)(this,Xt).clusters.membership({copy:"view"});throw"cannot fetch SNN clusters from an invalid state"}},{key:"fetchParameters",value:function(){return(0,Z.Z)({},(0,v.Z)(this,Jt))}},{key:"compute",value:function(e,t){var n=t.k,r=t.scheme,i=t.algorithm,a=t.multilevel_resolution,s=t.leiden_resolution,o=t.walktrap_steps;this.changed=!1,((0,v.Z)(this,Yt).changed||n!==(0,v.Z)(this,Jt).k)&&(g((0,v.Z)(this,Xt).neighbors),e?(0,c.Z)(this,Kt,an).call(this,n):delete(0,v.Z)(this,Xt).neighbors,(0,v.Z)(this,Jt).k=n,this.changed=!0),(this.changed||r!==(0,v.Z)(this,Jt).scheme)&&(g((0,v.Z)(this,Xt).graph),e?(0,c.Z)(this,en,sn).call(this,r):delete(0,v.Z)(this,Xt).graph,(0,v.Z)(this,Jt).scheme=r,this.changed=!0),(this.changed||i!==(0,v.Z)(this,Jt).algorithm||a!==(0,v.Z)(this,Jt).multilevel_resolution||s!==(0,v.Z)(this,Jt).leiden_resolution||o!==(0,v.Z)(this,Jt).walktrap_steps||!(0,c.Z)(this,$t,rn).call(this)&&e)&&(g((0,v.Z)(this,Xt).clusters),e?(0,c.Z)(this,tn,on).call(this,i,a,s,o):delete(0,v.Z)(this,Xt).clusters,(0,v.Z)(this,Jt).algorithm=i,(0,v.Z)(this,Jt).multilevel_resolution=a,(0,v.Z)(this,Jt).leiden_resolution=s,(0,v.Z)(this,Jt).walktrap_steps=o,this.changed=!0)}}],[{key:"defaults",value:function(){return{k:10,scheme:"rank",algorithm:"multilevel",multilevel_resolution:1,leiden_resolution:1,walktrap_steps:4}}}]),e}();function rn(){return"clusters"in(0,v.Z)(this,Xt)}function an(e){(0,v.Z)(this,Xt).neighbors=m.wf((0,v.Z)(this,Yt).fetchIndex(),e)}function sn(e){"neighbors"in(0,v.Z)(this,Xt)||(0,c.Z)(this,Kt,an).call(this,(0,v.Z)(this,Jt).k),(0,v.Z)(this,Xt).graph=m.bD((0,v.Z)(this,Xt).neighbors,{scheme:e})}function on(e,t,n,r){"graph"in(0,v.Z)(this,Xt)||(0,c.Z)(this,en,sn).call(this,(0,v.Z)(this,Jt).scheme),(0,v.Z)(this,Xt).clusters=m.ZI((0,v.Z)(this,Xt).graph,{method:e,multiLevelResolution:t,leidenResolution:n,leidenModularityObjective:!0,walktrapSteps:r})}var ln={min:0,mean:1,min_rank:4};function un(e){if(e){for(var t=0,n=Object.values(e);t<n.length;t++)for(var r=n[t],i=0,a=Object.values(r);i<a.length;i++)for(var s=a[i],o=0,l=Object.values(s);o<l.length;o++){var u=l[o];m.gd(u)}for(var c=0,h=Object.keys(e);c<h.length;c++){delete e[h[c]]}}}var cn=new WeakMap,hn=new WeakMap,fn=new WeakMap,dn=new WeakSet,vn=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,s.Z)(this,e),(0,l.Z)(this,dn),(0,u.Z)(this,cn,{writable:!0,value:void 0}),(0,u.Z)(this,hn,{writable:!0,value:void 0}),(0,u.Z)(this,fn,{writable:!0,value:void 0}),!(t instanceof Ut))throw new Error("'correct' should be a BatchCorrectionState object");(0,h.Z)(this,cn,t),(0,h.Z)(this,hn,null===n?{}:n),(0,h.Z)(this,fn,null===r?{}:r),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){g((0,v.Z)(this,fn).raw)}},{key:"fetchClusters",value:function(){if((0,c.Z)(this,dn,pn).call(this))return(0,v.Z)(this,fn).raw.clusters({copy:"view"});throw new Error("cannot fetch k-means clusters from an invalid state")}},{key:"fetchParameters",value:function(){return(0,Z.Z)({},(0,v.Z)(this,hn))}},{key:"compute",value:function(e,t){var n=t.k;if(this.changed=!1,(0,v.Z)(this,cn).changed||n!=(0,v.Z)(this,hn).k||!(0,c.Z)(this,dn,pn).call(this)&&e){if(g((0,v.Z)(this,fn).raw),e){var r=(0,v.Z)(this,cn).fetchCorrected();(0,v.Z)(this,fn).raw=m.eu(r,n,{numberOfDims:(0,v.Z)(this,cn).fetchNumberOfDimensions(),numberOfCells:(0,v.Z)(this,cn).fetchNumberOfCells(),initMethod:"pca-part"})}else delete(0,v.Z)(this,fn).raw;(0,v.Z)(this,hn).k=n,this.changed=!0}}}]),e}();function pn(){return"raw"in(0,v.Z)(this,fn)}var mn=new WeakMap,wn=new WeakMap,Zn=new WeakMap,_n=new WeakMap,gn=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,s.Z)(this,e),(0,u.Z)(this,mn,{writable:!0,value:void 0}),(0,u.Z)(this,wn,{writable:!0,value:void 0}),(0,u.Z)(this,Zn,{writable:!0,value:void 0}),(0,u.Z)(this,_n,{writable:!0,value:void 0}),!(t instanceof nn))throw new Error("'snn' should be a State object from './snn_graph_cluster.js'");if((0,h.Z)(this,mn,t),!(n instanceof vn))throw new Error("'kmeans' should be a State object from './kmeans_cluster.js'");(0,h.Z)(this,wn,n),(0,h.Z)(this,Zn,null===r?{}:r),(0,h.Z)(this,_n,null===i?{}:i),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){}},{key:"fetchClusters",value:function(){return"snn_graph"==(0,v.Z)(this,Zn).method?(0,v.Z)(this,mn).fetchClusters():"kmeans"==(0,v.Z)(this,Zn).method?(0,v.Z)(this,wn).fetchClusters():void 0}},{key:"fetchParameters",value:function(){return(0,Z.Z)({},(0,v.Z)(this,Zn))}},{key:"compute",value:function(e){var t=e.method;this.changed=!0,t==(0,v.Z)(this,Zn).method&&("snn_graph"==t?(0,v.Z)(this,mn).changed||(this.changed=!1):"kmeans"==t&&((0,v.Z)(this,wn).changed||(this.changed=!1))),(0,v.Z)(this,Zn).method=t}}]),e}();function bn(e){for(var t=0,n=Object.values(e.raw);t<n.length;t++){g(n[t])}e.raw={},un(e.versus),delete e.versus}function yn(e,t,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=a.cache,o=void 0===s?{}:s,l=a.block,u=void 0===l?null:l,c=a.lfc_threshold,h=void 0===c?0:c,f=a.compute_auc,d=void 0===f||f,v=function(e,t,n){var r=e<t,i=r?t:e;i in n||(n[i]={});var a=n[i],s=r?e:t,o=!(s in a);return o&&(a[s]={}),{cached:a[s],run:o,left_small:r}}(e,t,o),p=v.left_small?0:1,w=v.left_small?1:0;if(v.run){var Z=[],_=[],g=!1,b=!1;if(i.forEach((function(n,r){n==e?(Z.push(p),_.push(r),g=!0):n==t&&(Z.push(w),_.push(r),b=!0)})),!g||!b)throw new Error("non-zero entries should be present for both requested clusters in versus mode");!function(e,t,n,i,a,s,o){var l=null;null!==n&&(l=m.DS(n,i),m.D4(l));var u,c=(0,r.Z)(e.available());try{for(c.s();!(u=c.n()).done;){var h=u.value,f=e.get(h),d=void 0;try{d=m.ZW(f,i),a[h]=m.y5(d,t,{block:l,lfcThreshold:s,computeAuc:o})}finally{m.gd(d)}}}catch(v){c.e(v)}finally{c.f()}}(n,Z,u,_,v.cached,h,d)}return{results:v.cached,left:p,right:w}}var kn=new WeakMap,An=new WeakMap,xn=new WeakMap,En=new WeakMap,Sn=new WeakMap,Cn=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if((0,s.Z)(this,e),(0,u.Z)(this,kn,{writable:!0,value:void 0}),(0,u.Z)(this,An,{writable:!0,value:void 0}),(0,u.Z)(this,xn,{writable:!0,value:void 0}),(0,u.Z)(this,En,{writable:!0,value:void 0}),(0,u.Z)(this,Sn,{writable:!0,value:void 0}),!(t instanceof Qe))throw new Error("'filter' should be a State object from './cell_filtering.js'");if((0,h.Z)(this,kn,t),!(n.RNA instanceof Ve))throw new Error("'norm_states.RNA' should be an RnaNormalizationState object");if(!(n.ADT instanceof tt))throw new Error("'norm_states.ADT' should be an AdtNormalizationState object");if(!(n.CRISPR instanceof ut))throw new Error("'norm_states.CRISPR' should be an CrisprNormalizationState object");if((0,h.Z)(this,An,n),!(r instanceof gn))throw new Error("'choice' should be a State object from './choose_clustering.js'");(0,h.Z)(this,xn,r),(0,h.Z)(this,En,null===i?{}:i),(0,h.Z)(this,Sn,null===a?{raw:{}}:a),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){bn((0,v.Z)(this,Sn))}},{key:"fetchResults",value:function(){return(0,v.Z)(this,Sn).raw}},{key:"fetchParameters",value:function(){return(0,Z.Z)({},(0,v.Z)(this,En))}},{key:"compute",value:function(e){var t=e.lfc_threshold,n=e.compute_auc;this.changed=!1;for(var r=t!==(0,v.Z)(this,En).lfc_threshold||n!==(0,v.Z)(this,En).compute_auc,i=0,a=Object.entries((0,v.Z)(this,An));i<a.length;i++){var s=(0,p.Z)(a[i],2),o=s[0],l=s[1];if(l.valid()&&((0,v.Z)(this,xn).changed||l.changed||r)){var u=l.fetchNormalizedMatrix(),c=(0,v.Z)(this,xn).fetchClusters(),h=(0,v.Z)(this,kn).fetchFilteredBlock();g((0,v.Z)(this,Sn).raw[o]),(0,v.Z)(this,Sn).raw[o]=m.y5(u,c,{block:h,lfcThreshold:t,computeAuc:n}),this.changed=!0}}(0,v.Z)(this,En).lfc_threshold=t,(0,v.Z)(this,En).compute_auc=n,this.changed&&un((0,v.Z)(this,Sn).versus)}},{key:"computeVersus",value:function(e,t){for(var n=(0,v.Z)(this,xn).fetchClusters(),r=(0,v.Z)(this,kn).fetchFilteredBlock(),i=new m.VU,a=0,s=Object.entries((0,v.Z)(this,An));a<s.length;a++){var o=(0,p.Z)(s[a],2),l=o[0],u=o[1];u.valid()&&i.add(l,u.fetchNormalizedMatrix())}return"versus"in(0,v.Z)(this,Sn)||((0,v.Z)(this,Sn).versus={}),yn(e,t,i,n,{cache:(0,v.Z)(this,Sn).versus,block:r,lfc_threshold:(0,v.Z)(this,En).lfc_threshold,compute_auc:(0,v.Z)(this,En).compute_auc})}}],[{key:"defaults",value:function(){return{lfc_threshold:0,compute_auc:!0}}},{key:"computeVersusCustom",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=i.cache,s=void 0===a?{}:a,o=i.block,l=void 0===o?null:o,u=i.lfc_threshold,c=void 0===u?0:u,h=i.compute_auc;return computeVersus(e,t,n,r,{cache:s,block:l,lfc_threshold:c,compute_auc:void 0===h||h})}}]),e}();var In="https://github.com/LTLA/kana-feature-sets/releases/download/v1.0.0",Bn=new WeakMap,Rn=new WeakMap,Fn=function(){function e(){(0,s.Z)(this,e),(0,u.Z)(this,Bn,{writable:!0,value:void 0}),(0,u.Z)(this,Rn,{writable:!0,value:void 0}),(0,h.Z)(this,Bn,{}),(0,h.Z)(this,Rn,{})}return(0,o.Z)(e,[{key:"free",value:function(){(0,h.Z)(this,Bn,{}),g((0,v.Z)(this,Rn).set_buffer)}},{key:"prepareCollections",value:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(n,a,s,o,l){var u,c,f,d,p,m,w,Z,g;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:u=new Set,c=(0,r.Z)(s);try{for(c.s();!(f=c.n()).done;)(d=f.value)in e.availableCollections&&e.availableCollections[d].forEach((function(e){return u.add(e)}))}catch(i){c.e(i)}finally{c.f()}(0,h.Z)(this,Bn,{}),p=(0,r.Z)(a),t.prev=5,p.s();case 7:if((m=p.n()).done){t.next=18;break}if(w=m.value,u.has(w)){t.next=11;break}return t.abrupt("continue",16);case 11:return t.next=13,(0,_.Z)(e,e,zn).call(e,w);case 13:Z=t.sent,g=(0,_.Z)(e,e,Dn).call(e,n,w,o,l),(0,v.Z)(this,Bn)[w]={names:Z.names,descriptions:Z.descriptions,indices:g.target_indices,sets:g.sets,sizes:g.sizes};case 16:t.next=7;break;case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(5),p.e(t.t0);case 23:return t.prev=23,p.f(),t.finish(23);case 26:return t.abrupt("return");case 27:case"end":return t.stop()}}),t,this,[[5,20,23,26]])})));return function(e,n,r,i,a){return t.apply(this,arguments)}}()},{key:"fetchCollectionDetails",value:function(){for(var e={},t=0,n=Object.entries((0,v.Z)(this,Bn));t<n.length;t++){var r=(0,p.Z)(n[t],2),i=r[0],a=r[1];e[i]={names:a.names,descriptions:a.descriptions,sizes:a.sizes,universe:a.indices.length}}return e}},{key:"computeEnrichment",value:function(e,t,n,r,i){"delta_detected"==t&&(t="deltaDetected");for(var a="auc"==t?.5:0,s="min_rank"!==t,o=ln[n],l={},u=function(){var n=(0,p.Z)(h[c],2),u=n[0],f=n[1],d=r[t](e,{summary:o,copy:!1}),v=w.Nd(d,f.indices),Z=m.Y8(v,i,{largest:s}),_=[];s?(Z<a&&(Z=a),v.forEach((function(e,t){e>=Z&&_.push(t)}))):v.forEach((function(e,t){e<=Z&&_.push(t)}));var g=m.I9(_,f.sets,v.length);l[u]={counts:g.count,pvalues:g.pvalue,num_markers:_.length}},c=0,h=Object.entries((0,v.Z)(this,Bn));c<h.length;c++)u();return l}},{key:"fetchFeatureSetIndices",value:function(e,t){var n=(0,v.Z)(this,Bn)[e],r=n.sets[t],i=n.indices;return w.Nd(i,r)}},{key:"computePerCellScores",value:function(e,t,n,r){var i=this.fetchFeatureSetIndices(e,t),a=k(n.numberOfRows(),"Uint8Array",(0,v.Z)(this,Rn),"set_buffer");a.fill(0);var s=a.array();return i.forEach((function(e){s[e]=1})),m.Bs(n,a,{block:r})}}],[{key:"flush",value:function(){e.all_loaded={}}},{key:"setDownload",value:function(t){var n=(0,d.Z)(e,e,On);return(0,f.Z)(e,e,On,t),n}}]),e}();function zn(e){return Nn.apply(this,arguments)}function Nn(){return Nn=(0,a.Z)((0,i.Z)().mark((function e(t){var n,s,o,l,u,c,h,f,v,p,m,w,Z,_,g,b,y,k,A,x,E,S,C,I;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t in(0,d.Z)(Fn,Fn,Mn)){e.next=23;break}return n=["features.csv.gz","sets.txt.gz"],e.next=4,Promise.all(n.map(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(n){var r,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t+"_"+n,e.next=3,(0,d.Z)(Fn,Fn,On).call(Fn,In+"/"+r);case 3:return a=e.sent,e.abrupt("return",new R(a,{name:r}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:return s=e.sent,o={},e.next=8,q(s[0].content(),{delim:","});case 8:l=e.sent,u=l.shift(),c=(0,r.Z)(u);try{for(c.s();!(h=c.n()).done;)f=h.value,o[f]=[]}catch(B){c.e(B)}finally{c.f()}v=(0,r.Z)(l);try{for(v.s();!(p=v.n()).done;)for(m=p.value,w=0;w<u.length;w++)Z=m[w],o[u[w]].push(""==Z?null:Z)}catch(B){v.e(B)}finally{v.f()}return _=[],g=[],b=[],e.next=19,Q(s[1].content());case 19:y=e.sent,k=(0,r.Z)(y);try{for(k.s();!(A=k.n()).done;){for(x=A.value,E=x.split("\t"),g.push(E[0]),b.push(E[1]),S=Number(E[2]),C=[S],w=3;w<E.length;w++)I=Number(E[w])+S,C.push(I),S=I;_.push(C)}}catch(B){k.e(B)}finally{k.f()}(0,d.Z)(Fn,Fn,Mn)[t]={features:o,members:_,names:g,descriptions:b};case 23:return e.abrupt("return",(0,d.Z)(Fn,Fn,Mn)[t]);case 24:case"end":return e.stop()}}),e)}))),Nn.apply(this,arguments)}function Dn(e,t,n,r){var i;if(null==n){if(null==(i=e.rowNames()))throw new Error("no row names available in the feature annotations")}else i=e.column(n);var a=(0,d.Z)(Fn,Fn,Mn)[t];if(!(r in a.features))throw new Error("no column '"+r+"' in the feature set annotations");var s=m.uv(i,a.features[r],a.members),o=new Int32Array(s.sets.length);return s.sets.forEach((function(e,t){o[t]=e.length})),s.sizes=o,s}var Mn={writable:!0,value:{}};(0,fe.Z)(Fn,"availableCollections",{10090:["mouse-GO"],9606:["human-GO"],6239:["worm-GO"],10116:["rat-GO"],7227:["fly-GO"],7955:["zebrafish-GO"],9598:["chimp-GO"]});var On={writable:!0,value:x};function Wn(e){var t=null,n={type:"symbol",species:"human",confidence:0};if("row_names"in e){var r=e.row_names;r.confidence>n.confidence&&(n=r)}for(var i=0,a=Object.entries(e.columns);i<a.length;i++){var s=(0,p.Z)(a[i],2),o=s[0],l=s[1];l.confidence>n.confidence&&(n=l,t=o)}return{gene_id_column:t,gene_id_type:n.type.toUpperCase(),species:[n.species]}}function Qn(e,t,n,r,i,a,s,o,l){return jn.apply(this,arguments)}function jn(){return(jn=(0,a.Z)((0,i.Z)().mark((function e(t,n,r,a,s,o,l,u,c){var h,f,d,v;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!y(t.collections,r)&&a===t.automatic&&(a||t.gene_id_column===o&&t.gene_id_type===l&&!y(t.species,s))){e.next=8;break}return h=o,f=l,d=s,a&&(v=Wn(c()),h=v.gene_id_column,f=v.gene_id_type,d=v.species),e.next=7,n.prepareCollections(u(),r,d,h,f);case 7:return e.abrupt("return",!0);case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qn(e,t,n,r,i,a,s){e.automatic=n,e.species=w.bl(r),e.collections=w.bl(t),e.gene_id_column=i,e.gene_id_type=a,e.top_markers=s}function Un(e){var t=(0,Z.Z)({},e);return t.species=w.bl(t.species),t.collections=w.bl(t.collections),t}var Tn=new WeakMap,Pn=new WeakMap,Gn=new WeakMap,Ln=new WeakMap,Hn=new WeakMap,Vn=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if((0,s.Z)(this,e),(0,u.Z)(this,Tn,{writable:!0,value:void 0}),(0,u.Z)(this,Pn,{writable:!0,value:void 0}),(0,u.Z)(this,Gn,{writable:!0,value:void 0}),(0,u.Z)(this,Ln,{writable:!0,value:void 0}),(0,u.Z)(this,Hn,{writable:!0,value:void 0}),!(t instanceof X))throw new Error("'inputs' should be a State object from './inputs.js'");if((0,h.Z)(this,Tn,t),!(n instanceof Qe))throw new Error("'filter' should be a CellFilteringState object");if((0,h.Z)(this,Pn,n),!(r instanceof Ve))throw new Error("'normalized' should be a RnaNormalizationState object from './rna_normalization.js'");(0,h.Z)(this,Gn,r),(0,h.Z)(this,Ln,null===a?{}:a),(0,h.Z)(this,Hn,new Fn),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){(0,v.Z)(this,Hn).free()}},{key:"valid",value:function(){return(0,v.Z)(this,Tn).fetchCountMatrix().has("RNA")}},{key:"fetchCollectionDetails",value:function(){return(0,v.Z)(this,Hn).fetchCollectionDetails()}},{key:"computeEnrichment",value:function(e,t,n,r){return(0,v.Z)(this,Hn).computeEnrichment(t,n,r,e,(0,v.Z)(this,Ln).top_markers)}},{key:"fetchFeatureSetIndices",value:function(e,t){return(0,v.Z)(this,Hn).fetchFeatureSetIndices(e,t)}},{key:"computePerCellScores",value:function(e,t){return(0,v.Z)(this,Hn).computePerCellScores(e,t,(0,v.Z)(this,Gn).fetchNormalizedMatrix(),(0,v.Z)(this,Pn).fetchFilteredBlock())}},{key:"fetchPerCellScores",value:function(e,t){return this.computePerCellScores(e,t)}},{key:"fetchParameters",value:function(){return Un((0,v.Z)(this,Ln))}},{key:"compute",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r,a,s,o,l,u=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.collections,r=t.automatic,a=t.species,s=t.gene_id_column,o=t.gene_id_type,l=t.top_markers,this.changed=!1,(0,v.Z)(this,Tn).changed&&(this.changed=!0),!this.valid()){e.next=9;break}return e.next=6,Qn((0,v.Z)(this,Ln),(0,v.Z)(this,Hn),n,r,a,s,o,(function(){return(0,v.Z)(u,Tn).fetchFeatureAnnotations().RNA}),(function(){return(0,v.Z)(u,Tn).guessRnaFeatureTypes()}));case 6:e.sent&&(this.changed=!0),l!==(0,v.Z)(this,Ln).top_markers&&(this.changed=!0);case 9:return qn((0,v.Z)(this,Ln),n,r,a,s,o,l),e.abrupt("return");case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"defaults",value:function(){return{collections:[],automatic:!0,gene_id_column:null,gene_id_type:"ENSEMBL",top_markers:100}}},{key:"flush",value:function(){Fn.flush()}},{key:"setDownload",value:function(e){return Fn.setDownload(e)}}]),e}();(0,fe.Z)(Vn,"availableCollections",Fn.availableCollections);var Yn=n(9062),Jn="https://github.com/LTLA/singlepp-references/releases/download/v2.0.0",Xn=new WeakMap,$n=new WeakMap,Kn=new WeakMap,er=new WeakMap,tr=new WeakSet,nr=new WeakSet,rr=new WeakSet,ir=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,s.Z)(this,e),(0,l.Z)(this,rr),(0,l.Z)(this,nr),(0,l.Z)(this,tr),(0,u.Z)(this,Xn,{writable:!0,value:void 0}),(0,u.Z)(this,$n,{writable:!0,value:void 0}),(0,u.Z)(this,Kn,{writable:!0,value:void 0}),(0,u.Z)(this,er,{writable:!0,value:void 0}),!(t instanceof X))throw new Error("'inputs' should be a State object from './inputs.js'");if((0,h.Z)(this,Xn,t),!(n instanceof Cn))throw new Error("'markers' should be a State object from './marker_detection.js'");(0,h.Z)(this,$n,n),(0,h.Z)(this,Kn,null===r?{}:r),(0,h.Z)(this,er,null===i?{}:i),this.changed=!1}return(0,o.Z)(e,[{key:"free",value:function(){g((0,v.Z)(this,er).buffer),(0,c.Z)(this,tr,ar).call(this)}},{key:"valid",value:function(){return(0,v.Z)(this,Xn).fetchCountMatrix().has("RNA")}},{key:"fetchParameters",value:function(){var e=(0,Z.Z)({},(0,v.Z)(this,Kn));return e.references=w.bl(e.references),e.species=w.bl(e.species),e}},{key:"fetchResults",value:function(){for(var e={},t=0,n=Object.entries((0,v.Z)(this,er).results);t<n.length;t++){var r=(0,p.Z)(n[t],2),i=r[0],a=r[1];e[i]=a}var s={per_reference:e};return"integrated_results"in(0,v.Z)(this,er)&&(s.integrated=(0,v.Z)(this,er).integrated_results),s}},{key:"fetchNumberOfSharedFeatures",value:function(){for(var e={},t=0,n=Object.keys((0,v.Z)(this,er).results);t<n.length;t++){var r=n[t];e[r]=(0,v.Z)(this,er).prepared[r].built.raw.sharedFeatures()}return e}},{key:"compute",value:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(n){var a,s,o,l,u,h,f,d,Z,_,b,A,x,E,S,C,I,B,R,F,z,N,D,M,O,W,Q,j,q,U,T,P,G,L,H,V,Y,J,X,$,K,ee,te,ne,re,ie,ae,se,oe,le=this;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("references"in n?(a=n.references,s=n.automatic,o=n.species,l=n.gene_id_column,u=n.gene_id_type):(a=[].concat((0,Yn.Z)(n.human_references),(0,Yn.Z)(n.mouse_references)),s=!0,h=e.defaults(),o=h.species,l=h.gene_id_column,u=h.gene_id_type),this.changed=!1,!this.valid()){t.next=49;break}if(!(0,v.Z)(this,Xn).changed&&s===(0,v.Z)(this,Kn).automatic&&!y(a,(0,v.Z)(this,Kn).references)&&(s||o===(0,v.Z)(this,Kn).species&&l===(0,v.Z)(this,Kn).gene_id_column&&u===(0,v.Z)(this,Kn).gene_id_type)){t.next=41;break}f=o,d=l,Z=u,s&&(_=(0,v.Z)(this,Xn).guessRnaFeatureTypes(),b=e.configureFeatureParameters(_),f=b.species,d=b.gene_id_column,Z=b.gene_id_type),A=new Set,x=(0,r.Z)(f);try{for(x.s();!(E=x.n()).done;)(S=E.value)in e.availableReferences&&e.availableReferences[S].forEach((function(e){A.add(e)}))}catch(i){x.e(i)}finally{x.f()}if(C=(0,v.Z)(this,Xn).fetchFeatureAnnotations().RNA,I=null==d?C.rowNames():C.column(d),(0,v.Z)(this,er).gene_ids=I,B={},null===I){t.next=35;break}R=(0,r.Z)(a),t.prev=17,R.s();case 19:if((F=R.n()).done){t.next=27;break}if(z=F.value,!A.has(z)){t.next=25;break}return t.next=24,(0,c.Z)(this,nr,sr).call(this,z);case 24:B[z]=(0,c.Z)(this,rr,lr).call(this,z,I,Z);case 25:t.next=19;break;case 27:t.next=32;break;case 29:t.prev=29,t.t0=t.catch(17),R.e(t.t0);case 32:return t.prev=32,R.f(),t.finish(32);case 35:(0,c.Z)(this,tr,ar).call(this),(0,v.Z)(this,er).prepared=B,(N=Object.keys(B)).length>1?(D=Object.values(B),M=D.map((function(e){return e.loaded.raw})),O=D.map((function(e){return e.built.features})),W=D.map((function(e){return e.built.raw})),g((0,v.Z)(this,er).integrated),(0,v.Z)(this,er).integrated=m.Qj(I,M,O,W)):(g((0,v.Z)(this,er).integrated),delete(0,v.Z)(this,er).integrated),(0,v.Z)(this,er).used_refs=N,this.changed=!0;case 41:if(Q=(0,v.Z)(this,$n).fetchResults().RNA,j=Q.numberOfGroups(),q=null!==(0,v.Z)(this,er).gene_ids?(0,v.Z)(this,er).gene_ids.length:null,U=(0,v.Z)(this,er).buffer,(0,v.Z)(this,$n).changed){if(null!==q)for(U=k(j*q,"Float64Array",(0,v.Z)(this,er)),T=0;T<j;T++)P=Q.means(T,{copy:!1}),U.array().set(P,T*q);this.changed=!0}if(this.changed){for(G=(0,v.Z)(this,er).prepared,(0,v.Z)(this,er).results={},L=0,H=Object.entries(G);L<H.length;L++){V=(0,p.Z)(H[L],2),Y=V[0],J=V[1],X=m.pG(U,J.built.raw,{numberOfFeatures:q,numberOfCells:j}),$=[],K=(0,r.Z)(X);try{for(K.s();!(ee=K.n()).done;)te=ee.value,$.push(J.loaded.labels[te])}catch(i){K.e(i)}finally{K.f()}(0,v.Z)(this,er).results[Y]=$}if("integrated"in(0,v.Z)(this,er)){ne=[],re=(0,r.Z)((0,v.Z)(this,er).used_refs);try{for(re.s();!(ie=re.n()).done;)ae=ie.value,ne.push((0,v.Z)(this,er).results[ae])}catch(i){re.e(i)}finally{re.f()}se=m.Os(U,ne,(0,v.Z)(this,er).integrated,{numberOfFeatures:q,numberOfCells:j}),oe=[],se.forEach((function(e){oe.push((0,v.Z)(le,er).used_refs[e])})),(0,v.Z)(this,er).integrated_results=oe}else delete(0,v.Z)(this,er).integrated_results}t.next=51;break;case 49:(0,v.Z)(this,er).results={},delete(0,v.Z)(this,er).integrated_results;case 51:return(0,v.Z)(this,Kn).references=w.bl(a),(0,v.Z)(this,Kn).automatic=s,(0,v.Z)(this,Kn).species=w.bl(o),(0,v.Z)(this,Kn).gene_id_column=l,(0,v.Z)(this,Kn).gene_id_type=u,t.abrupt("return");case 57:case"end":return t.stop()}}),t,this,[[17,29,32,35]])})));return function(e){return t.apply(this,arguments)}}()}],[{key:"defaults",value:function(){return{references:[],automatic:!0,species:[],gene_id_column:null,gene_id_type:"ENSEMBL"}}},{key:"configureFeatureParameters",value:function(e){var t=null,n={type:"symbol",species:"human",confidence:0};if("row_names"in e){var r=e.row_names;r.confidence>n.confidence&&(n=r)}for(var i=0,a=Object.entries(e.columns);i<a.length;i++){var s=(0,p.Z)(a[i],2),o=s[0],l=s[1];l.confidence>n.confidence&&(n=l,t=o)}return{gene_id_column:t,species:[n.species],gene_id_type:n.type.toUpperCase()}}},{key:"flush",value:function(){for(var t=0,n=Object.entries((0,d.Z)(e,e,ur));t<n.length;t++){var r=(0,p.Z)(n[t],2);r[0];r[1].raw.free()}(0,f.Z)(e,e,ur,{})}},{key:"setDownload",value:function(t){var n=(0,d.Z)(e,e,cr);return(0,f.Z)(e,e,cr,t),n}}]),e}();function ar(){if("prepared"in(0,v.Z)(this,er)){for(var e=0,t=Object.values((0,v.Z)(this,er).prepared);e<t.length;e++){t[e].built.raw.free()}delete(0,v.Z)(this,er).prepared}}function sr(e){return or.apply(this,arguments)}function or(){return or=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r,s,o,l,u,c,h,f,v;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(0,d.Z)(ir,ir,ur),!(t in n)){e.next=3;break}return e.abrupt("return");case 3:return r=["genes.csv.gz","labels_fine.csv.gz","label_names_fine.csv.gz","markers_fine.gmt.gz","matrix.csv.gz"],e.next=6,Promise.all(r.map(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(n){var r,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t+"_"+n,e.next=3,(0,d.Z)(ir,ir,cr).call(ir,Jn+"/"+r);case 3:return a=e.sent,e.abrupt("return",new R(a,{name:r}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:return s=e.sent,e.prev=7,o=m.tY(s[4].buffer(),s[3].buffer(),s[1].buffer()),e.next=11,Q(s[0].content(),{compression:"gz"});case 11:return l=e.sent,u=[],c=[],h=[],f=function(e){return""==e?null:e},l.forEach((function(e){var t=e.split(",");u.push(f(t[0])),c.push(f(t[1])),h.push(f(t[2]))})),e.next=19,Q(s[2].content(),{compression:"gz"});case 19:v=e.sent,n[t]={raw:o,genes:{ENSEMBL:u,SYMBOL:c,ENTREZ:h},labels:v},e.next=27;break;case 23:throw e.prev=23,e.t0=e.catch(7),g(o),e.t0;case 27:case"end":return e.stop()}}),e,null,[[7,23]])}))),or.apply(this,arguments)}function lr(e,t,n){var r,i;try{var a=(0,d.Z)(ir,ir,ur)[e],s=a.raw;if(!(n in a.genes))throw new Error("unknown gene type '"+n+"'");var o=a.genes[n];i={loaded:a,built:{features:o,raw:r=m.St(t,s,o)}}}catch(l){throw g(r),l}return i}(0,fe.Z)(ir,"availableReferences",{9606:["BlueprintEncode","DatabaseImmuneCellExpression","HumanPrimaryCellAtlas","MonacoImmune","NovershternHematopoietic"],10090:["ImmGen","MouseRNAseq"]});var ur={writable:!0,value:{}},cr={writable:!0,value:x};var hr=n(6737);hr.yh.prototype._bioconductor_LENGTH=function(){return this.length},hr.do.prototype._bioconductor_LENGTH=function(){return this.length},hr.lt.prototype._bioconductor_LENGTH=function(){return this.length};n(8109);function fr(e,t){return t?w.bl(e):e}var dr="https://experimenthub.bioconductor.org/fetch",vr={"zeisel-brain":{counts:"2596",coldata:"2598",rowdata:"2597"},"segerstolpe-pancreas":{counts:"2591",coldata:"2593",rowdata:"2592"},"nestorowa-hsc":{counts:"2710",ncol:1920},"aztekin-tail":{counts:"3124",coldata:"3125"},"wu-kidney":{counts:"3594",coldata:"3595"},"zilionis-mouse-lung":{counts:"3478",coldata:"3479"}};function pr(e,t,n){if(!(e instanceof m.BA))throw new Error("expected an S4 object");for(var r=0,i=Object.entries(t);r<i.length;r++){var a=(0,p.Z)(i[r],2),s=a[0],o=a[1];if(e.className()==s&&e.packageName()==o)return}throw new Error("object is not a "+n+" or one of its recognized subclasses")}function mr(e,t){var n=function(e){var t,n,r=e.findAttribute("names");if(r<0)return null;try{n=(t=e.attribute(r)).values()}catch(i){throw new Error("failed to load listData names; "+i.message)}finally{m.gd(t)}if(n.length!=e.length())throw new Error("expected names to have same length as listData");return n}(e);if(null==n)throw new Error("expected the listData list to be named");for(var r={},i=0;i<e.length();i++){var a=void 0;try{if((a=e.load(i))instanceof m.qu&&!(a instanceof m.SV)){var s=a.values();r[n[i]]=s,t.nrow=s.length}}finally{m.gd(a)}}t.columns=r}function wr(e){var t,n,r={};if("S4"==e.type()){var i;pr(e,{DFrame:"S4Vectors",DataFrame:"S4Vectors"},"DFrame");try{if(!((i=e.attribute("listData"))instanceof m.SV))throw new Error("listData slot should be a generic list");mr(i,r)}catch(o){throw new Error("failed to retrieve data from DataFrame's listData; "+o.message)}finally{m.gd(i)}}else{if("vector"!=e.type())throw new Error("expected a data.frame or DataFrame instance");mr(e,r)}try{var a=e.findAttribute("rownames");a>=0&&(t=e.attribute(a))instanceof m.II&&(r.row_names=t.values(),r.nrow=r.row_names.length)}catch(o){throw new Error("failed to retrieve row names from DataFrame; "+o.message)}finally{m.gd(t)}if(!("nrow"in r))try{if(!((n=e.attribute("nrows"))instanceof m.D6))throw new Error("expected an integer vector as the 'nrows' slot");var s=n.values();if(1!=s.length)throw new Error("expected an integer vector of length 1 as the 'nrows' slot");r.nrow=s[0]}catch(o){throw new Error("failed to retrieve nrows from DataFrame; "+o.message)}finally{m.gd(n)}return r}function Zr(e){var t,n,r,i;if("S4"==e.type()?(pr(e,{dgCMatrix:"Matrix",dgTMatrix:"Matrix"},"Matrix"),t=e.findAttribute("Dimnames")):t=e.findAttribute("dimnames"),t<0)throw new Error("count matrix does not have dimnames");try{if("vector"!=(n=e.attribute(t)).type()&&2!=n.size())throw new Error("dimnames of the count matrix should be a list of length 2");if("string"!=(r=n.load(0)).type())throw new Error("expected a character vector in the first dimnames");i=r.values()}finally{m.gd(n),m.gd(r)}return i}var _r=new WeakMap,gr=new WeakMap,br=new WeakMap,yr=new WeakMap,kr=new WeakMap,Ar=new WeakMap,xr=new WeakSet,Er=new WeakSet,Sr=new WeakSet,Cr=new WeakSet,Ir=function(){function e(t){var n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).primaryRnaFeatureIdColumn,r=void 0===n?0:n;if((0,s.Z)(this,e),(0,l.Z)(this,Cr),(0,l.Z)(this,Sr),(0,l.Z)(this,Er),(0,l.Z)(this,xr),(0,u.Z)(this,_r,{writable:!0,value:void 0}),(0,u.Z)(this,gr,{writable:!0,value:void 0}),(0,u.Z)(this,br,{writable:!0,value:void 0}),(0,u.Z)(this,yr,{writable:!0,value:void 0}),(0,u.Z)(this,kr,{writable:!0,value:void 0}),(0,u.Z)(this,Ar,{writable:!0,value:void 0}),(0,h.Z)(this,_r,t),!((0,v.Z)(this,_r)in vr))throw new Error("unrecognized identifier '"+(0,v.Z)(this,_r)+"' for ExperimentHub-based datasets");(0,h.Z)(this,Ar,r),this.clear()}return(0,o.Z)(e,[{key:"clear",value:function(){m.gd((0,v.Z)(this,yr)),m.gd((0,v.Z)(this,kr)),(0,h.Z)(this,yr,null),(0,h.Z)(this,kr,null),(0,h.Z)(this,gr,null),(0,h.Z)(this,br,null)}},{key:"abbreviate",value:function(){return{id:(0,v.Z)(this,_r),options:(0,c.Z)(this,xr,Br).call(this)}}},{key:"setPrimaryRnaFeatureIdColumn",value:function(e){(0,h.Z)(this,Ar,e)}},{key:"summary",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,n,r,a,s=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(s.length>0&&void 0!==s[0]?s[0]:{}).cache,n=void 0!==t&&t,e.next=3,(0,c.Z)(this,Sr,zr).call(this);case 3:return e.next=5,(0,c.Z)(this,Cr,Dr).call(this);case 5:return r={cells:fr((0,v.Z)(this,br),n)},a=fr((0,v.Z)(this,gr),n),r.modality_features={RNA:a},n||this.clear(),e.abrupt("return",r);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,n,r,a,s,o,l,u=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(u.length>0&&void 0!==u[0]?u[0]:{}).cache,n=void 0!==t&&t,e.next=3,(0,c.Z)(this,Sr,zr).call(this);case 3:return e.next=5,(0,c.Z)(this,Cr,Dr).call(this);case 5:return e.next=7,(0,c.Z)(this,Er,Rr).call(this);case 7:r={cells:fr((0,v.Z)(this,br),n)},vr[(0,v.Z)(this,_r)],e.prev=9,r.matrix=new m.VU,a=m.Bp((0,v.Z)(this,yr),{consume:!n}),r.matrix.add("RNA",a.matrix),r.row_ids={RNA:a.row_ids},s=w.Nd((0,v.Z)(this,gr),a.row_ids),r.features={RNA:s},e.next=22;break;case 18:throw e.prev=18,e.t0=e.catch(9),m.gd(r.matrix),e.t0;case 22:return o=r.features.RNA,l=this.primaryRnaFeatureIdColumn,r.primary_ids={RNA:null},"string"==typeof l&&o.hasColumn(l)||"number"==typeof l&&l<o.numberOfColumns()?r.primary_ids.RNA=o.column(l):r.primary_ids.RNA=o.rowNames(),n||this.clear(),e.abrupt("return",r);case 28:case"end":return e.stop()}}),e,this,[[9,18]])})));return function(){return e.apply(this,arguments)}}()},{key:"serialize",value:function(){var e=(new TextEncoder).encode((0,v.Z)(this,_r));return{files:[{type:"id",file:new R(e,{name:"id"})}],options:(0,c.Z)(this,xr,Br).call(this)}}}],[{key:"setDownloadFun",value:function(t){var n=(0,d.Z)(e,e,Or);return(0,f.Z)(e,e,Or,t),n}},{key:"availableDatasets",value:function(){return Object.keys(vr)}},{key:"format",value:function(){return"ExperimentHub"}},{key:"unserialize",value:function(t,n){var i,a={},s=(0,r.Z)(t);try{for(s.s();!(i=s.n()).done;){var o=i.value,l=new TextDecoder;a[o.type]=l.decode(o.file.buffer())}}catch(u){s.e(u)}finally{s.f()}if(!("id"in a))throw new Error("expected a file of type 'id' when unserializing ExperimentHub dataset");return new e(a.id,n)}}]),e}();function Br(){return{primaryRnaFeatureIdColumn:(0,v.Z)(this,Ar)}}function Rr(){return Fr.apply(this,arguments)}function Fr(){return(Fr=(0,a.Z)((0,i.Z)().mark((function e(){var t,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(0,v.Z)(this,yr)){e.next=2;break}return e.abrupt("return");case 2:return t=vr[(0,v.Z)(this,_r)],e.next=5,(0,d.Z)(Ir,Ir,Or).call(Ir,dr+"/"+t.counts);case 5:n=e.sent,e.prev=6,(0,h.Z)(this,kr,m.p$(n)),(0,h.Z)(this,yr,(0,v.Z)(this,kr).value()),e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(6),m.gd((0,v.Z)(this,yr)),m.gd((0,v.Z)(this,kr)),e.t0;case 16:case"end":return e.stop()}}),e,this,[[6,11]])})))).apply(this,arguments)}function zr(){return Nr.apply(this,arguments)}function Nr(){return(Nr=(0,a.Z)((0,i.Z)().mark((function e(){var t,n,r,a,s,o,l,u,f,Z,_,g,b;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(0,v.Z)(this,gr)){e.next=2;break}return e.abrupt("return");case 2:if(!("rowdata"in(t=vr[(0,v.Z)(this,_r)]))){e.next=23;break}return e.next=6,(0,d.Z)(Ir,Ir,Or).call(Ir,dr+"/"+t.rowdata);case 6:for(n=e.sent,e.prev=7,r=m.p$(n),a=r.value(),s=wr(a),o=s.row_names,l={},o&&(l.id=o),u=0,f=Object.entries(s.columns);u<f.length;u++)Z=(0,p.Z)(f[u],2),_=Z[0],g=Z[1],_.match(/^sym/)&&(l[_]=g);if(0!=Object.keys(l).length){e.next=17;break}throw new Error("no acceptable feature identifiers found in the rowData DataFrame");case 17:(0,h.Z)(this,gr,new w.NE(l));case 18:return e.prev=18,m.gd(a),m.gd(r),e.finish(18);case 22:return e.abrupt("return");case 23:return e.next=25,(0,c.Z)(this,Er,Rr).call(this);case 25:b=Zr((0,v.Z)(this,yr)),(0,h.Z)(this,gr,new w.NE({id:b}));case 27:case"end":return e.stop()}}),e,this,[[7,,18,22]])})))).apply(this,arguments)}function Dr(){return Mr.apply(this,arguments)}function Mr(){return(Mr=(0,a.Z)((0,i.Z)().mark((function e(){var t,n,r,a,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(0,v.Z)(this,br)){e.next=2;break}return e.abrupt("return");case 2:if(!("coldata"in(t=vr[(0,v.Z)(this,_r)]))){e.next=11;break}return e.next=6,(0,d.Z)(Ir,Ir,Or).call(Ir,dr+"/"+t.coldata);case 6:n=e.sent;try{r=m.p$(n),a=r.value(),s=wr(a)}finally{m.gd(a),m.gd(r)}(0,h.Z)(this,br,new w.NE(s.columns,{numberOfRows:s.nrow})),e.next=12;break;case 11:(0,h.Z)(this,br,new w.NE({},{numberOfRows:t.ncol}));case 12:return e.abrupt("return");case 13:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}var Or={writable:!0,value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:if((n=e.sent).ok){e.next=5;break}throw new Error("failed to fetch content at "+t+" ("+n.status+")");case 5:return e.t0=Uint8Array,e.next=8,n.arrayBuffer();case 8:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()};n(2963);var Wr=n(1120),Qr=n(9611);var jr=n(5647);function qr(e){var t="function"===typeof Map?new Map:void 0;return qr=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return(0,jr.Z)(e,arguments,(0,Wr.Z)(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),(0,Qr.Z)(r,e)},qr(e)}Error},2754:function(e,t,n){n.d(t,{ES:function(){return se.ES},Fl:function(){return L.Fl},J6:function(){return _.J6},E4:function(){return a.E4},H$:function(){return L.H$},By:function(){return L.By},en:function(){return L.en},cO:function(){return L.cO},bN:function(){return ce},TD:function(){return le},TN:function(){return qe},jJ:function(){return B.jJ},j2:function(){return xt},x6:function(){return Pe},lC:function(){return bt},JZ:function(){return $e},ED:function(){return i.ED},$p:function(){return At.$p},Qr:function(){return L.Qr},j5:function(){return et},o2:function(){return kt}});var r=n(7762),i=n(6546),a=n(652),s=n(9873),o=n(9751),l=n(2269),u=n(7317),c=n(8366),h=n(2615),f=n(384),d=n(7188),v=n(6849),p=n(8580),m=n(1944),w=n(7625),Z=n(4414),_=n(8334),g=n(2346),b=n(8916),y=n(2793),k=n(3324),A=n(5671),x=n(3144),E=n(8652),S=n(3889),C=n(5831),I=n(7891),B=n(818),R=new WeakSet,F=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,A.Z)(this,e),(0,E.Z)(this,R),this._selections=null==t?{}:t,this._cache=null==n?{results:{}}:n}return(0,x.Z)(e,[{key:"free",value:function(){I.Yl(this._cache.buffer),delete this._cache.buffer;for(var e=0,t=Object.keys(this._cache.results);e<t.length;e++){var n=t[e];(0,S.Z)(this,R,z).call(this,n)}this._cache.results={},B.eo(this._cache.versus),delete this._cache.versus}},{key:"addSelection",value:function(e,t,n,i,a,s,o,l){var u=i(n[0]).numberOfColumns();I.N2(t,u);var c=I.rS(u,"Int32Array",this._cache);c.fill(0);var h=c.array();t.forEach((function(e){h[e]=1}));var f,d={},v=(0,r.Z)(n);try{for(v.s();!(f=v.n()).done;){var p=f.value,m=i(p);d[p]=C.y5(m,c,{block:a,lfcThreshold:o,computeAuc:l})}}catch(w){v.e(w)}finally{v.f()}e in this._cache.results&&(0,S.Z)(this,R,z).call(this,e),this._cache.results[e]={raw:d},s&&(t=t.slice()),this._selections[e]=t}},{key:"removeSelection",value:function(e){(0,S.Z)(this,R,z).call(this,e),delete this._cache.results[e],delete this._selections[e]}},{key:"fetchResults",value:function(e){return this._cache.results[e].raw}},{key:"fetchSelectionIndices",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).copy,n=void 0===t||t,r=this._selections[e];return n&&(r=r.slice()),r}},{key:"fetchSelections",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,n=void 0===t||t,r=e.force,i=void 0===r?null:r,a={},s=0,o=Object.entries(this._selections);s<o.length;s++){var l=(0,k.Z)(o[s],2),u=l[0],c=l[1],h=c,f=n;null!==i&&("Array"==i?c instanceof Array||(h=Array.from(c),f=!1):"Int32Array"==i&&(c instanceof Int32Array||(h=new Int32Array(c),f=!1))),f&&(h=h.slice()),a[u]=h}return a}},{key:"computeVersus",value:function(e,t,n,i,a,s,o){"versus"in this._cache||(this._cache.versus={});var l=this._cache.versus,u=B.Bh(e,t,l),c=u.left_small?0:1,h=u.left_small?1:0;if(u.run){var f,d=new C.VU,v=(0,r.Z)(n);try{for(v.s();!(f=v.n()).done;){var p=f.value;d.add(p,i(p))}}catch(y){v.e(y)}finally{v.f()}var m=this._selections;if(!(e in m)||!(t in m))throw new Error("invalid selection ID requested in versus mode");var w=m[e],Z=m[t];if(0==w.length||0==Z.length)throw new Error("non-zero entries should be present for both requested selections in versus mode");var _=[];w.forEach((function(e){_.push({index:e,cluster:c})})),Z.forEach((function(e){_.push({index:e,cluster:h})})),_.sort((function(e,t){return e.index-t.index}));var g=_.map((function(e){return e.index})),b=_.map((function(e){return e.cluster}));B.c9(d,b,a,g,u.cached,s,o)}return{results:u.cached,left:c,right:h}}}]),e}();function z(e){for(var t=0,n=Object.entries(this._cache.results[e].raw);t<n.length;t++){var r=(0,k.Z)(n[t],2);r[0];r[1].free()}}var N=new WeakMap,D=new WeakMap,M=new WeakMap,O=new WeakMap,W=new WeakSet,Q=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((0,A.Z)(this,e),(0,E.Z)(this,W),(0,g.Z)(this,N,{writable:!0,value:void 0}),(0,g.Z)(this,D,{writable:!0,value:void 0}),(0,g.Z)(this,M,{writable:!0,value:void 0}),(0,g.Z)(this,O,{writable:!0,value:void 0}),!(t instanceof l.H0))throw new Error("'filter' should be a CellFilteringState object");if((0,y.Z)(this,N,t),!(n.RNA instanceof u.ue))throw new Error("'norm_states.RNA' should be an RnaNormalizationState object");if(!(n.ADT instanceof c.m5))throw new Error("'norm_states.ADT' should be an AdtNormalizationState object");if(!(n.CRISPR instanceof h.$M))throw new Error("'norm_states.CRISPR' should be an CrisprNormalizationState object");(0,y.Z)(this,D,n);var a=null;null!==r&&"selections"in r&&(a=r.selections),(0,y.Z)(this,M,new F(a,i)),(0,y.Z)(this,O,{}),this.changed=!1}return(0,x.Z)(e,[{key:"free",value:function(){(0,b.Z)(this,M).free()}},{key:"fetchParameters",value:function(){return{lfc_threshold:(0,b.Z)(this,O).lfc_threshold,compute_auc:(0,b.Z)(this,O).compute_auc}}},{key:"addSelection",value:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).copy,r=void 0===n||n;(0,S.Z)(this,W,j).call(this,e,t,r,(0,b.Z)(this,O).lfc_threshold,(0,b.Z)(this,O).compute_auc)}},{key:"removeSelection",value:function(e){(0,b.Z)(this,M).removeSelection(e)}},{key:"fetchResults",value:function(e){return(0,b.Z)(this,M).fetchResults(e)}},{key:"fetchSelectionIndices",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).copy,n=void 0===t||t;return(0,b.Z)(this,M).fetchSelectionIndices(e,{copy:n})}},{key:"fetchSelections",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copy,n=void 0===t||t,r=e.force,i=void 0===r?null:r;return(0,b.Z)(this,M).fetchSelections({copy:n,force:i})}},{key:"compute",value:function(e){var t=e.lfc_threshold,n=e.compute_auc;if(this.changed=!1,(0,b.Z)(this,N).changed&&((0,b.Z)(this,M).free(),(0,y.Z)(this,M,new F),this.changed=!0),t!==(0,b.Z)(this,O).lfc_threshold||n!=(0,b.Z)(this,O).compute_auc){for(var r=0,i=Object.entries((0,b.Z)(this,M)._selections);r<i.length;r++){var a=(0,k.Z)(i[r],2),s=a[0],o=a[1];(0,S.Z)(this,W,j).call(this,s,o,!1,t,n)}(0,b.Z)(this,O).lfc_threshold=t,(0,b.Z)(this,O).compute_auc=n,this.changed=!0}}},{key:"computeVersus",value:function(e,t){var n=this,r=I.Mc((0,b.Z)(this,D));return(0,b.Z)(this,M).computeVersus(e,t,r,(function(e){return(0,b.Z)(n,D)[e].fetchNormalizedMatrix()}),(0,b.Z)(this,N).fetchFilteredBlock(),(0,b.Z)(this,O).lfc_threshold,(0,b.Z)(this,O).compute_auc)}}],[{key:"defaults",value:function(){return{lfc_threshold:0,compute_auc:!0}}}]),e}();function j(e,t,n,r,i){var a=this,s=I.Mc((0,b.Z)(this,D));(0,b.Z)(this,M).addSelection(e,t,s,(function(e){return(0,b.Z)(a,D)[e].fetchNormalizedMatrix()}),(0,b.Z)(this,N).fetchFilteredBlock(),n,r,i)}var q=n(1413),U=n(4165),T=n(5861),P=n(7462),G=n(5137),L=n(9489),H=new WeakMap,V=function(){function e(){(0,A.Z)(this,e),(0,g.Z)(this,H,{writable:!0,value:void 0}),(0,y.Z)(this,H,{})}return(0,x.Z)(e,[{key:"free",value:function(){I.Yl((0,b.Z)(this,H).set_buffer),(0,y.Z)(this,H,{})}},{key:"prepare",value:function(){var e=(0,T.Z)((0,U.Z)().mark((function e(t,n,i,a){var s,o,l,u,c,h,f,d,v,p,m,w,Z,_,g,y,k,A,x,E,S,C,I,B,R,F,z,N,D,M,O,W,Q,j,q,T,L,V;return(0,U.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(null==i?null==(s=t.rowNames())&&(n=[]):s=t.column(i),o={types:[a.toLowerCase()]},l=0,u=[[]],c=[[]],h=[[]],f=0,d=[[]],v=[[]],p=[[]],m=[new Int32Array],w=[new Int32Array],Z=new Set,_=new Array(t.numberOfRows()),g=0;g<_.length;g++)_[g]=[];y=(0,r.Z)(n),e.prev=16,y.s();case 18:if((k=y.n()).done){e.next=62;break}return A=k.value,e.next=22,G.XW(A,s,o);case 22:for(x=e.sent,E=0;E<x.length;E++)x[E].length>0&&Z.add(E);return e.next=26,G.Uy(A);case 26:return S=e.sent,C=G.$g(x,S),e.next=30,G.bj(A);case 30:for(I=e.sent,B=I.length,R=new Array(B),F=new Array(B),z=new Int32Array(B),N=new Int32Array(B),E=0;E<B;E++)D=I[E],R[E]=D.name,F[E]=D.description,N[E]=D.collection+l,z[E]=C[E].length;return d.push(R),v.push(F),p.push(C),m.push(z),w.push(N),e.next=44,G.RR(A);case 44:for(M=e.sent,O=G.wy(x,M),E=0;E<x.length;E++){for(W=O[E],Q=0;Q<W.length;Q++)W[Q]+=f;_[E].push(W)}return e.next=49,G.is(A);case 49:for(j=e.sent,q=j.length,T=new Array(q),L=new Array(q),V=new Array(q),E=0;E<q;E++)T[E]=j[E].title,L[E]=j[E].description,V[E]=A;u.push(T),c.push(L),h.push(V),f+=B,l+=q;case 60:e.next=18;break;case 62:e.next=67;break;case 64:e.prev=64,e.t0=e.catch(16),y.e(e.t0);case 67:return e.prev=67,y.f(),e.finish(67);case 70:if((0,b.Z)(this,H).universe=new Int32Array(Z).sort(),(0,b.Z)(this,H).sets={names:P.NR(d),descriptions:P.NR(v),sets:P.NR(p),sizes:P.NR(m),collections:P.NR(w)},(0,b.Z)(this,H).collections={names:P.NR(u),descriptions:P.NR(c),species:P.NR(h)},n.length>0)for(g=0;g<_.length;g++)_[g]=P.NR(_[g]);else for(g=0;g<_.length;g++)_[g]=new Uint32Array;return(0,b.Z)(this,H).mapping_to_sets=_,e.abrupt("return");case 76:case"end":return e.stop()}}),e,this,[[16,64,67,70]])})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"fetchCollectionDetails",value:function(){return(0,b.Z)(this,H).collections}},{key:"fetchSetDetails",value:function(){return{names:(0,b.Z)(this,H).sets.names,descriptions:(0,b.Z)(this,H).sets.descriptions,sizes:(0,b.Z)(this,H).sets.sizes,collections:(0,b.Z)(this,H).sets.collections}}},{key:"fetchUniverseSize",value:function(){return(0,b.Z)(this,H).universe.length}},{key:"computeEnrichment",value:function(e,t,n,r,i){var a=this;"delta_detected"==t&&(t="deltaDetected");var s="auc"==t?.5:0,o="min_rank"!==t,l=B.iG[n],u=r[t](e,{summary:l,copy:!1}),c=P.Nd(u,(0,b.Z)(this,H).universe),h=C.Y8(c,i,{largest:o}),f=[],d=function(e){var t=(0,b.Z)(a,H).universe[e];f.push((0,b.Z)(a,H).mapping_to_sets[t])};o?(h<s&&(h=s),c.forEach((function(e,t){e>=h&&d(t)}))):c.forEach((function(e,t){e<=h&&d(t)}));for(var v=G.or(f),p=new Int32Array(v.length),m=new Int32Array(v.length),w=new Int32Array(v.length),Z=new Int32Array(v.length),_=0;_<v.length;_++){Z[_]=_;var g=v[_];p[_]=g.id,m[_]=g.count,w[_]=(0,b.Z)(this,H).sets.sizes[g.id]}var y=f.length,k=C.xw(m,y,w,(0,b.Z)(this,H).universe.length);return Z.sort((function(e,t){return k[e]-k[t]})),{set_ids:P.Nd(p,Z),counts:P.Nd(m,Z),pvalues:P.Nd(k,Z),num_markers:y}}},{key:"fetchFeatureSetIndices",value:function(e){return(0,b.Z)(this,H).sets.sets[e]}},{key:"computePerCellScores",value:function(e,t,n){var r=this.fetchFeatureSetIndices(e),i=I.rS(t.numberOfRows(),"Uint8Array",(0,b.Z)(this,H),"set_buffer");i.fill(0);var a=i.array();return r.forEach((function(e){a[e]=1})),C.Bs(t,i,{block:n})}}],[{key:"flush",value:function(){}},{key:"setDownload",value:function(e){console.warn("'FeatureSetState.setDownload' is a no-op, uses 'gesel.setReferenceDownload' and 'gesel.setGeneDownload' instead")}}]),e}();function Y(e){var t=null,n={type:"symbol",species:"human",confidence:0};if("row_names"in e){var r=e.row_names;r.confidence>n.confidence&&(n=r)}for(var i=0,a=Object.entries(e.columns);i<a.length;i++){var s=(0,k.Z)(a[i],2),o=s[0],l=s[1];l.confidence>n.confidence&&(n=l,t=o)}return{gene_id_column:t,gene_id_type:n.type.toUpperCase(),species:[n.species]}}function J(e,t,n,r,i,a,s,o){return X.apply(this,arguments)}function X(){return(X=(0,T.Z)((0,U.Z)().mark((function e(t,n,r,i,a,s,o,l){var u,c,h,f;return(0,U.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r===t.automatic&&(r||t.gene_id_column===a&&t.gene_id_type===s&&!I.xi(t.species,i))){e.next=8;break}return u=a,c=s,h=i,r&&(f=Y(l()),u=f.gene_id_column,c=f.gene_id_type,h=f.species),e.next=7,n.prepare(o(),h,u,c);case 7:return e.abrupt("return",!0);case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t,n,r,i,a){e.automatic=t,e.species=P.bl(n),e.gene_id_column=r,e.gene_id_type=i,e.top_markers=a}function K(e){var t=(0,q.Z)({},e);return t.species=P.bl(t.species),t}var ee=new WeakMap,te=new WeakMap,ne=new WeakMap,re=new WeakMap,ie=new WeakMap,ae=function(){function e(t,n,r,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if((0,A.Z)(this,e),(0,g.Z)(this,ee,{writable:!0,value:void 0}),(0,g.Z)(this,te,{writable:!0,value:void 0}),(0,g.Z)(this,ne,{writable:!0,value:void 0}),(0,g.Z)(this,re,{writable:!0,value:void 0}),(0,g.Z)(this,ie,{writable:!0,value:void 0}),!(t instanceof i.tq))throw new Error("'inputs' should be a State object from './inputs.js'");if((0,y.Z)(this,ee,t),!(n instanceof l.H0))throw new Error("'filter' should be a CellFilteringState object");if((0,y.Z)(this,te,n),!(r instanceof u.ue))throw new Error("'normalized' should be a RnaNormalizationState object from './rna_normalization.js'");(0,y.Z)(this,ne,r),(0,y.Z)(this,re,null===s?{}:s),(0,y.Z)(this,ie,new V),this.changed=!1}return(0,x.Z)(e,[{key:"free",value:function(){(0,b.Z)(this,ie).free()}},{key:"valid",value:function(){return(0,b.Z)(this,ee).fetchCountMatrix().has("RNA")}},{key:"fetchCollectionDetails",value:function(){return(0,b.Z)(this,ie).fetchCollectionDetails()}},{key:"fetchSetDetails",value:function(){return(0,b.Z)(this,ie).fetchSetDetails()}},{key:"fetchUniverseSize",value:function(){return(0,b.Z)(this,ie).fetchUniverseSize()}},{key:"computeEnrichment",value:function(e,t,n,r){return(0,b.Z)(this,ie).computeEnrichment(t,n,r,e,(0,b.Z)(this,re).top_markers)}},{key:"fetchFeatureSetIndices",value:function(e){return(0,b.Z)(this,ie).fetchFeatureSetIndices(e)}},{key:"computePerCellScores",value:function(e){return(0,b.Z)(this,ie).computePerCellScores(e,(0,b.Z)(this,ne).fetchNormalizedMatrix(),(0,b.Z)(this,te).fetchFilteredBlock())}},{key:"fetchPerCellScores",value:function(e,t){return this.computePerCellScores(e,t)}},{key:"fetchParameters",value:function(){return K((0,b.Z)(this,re))}},{key:"compute",value:function(){var e=(0,T.Z)((0,U.Z)().mark((function e(t){var n,r,i,a,s,o,l=this;return(0,U.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.changed=!1,(0,b.Z)(this,ee).changed&&(this.changed=!0),n=t.skip,r=t.automatic,i=t.species,a=t.gene_id_column,s=t.gene_id_type,o=t.top_markers,n!==(0,b.Z)(this,re).skip&&(this.changed=!0),!this.valid()||n){e.next=11;break}return this.changed&&(0,y.Z)(this,re,{}),e.next=8,J((0,b.Z)(this,re),(0,b.Z)(this,ie),r,i,a,s,(function(){return(0,b.Z)(l,ee).fetchFeatureAnnotations().RNA}),(function(){return(0,b.Z)(l,ee).guessRnaFeatureTypes()}));case 8:e.sent&&(this.changed=!0),o!==(0,b.Z)(this,re).top_markers&&(this.changed=!0);case 11:return $((0,b.Z)(this,re),r,i,a,s,o),(0,b.Z)(this,re).skip=n,e.abrupt("return");case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"defaults",value:function(){return{skip:!1,automatic:!0,species:[],gene_id_column:null,gene_id_type:"ENSEMBL",top_markers:100}}},{key:"flush",value:function(){}},{key:"setDownload",value:function(e){return V.setDownload(e)}}]),e}();var se=n(4);var oe=[f.Cy,d.Cy,v.Cy];function le(e,t){var n,i;if("mnn"==t)n=t,i="weight";else if("regress"==t)n="none",i=t;else{if("none"!=t)throw new Error("unknown correction method '"+t+"'");n=t,i=t}e[m.Cy].method=n;var a,s=(0,r.Z)(oe);try{for(s.s();!(a=s.n()).done;){e[a.value].block_method=i}}catch(o){s.e(o)}finally{s.f()}return e}var ue=[m.Cy,p.Cy,w.Cy];function ce(e,t){var n,i=(0,r.Z)(ue);try{for(i.s();!(n=i.n()).done;){e[n.value].approximate=t}}catch(a){i.e(a)}finally{i.f()}return e}var he=n(8391),fe=n(2658),de=n(8849),ve=n(3060),pe=n(7270),me=(n(9792),i.Cy),we=a.Cy,Ze=s.Cy,_e=o.Cy,ge=l.Cy,be=u.Cy,ye=c.Cy,ke=h.Cy,Ae="feature_selection",xe=f.Cy,Ee=d.Cy,Se=v.Cy,Ce="combine_embeddings",Ie="batch_correction",Be=w.Cy,Re="tsne",Fe="umap",ze="kmeans_cluster",Ne=Z.Cy,De="choose_clustering",Me=_.Cy,Oe="cell_labelling",We="custom_selections",Qe="feature_set_enrichment",je="_loaded";function qe(){return Ue.apply(this,arguments)}function Ue(){return(Ue=(0,T.Z)((0,U.Z)().mark((function e(){return(0,U.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Te(new i.tq));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Te(e){var t={};t[me]=e,t[we]=new a.E4(t[me]),t[Ze]=new s.fA(t[me]),t[_e]=new o.IW(t[me]);var n={RNA:t[we],ADT:t[Ze],CRISPR:t[_e]};t[ge]=new l.H0(t[me],n),t[be]=new u.ue(t[we],t[ge]),t[ye]=new c.m5(t[Ze],t[ge]),t[ke]=new h.$M(t[_e],t[ge]),t[Ae]=new he.$(t[ge],t[be]),t[xe]=new f.rR(t[ge],t[be],t[Ae]),t[Ee]=new d.Ru(t[ge],t[ye]),t[Se]=new v.zR(t[ge],t[ke]);var r={RNA:t[xe],ADT:t[Ee],CRISPR:t[Se]};t[Ce]=new p.BE(r),t[Ie]=new m.N_(t[ge],t[Ce]),t[Be]=new w.Xr(t[Ie]),t[Re]=new ve.T(t[Be]),t[Fe]=new pe.D(t[Be]),t[ze]=new de.d(t[Ie]),t[Ne]=new Z.Xs(t[Be]),t[De]=new fe.c(t[Ne],t[ze]);var i={RNA:t[be],ADT:t[ye],CRISPR:t[ke]};return t[Me]=new _.UL(t[ge],i,t[De]),t[Oe]=new se.ES(t[me],t[Me]),t[Qe]=new ae(t[me],t[ge],t[be]),t[We]=new Q(t[ge],i),Promise.all([t[Re].ready(),t[Fe].ready()]).then((function(e){return t}))}function Pe(e,t,n){return Ge.apply(this,arguments)}function Ge(){return Ge=(0,T.Z)((0,U.Z)().mark((function e(t,n,r){var i,a,s,o,l,u,c,h,f,d,v,p,m,w,Z,_,g,b,y,k,A=arguments;return(0,U.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(i=A.length>3&&void 0!==A[3]?A[3]:{}).startFun,s=void 0===a?null:a,o=i.finishFun,l=void 0===o?null:o,u=function(){var e=(0,T.Z)((0,U.Z)().mark((function e(t){return(0,U.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===s){e.next=3;break}return e.next=3,s(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c=function(){var e=(0,T.Z)((0,U.Z)().mark((function e(t){return(0,U.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===l){e.next=3;break}return e.next=3,l(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=[],f=function(e,n){null!==l&&(n=t[e].changed?n.then((function(n){return l(e,t[e])})):n.then((function(t){return l(e)}))),h.push(n)},e.next=7,u(me);case 7:return e.next=9,t[me].compute(n,r[me]);case 9:return e.next=11,c(me);case 11:je in t&&(t[me].changed=!0,delete t[je]),d=0,v=[we,Ze,_e,ge,be,ye,ke,Ae,xe,Ee,Se,Ce,Ie,Be];case 14:if(!(d<v.length)){e.next=25;break}return p=v[d],e.next=18,u(p);case 18:return e.next=20,t[p].compute(r[p]);case 20:return e.next=22,c(p);case 22:d++,e.next=14;break;case 25:m=0,w=[Re,Fe];case 26:if(!(m<w.length)){e.next=35;break}return Z=w[m],e.next=30,u(Z);case 30:_=t[Z].compute(r[Z]),f(Z,_);case 32:m++,e.next=26;break;case 35:return g=r[De].method,e.next=38,u(ze);case 38:return t[ze].compute("kmeans"==g,r[ze]),e.next=41,c(ze);case 41:return e.next=43,u(Ne);case 43:return t[Ne].compute("snn_graph"==g,r[Ne]),e.next=46,c(Ne);case 46:return e.next=48,u(De);case 48:return t[De].compute(r[De]),e.next=51,c(De);case 51:b=0,y=[Me,Oe,We,Qe];case 53:if(!(b<y.length)){e.next=64;break}return k=y[b],e.next=57,u(k);case 57:return e.next=59,t[k].compute(r[k]);case 59:return e.next=61,c(k);case 61:b++,e.next=53;break;case 64:return e.next=66,Promise.all(h);case 66:return e.abrupt("return",null);case 67:case"end":return e.stop()}}),e)}))),Ge.apply(this,arguments)}function Le(e){for(var t={},n=0,r=Object.entries(e);n<r.length;n++){var i=(0,k.Z)(r[n],2),a=i[0],s=i[1];a!=je&&(t[a]=s.fetchParameters())}return t}n(1408);var He=n(8795);function Ve(e,t){return Ye.apply(this,arguments)}function Ye(){return(Ye=(0,T.Z)((0,U.Z)().mark((function e(t,n){var i,a,s,o,l,u,c,h,f,d,v,p,m,w;return(0,U.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i={},a=0,s=Object.entries(t);case 2:if(!(a<s.length)){e.next=38;break}return o=(0,k.Z)(s[a],2),l=o[0],u=o[1],c=u.constructor.format(),e.next=7,u.serialize();case 7:h=e.sent,f=h.files,d=h.options,v={format:c,options:d,files:[]},p=(0,r.Z)(f),e.prev=12,p.s();case 14:if((m=p.n()).done){e.next=26;break}return w=m.value,e.t0=v.files,e.t1=w.type,e.t2=w.file.name(),e.next=21,n(l,c,w.file);case 21:e.t3=e.sent,e.t4={type:e.t1,name:e.t2,id:e.t3},e.t0.push.call(e.t0,e.t4);case 24:e.next=14;break;case 26:e.next=31;break;case 28:e.prev=28,e.t5=e.catch(12),p.e(e.t5);case 31:return e.prev=31,p.f(),e.finish(31);case 34:i[l]=v;case 35:a++,e.next=2;break;case 38:return e.abrupt("return",i);case 39:case"end":return e.stop()}}),e,null,[[12,28,31,34]])})))).apply(this,arguments)}function Je(e,t){return Xe.apply(this,arguments)}function Xe(){return(Xe=(0,T.Z)((0,U.Z)().mark((function e(t,n){var i,a,s,o,l,u,c,h,f,d,v,p,m,w;return(0,U.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i={},a=L.cO,s=0,o=Object.entries(t);case 3:if(!(s<o.length)){e.next=35;break}if(l=(0,k.Z)(o[s],2),u=l[0],(c=l[1]).format in a){e.next=7;break}throw new Error("unknown dataset format '"+c.format+"'");case 7:h=L.cO[c.format],f=[],d=(0,r.Z)(c.files),e.prev=10,d.s();case 12:if((v=d.n()).done){e.next=21;break}return p=v.value,e.next=16,n(p.id);case 16:m=e.sent,w=new L.zD(m,{name:p.name}),f.push({type:p.type,file:w});case 19:e.next=12;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(10),d.e(e.t0);case 26:return e.prev=26,d.f(),e.finish(26);case 29:return e.next=31,h.unserialize(f,c.options);case 31:i[u]=e.sent;case 32:s++,e.next=3;break;case 35:return e.abrupt("return",i);case 36:case"end":return e.stop()}}),e,null,[[10,23,26,29]])})))).apply(this,arguments)}function $e(e,t){return Ke.apply(this,arguments)}function Ke(){return(Ke=(0,T.Z)((0,U.Z)().mark((function e(t,n){var r,i,a;return(0,U.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Le(t),e.next=3,Ve(t.inputs.fetchDatasets(),n);case 3:return i=e.sent,null!==(a=t.inputs.fetchDirectSubset({copy:!1}))&&(a=Array.from(a)),e.abrupt("return",{version:He.i,parameters:r,datasets:i,other:{inputs:{direct_subset:a},custom_selections:{selections:t.custom_selections.fetchSelections({force:"Array"})}}});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function et(e,t){return tt.apply(this,arguments)}function tt(){return tt=(0,T.Z)((0,U.Z)().mark((function e(t,n){var r,i,a,s,o,l,u,c,h,f,d,v,p,m=arguments;return(0,U.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(r=m.length>2&&void 0!==m[2]?m[2]:{}).state,a=void 0===i?null:i,s=r.startFun,o=void 0===s?null:s,l=r.finishFun,u=void 0===l?null:l,null!==a){e.next=5;break}return e.next=4,qe();case 4:a=e.sent;case 5:return"other"in t&&"inputs"in t.other&&"direct_subset"in t.other.inputs&&null!==t.other.inputs.direct_subset&&a.inputs.setDirectSubset(new Int32Array(t.other.inputs.direct_subset)),e.next=8,Je(t.datasets,n);case 8:return c=e.sent,e.next=11,Pe(a,c,t.parameters,{startFun:o,finishFun:u});case 11:if("other"in t&&"custom_selections"in t.other&&"selections"in t.other.custom_selections)for(h=0,f=Object.entries(t.other.custom_selections.selections);h<f.length;h++)d=(0,k.Z)(f[h],2),v=d[0],p=d[1],a.custom_selections.addSelection(v,new Int32Array(p),{copy:!1});return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)}))),tt.apply(this,arguments)}var nt=n(6737);function rt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.group,a=void 0===i?"data":i,s=n.forceBuffer,o=void 0!==s&&s,l={path:t+"/simple.h5",$schema:"hdf5_data_frame/v1.json",data_frame:{dimensions:[e.numberOfRows(),e.numberOfColumns()],columns:[],row_names:!1},hdf5_data_frame:{group:a}},u=C._u({extension:".csv.gz"}),c=u,h=[],f=C.ll(u);try{var d=f.createGroup(a);d.writeDataSet("column_names","String",null,e.columnNames());var v=e.rowNames();null!==v&&(l.data_frame.row_names=!0,d.writeDataSet("row_names","String",null,v));for(var p=d.createGroup("data"),m=l.data_frame.columns,w=0;w<e.numberOfColumns();w++){var Z=e.column(w),_=e.columnNames()[w];if(Z instanceof Array){var g,b=new Set,y=!1,k=(0,r.Z)(Z);try{for(k.s();!(g=k.n()).done;){var A=g.value;null===A?y=!0:b.add(typeof A)}}catch(O){k.e(O)}finally{k.f()}if(b.size>1)throw new Error("column '"+_+"' has multiple types");if(b.has("string"))if(m.push({name:_,type:"string"}),y){for(var x=new Set(Z),E="NA";x.has(E);)E+="_";var S=Z.slice();for(w=0;w<S.length;w++)null===S[w]&&(S[w]=E);p.writeDataSet(String(w),"String",null,S).writeAttribute("missing-value-placeholder","String",null,E)}else p.writeDataSet(String(w),"String",null,Z);else if(b.has("number")){m.push({name:_,type:"number"});var I=C.RJ(Z.length);try{if(y){var B=I.array();for(w=0;w<Z.length;w++)null===Z[w]?B[w]=Number.NaN:B[w]=Z[w]}else I.set(Z);p.writeDataSet(String(w),"Float64",null,I)}finally{I.free()}}else{if(0!=b.size&&!b.has("boolean"))throw new Error("unknown type '"+Array.from(b)[0]+"' for column '"+_+"'");if(m.push({name:_,type:"boolean"}),y){var R=C.Wf(Z.length);try{for(w=0;w<Z.length;w++)null===Z[w]?temparr[w]=-2147483648:temparr[w]=Z[w];p.writeDataSet(String(w),"Int32",null,R)}finally{R.free()}}else{var F=C.TS(Z.length);try{F.fill(Z),p.writeDataSet(String(w),"Uint8",null,F)}finally{F.free()}}}}else if(Z instanceof Uint8Array||Z instanceof nt.yh)m.push({name:_,type:"boolean"}),p.writeDataSet(String(w),"Uint8",null,Z);else if(Z instanceof Int32Array||Z instanceof nt.do)m.push({name:_,type:"integer"}),p.writeDataSet(String(w),"Int32",null,Z);else if(Z instanceof Float64Array||Z instanceof nt.lt)m.push({name:_,type:"number"}),p.writeDataSet(String(w),"Float64",null,Z);else{if(!(Z instanceof P.NE))throw new Error("unknown type for column '"+_+"'");var z=rt(Z,t+"/column"+String(w),{group:a,forceBuffer:o});m.push({name:_,type:"other",resource:{type:"local",path:z.self.metadata.path}}),z.self.metadata.is_child=!0,h.push(z.self);var N,D=(0,r.Z)(z.children);try{for(D.s();!(N=D.n()).done;){var M=N.value;h.push(M)}}catch(O){D.e(O)}finally{D.f()}}}o&&(c=C.pJ(u),C.Yd(u))}catch(W){throw C.Yd(u),W}return{self:{metadata:l,contents:c},children:h}}function it(e,t,n){var r=C._u({extension:".h5"}),i=r;try{C.f(e,r,"matrix",{format:"tenx_matrix"}),n&&(i=C.pJ(r),C.Yd(r))}catch(a){throw C.Yd(r),a}return{metadata:{$schema:"hdf5_sparse_matrix/v1.json",path:t+"/matrix.h5",array:{dimensions:[e.numberOfRows(),e.numberOfColumns()],type:"integer"},hdf5_sparse_matrix:{group:"matrix",format:"tenx_matrix"}},contents:i}}function at(e,t,n,r,i){var a=C._u({extension:".h5"}),s=a;try{var o=C.ll(a).createGroup("logcounts");o.writeAttribute("delayed_type","String",null,"operation"),o.writeAttribute("delayed_operation","String",null,"unary arithmetic"),o.writeDataSet("value","Float64",null,Math.log(2)),o.writeDataSet("method","String",null,"/"),o.writeDataSet("side","String",null,"right");var l=o.createGroup("seed");l.writeAttribute("delayed_type","String",null,"operation"),l.writeAttribute("delayed_operation","String",null,"unary math"),l.writeDataSet("method","String",null,"log1p");var u=l.createGroup("seed");u.writeAttribute("delayed_type","String",null,"operation"),u.writeAttribute("delayed_operation","String",null,"unary arithmetic"),u.writeDataSet("value","Float64",null,t),u.writeDataSet("method","String",null,"/"),u.writeDataSet("side","String",null,"right"),u.writeDataSet("along","Int32",null,1);var c=u.createGroup("seed");c.writeAttribute("delayed_type","String",null,"array"),c.writeAttribute("delayed_array","String",null,"custom alabaster local array"),c.writeDataSet("dimensions","Int32",null,[e.numberOfRows(),e.numberOfColumns()]),c.writeDataSet("type","String",null,"FLOAT"),c.writeDataSet("path","String",null,r),i&&(s=C.pJ(a),C.Yd(a))}catch(h){throw C.Yd(a),h}return{metadata:{$schema:"hdf5_delayed_array/v1.json",path:n+"/array.h5",array:{dimensions:[e.numberOfRows(),e.numberOfColumns()],type:"number"},hdf5_delayed_array:{group:"logcounts"}},contents:s}}nt.yh.prototype._bioconductor_LENGTH=function(){return this.length},nt.do.prototype._bioconductor_LENGTH=function(){return this.length},nt.lt.prototype._bioconductor_LENGTH=function(){return this.length};var st={lfc:"lfc",delta_detected:"deltaDetected",auc:"auc",cohen:"cohen"};function ot(e,t,n){var r,i=e.numberOfCells(),a=e.numberOfPCs(),s=C._u({extension:".h5"}),o=s,l=C.ll(s);try{r=C.RJ(i*a);for(var u=e.principalComponents({copy:!1}),c=r.array(),h=0;h<i;h++)for(var f=0;f<a;f++)c[h+f*i]=u[f+h*a];l.writeDataSet("data","Float64",[a,i],r),n&&(o=C.pJ(s),C.Yd(s))}catch(d){throw C.Yd(s),d}finally{C.gd(r)}return{metadata:{$schema:"hdf5_dense_array/v1.json",path:t+"/matrix.h5",array:{dimensions:[i,a]},hdf5_dense_array:{dataset:"data"}},contents:o}}function lt(e,t,n){var r,i=e[0].length,a=e.length,s=C._u({extension:".h5"}),o=s,l=C.ll(s);try{r=C.RJ(i*a);for(var u=0;u<a;u++){if(e[u].length!==i)throw new Error("all dimensions must have the same length");r.set(e[u],i*u)}l.writeDataSet("data","Float64",[a,i],r),n&&(o=C.pJ(s),C.Yd(s))}catch(c){throw C.Yd(s),c}finally{C.gd(r)}return{metadata:{$schema:"hdf5_dense_array/v1.json",path:t+"/matrix.h5",array:{dimensions:[i,a]},hdf5_dense_array:{dataset:"data"}},contents:o}}var ut=n(714);function ct(e){var t;if(e instanceof Array){if(t={type:"list",values:[]},e.length){var n,i=!0,a=!0,s=!0,o=(0,r.Z)(e);try{for(o.s();!(n=o.n()).done;){var l=n.value;null!==l&&("string"!==typeof l&&(i=!1),"boolean"!==typeof l&&(a=!1),"number"!==typeof l&&(s=!1))}}catch(w){o.e(w)}finally{o.f()}if(i)t.type="string",t.values=e;else if(a)t.type="boolean",t.values=e;else if(s)t.type="number",t.values=e;else{var u,c=(0,r.Z)(e);try{for(c.s();!(u=c.n()).done;){var h=u.value;t.values.push(ct(h))}}catch(w){c.e(w)}finally{c.f()}}}}else if(e.constructor===Object){t={type:"list",values:[],names:[]};for(var f=0,d=Object.entries(e);f<d.length;f++){var v=(0,k.Z)(d[f],2),p=v[0],m=v[1];t.names.push(p),t.values.push(ct(m))}}else if(e instanceof Int32Array)t={type:"integer",values:Array.from(e)};else if(e instanceof nt.do)t={type:"integer",values:Array.from(e.array())};else if(e instanceof Float64Array)t={type:"number",values:Array.from(e)};else if(e instanceof nt.lt)t={type:"number",values:Array.from(e.array())};else if("number"==typeof e)t={type:"number",values:e};else if("string"==typeof e)t={type:"string",values:e};else{if("boolean"!=typeof e)throw new Error("don't know how to save entry of type '"+typeof e+"'");t={type:"boolean",values:e}}return t}function ht(e,t){var n=ct(e),r=JSON.stringify(n,null,2)+"\n";return{metadata:{$schema:"json_simple_list/v1.json",path:t+"/simple.json.gz",simple_list:{children:[]},json_simple_list:{compression:"gzip"}},contents:ut.iv(r)}}function ft(e,t,n,i,a,s,o){var l=[];e.cell_filtering.fetchDiscards().forEach((function(e,t){e||l.push(t)}));for(var u=l.length,c={},h=0,f=Object.keys(t);h<f.length;h++){c[f[h]]=new P.NE({},{numberOfRows:u})}if(e.rna_quality_control.valid()){var d=new P.NE({},{numberOfRows:u});d.$setColumn("sums",e.cell_filtering.applyFilter(e.rna_quality_control.fetchMetrics().sums({copy:!1}))),d.$setColumn("detected",e.cell_filtering.applyFilter(e.rna_quality_control.fetchMetrics().detected({copy:!1}))),d.$setColumn("proportions",e.cell_filtering.applyFilter(e.rna_quality_control.fetchMetrics().subsetProportions(0,{copy:!1}))),c.RNA.$setColumn("rna_quality_control",d),a.RNA.rna_quality_control={filters:{sums:e.rna_quality_control.fetchFilters().thresholdsSums(),detected:e.rna_quality_control.fetchFilters().thresholdsDetected(),proportions:e.rna_quality_control.fetchFilters().thresholdsSubsetProportions(0)}}}if(e.adt_quality_control.valid()){var v=new P.NE({},{numberOfRows:u});v.$setColumn("sums",e.cell_filtering.applyFilter(e.adt_quality_control.fetchMetrics().sums({copy:!1}))),v.$setColumn("detected",e.cell_filtering.applyFilter(e.adt_quality_control.fetchMetrics().detected({copy:!1}))),v.$setColumn("igg_totals",e.cell_filtering.applyFilter(e.adt_quality_control.fetchMetrics().subsetTotals(0,{copy:!1}))),c.ADT.$setColumn("adt_quality_control",v),a.ADT.adt_quality_control={filters:{detected:e.adt_quality_control.fetchFilters().thresholdsDetected(),igg_totals:e.adt_quality_control.fetchFilters().thresholdsSubsetTotals(0)}}}if(e.crispr_quality_control.valid()){var p=new P.NE({},{numberOfRows:u});p.$setColumn("sums",e.cell_filtering.applyFilter(e.crispr_quality_control.fetchMetrics().sums({copy:!1}))),p.$setColumn("detected",e.cell_filtering.applyFilter(e.crispr_quality_control.fetchMetrics().detected({copy:!1}))),p.$setColumn("max_proportion",e.cell_filtering.applyFilter(e.crispr_quality_control.fetchMetrics().maxProportions({copy:!1}))),p.$setColumn("max_index",e.cell_filtering.applyFilter(e.crispr_quality_control.fetchMetrics().maxIndex({copy:!1}))),c.CRISPR.$setColumn("crispr_quality_control",p),a.CRISPR.crispr_quality_control={filters:{max_count:e.crispr_quality_control.fetchFilters().thresholdsMaxCount()}}}e.rna_normalization.valid()&&c.RNA.$setColumn("sizeFactor",e.rna_normalization.fetchSizeFactors()),e.adt_normalization.valid()&&c.ADT.$setColumn("sizeFactor",e.adt_normalization.fetchSizeFactors()),e.crispr_normalization.valid()&&c.CRISPR.$setColumn("sizeFactor",e.crispr_normalization.fetchSizeFactors()),c[n].$setColumn("retained",l),c[n].$setColumn("clusters",e.choose_clustering.fetchClusters());var m=e.cell_filtering.fetchFilteredBlock();if(null!==m){c[n].$setColumn("block",m);var w=new Array(m.length),Z=e.inputs.fetchBlockLevels();m.forEach((function(e,t){w[t]=Z[e]})),c[n].$setColumn("named_block",w),a[n].block_levels=Z}for(var _=0,g=Object.entries(t);_<g.length;_++){var b=(0,k.Z)(g[_],2),y=b[0],A=b[1],x=rt(c[y],A+"coldata",{forceBuffer:o});x.self.metadata.is_child=!0,i[y].summarized_experiment.column_data.resource.path=x.self.metadata.path,s.push(x.self);var E,S=(0,r.Z)(x.children);try{for(S.s();!(E=S.n()).done;){var C=E.value;s.push(C)}}catch(I){S.e(I)}finally{S.f()}}}function dt(e,t,n,i,a,s,o){for(var l=e.inputs.fetchFeatureAnnotations(),u={},c=0,h=Object.keys(t);c<h.length;c++){var f=h[c];u[f]=l[f]}if("RNA"in t){var d=e.feature_selection.fetchResults(),v=new P.NE({mean:d.means({copy:"view"}),variance:d.variances({copy:"view"}),fitted:d.fitted({copy:"view"}),residual:d.residuals({copy:"view"})},{columnOrder:["mean","variance","fitted","residual"]});u.RNA=u.RNA.setColumn("feature_selection",v)}!function(e,t,n){var i,a={min:0,mean:1,min_rank:4},s=e.marker_detection.fetchParameters().compute_auc,o=(0,r.Z)(t);try{for(o.s();!(i=o.n()).done;){for(var l=i.value,u=e.marker_detection.fetchResults()[l],c=u.numberOfGroups(),h=n[l].numberOfRows(),f=new P.NE({},{numberOfRows:h}),d=0;d<c;d++){for(var v=new P.NE({},{numberOfRows:h}),p=0,m=["means","detected"];p<m.length;p++){var w=m[p];v.$setColumn(w,u[w](d,{copy:"view"}))}for(var Z=0,_=Object.entries(st);Z<_.length;Z++){var g=(0,k.Z)(_[Z],2),b=g[0],y=g[1];if("auc"!=b||s)for(var A=0,x=Object.entries(a);A<x.length;A++){var E=(0,k.Z)(x[A],2),S=E[0],C=E[1];v.$setColumn(b+"-"+S,u[y](d,{summary:C}))}}f.$setColumn(String(d),v)}n[l]=n[l].setColumn("marker_detection",f)}}catch(I){o.e(I)}finally{o.f()}}(e,Object.keys(t),u),function(e,t,n,i,a){for(var s=e.custom_selections.fetchParameters().compute_auc,o=e.custom_selections.fetchSelections(),l=(0,q.Z)({},o),u=0,c=Object.entries(l);u<c.length;u++){var h=(0,k.Z)(c[u],2),f=h[0],d=h[1];d instanceof Int32Array||(l[f]=new Int32Array(d))}a[n].custom_selections=l;var v,p=(0,r.Z)(t);try{for(p.s();!(v=p.n()).done;){for(var m=v.value,w=i[m].numberOfRows(),Z=new P.NE({},{numberOfRows:w}),_=0,g=Object.keys(o);_<g.length;_++){for(var b=g[_],y=e.custom_selections.fetchResults(b)[m],A=new P.NE({},{numberOfRows:w}),x=0,E=["means","detected"];x<E.length;x++){var S=E[x];A.$setColumn(S,y[S](1,{copy:"view"}))}for(var C=0,I=Object.entries(st);C<I.length;C++){var B=(0,k.Z)(I[C],2),R=B[0],F=B[1];("auc"!=R||s)&&A.$setColumn(R,y[F](1,{copy:"view"}))}Z.$setColumn(b,A)}i[m]=i[m].setColumn("custom_selections",Z)}}catch(z){p.e(z)}finally{p.f()}}(e,Object.keys(t),n,u,a);for(var p=0,m=Object.entries(t);p<m.length;p++){var w=(0,k.Z)(m[p],2),Z=w[0],_=w[1],g=rt(u[Z],_+"rowdata",{forceBuffer:o});g.self.metadata.is_child=!0,i[Z].summarized_experiment.row_data.resource.path=g.self.metadata.path,s.push(g.self);var b,y=(0,r.Z)(g.children);try{for(y.s();!(b=y.n()).done;){var A=b.value;s.push(A)}}catch(x){y.e(x)}finally{y.f()}}}function vt(e,t){return pt.apply(this,arguments)}function pt(){return pt=(0,T.Z)((0,U.Z)().mark((function e(t,n){var i,a,s,o,l,u,c,h,f,d,v,p,m,w,Z,_,g,b,y,A,x,E,S,C,I,B,R,F,z,N,D,M,O,W,Q,j,q,T,P,G,L,H,V,Y,J,X,$,K,ee,te,ne,re,ie=arguments;return(0,U.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(ie.length>2&&void 0!==ie[2]?ie[2]:{}).forceBuffer,a=void 0!==i&&i,s=t.inputs.fetchFeatureAnnotations(),o=Object.keys(s),(l="RNA")in s){u=[l],c=(0,r.Z)(o);try{for(c.s();!(h=c.n()).done;)(f=h.value)!==l&&u.push(f)}catch(ae){c.e(ae)}finally{c.f()}}else l=o[0];for(d=[],v={},p={},m={},w=0,Z=o;w<Z.length;w++)_=Z[w],g=n+"/",_!=l&&(g+="altexp-"+_+"/"),p[_]=g,b=g+"experiment.json",v[_]={$schema:"single_cell_experiment/v1.json",path:b,summarized_experiment:{row_data:{resource:{type:"local",path:null}},column_data:{resource:{type:"local",path:null}},assays:[],other_data:{resource:{type:"local",path:null}}},single_cell_experiment:{alternative_experiments:[],reduced_dimensions:[]}},y=t.cell_filtering.fetchFilteredMatrix().get(_),v[_].summarized_experiment.dimensions=[y.numberOfRows(),y.numberOfColumns()],_==l?v[_].single_cell_experiment.main_experiment_name=_:v[l].single_cell_experiment.alternative_experiments.push({name:_,resource:{type:"local",path:b}}),m[_]={};for(ft(t,p,l,v,m,d,a),dt(t,p,l,v,m,d,a),A=0,x=Object.entries(p);A<x.length;A++)E=(0,k.Z)(x[A],2),S=E[0],C=E[1],I=t.cell_filtering.fetchFilteredMatrix().get(S),(B=it(I,C+"assay-counts",a)).metadata.is_child=!0,v[S].summarized_experiment.assays.push({name:"counts",resource:{type:"local",path:B.metadata.path}}),d.push(B);R=0,F=Object.entries(p);case 14:if(!(R<F.length)){e.next=37;break}z=(0,k.Z)(F[R],2),N=z[0],D=z[1],M=null,e.t0=N,e.next="RNA"===e.t0?20:"ADT"===e.t0?22:"CRISPR"===e.t0?24:26;break;case 20:return M=t.rna_normalization,e.abrupt("break",26);case 22:return M=t.adt_normalization,e.abrupt("break",26);case 24:return M=t.crispr_normalization,e.abrupt("break",26);case 26:if(null!=M){e.next=28;break}return e.abrupt("continue",34);case 28:O=M.fetchNormalizedMatrix(),W=M.fetchSizeFactors(),(Q=at(O,W,D+"assay-logcounts",v[N].summarized_experiment.assays[0].resource.path,a)).metadata.is_child=!0,v[N].summarized_experiment.assays.push({name:"logcounts",resource:{type:"local",path:Q.metadata.path}}),d.push(Q);case 34:R++,e.next=14;break;case 37:j=(0,U.Z)().mark((function e(){var n,r,i,s,o,l,u;return(0,U.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(0,k.Z)(T[q],2),r=n[0],i=n[1],s=null,e.t0=r,e.next="RNA"===e.t0?5:"ADT"===e.t0?7:"CRISPR"===e.t0?9:11;break;case 5:return s=t.rna_pca,e.abrupt("break",11);case 7:return s=t.adt_pca,e.abrupt("break",11);case 9:return s=t.crispr_pca,e.abrupt("break",11);case 11:if(null!=s){e.next=13;break}return e.abrupt("return","continue");case 13:o=s.fetchPCs(),(l=ot(o,i+"reddim-pca",a)).metadata.is_child=!0,d.push(l),u=o.totalVariance(),m[r].pca={variance_explained:o.varianceExplained({copy:"view"}).map((function(e){return e/u}))},v[r].single_cell_experiment.reduced_dimensions.push({name:"PCA",resource:{type:"local",path:l.metadata.path}});case 20:case"end":return e.stop()}}),e)})),q=0,T=Object.entries(p);case 39:if(!(q<T.length)){e.next=47;break}return e.delegateYield(j(),"t1",41);case 41:if("continue"!==e.t1){e.next=44;break}return e.abrupt("continue",44);case 44:q++,e.next=39;break;case 47:P=0,G=["tsne","umap"];case 48:if(!(P<G.length)){e.next=60;break}return L=G[P],e.next=52,t[L].fetchResults({copy:!1});case 52:H=e.sent,(V=lt([H.x,H.y],p[l]+"reddim-"+L,a)).metadata.is_child=!0,v[l].single_cell_experiment.reduced_dimensions.push({name:L.toUpperCase(),resource:{type:"local",path:V.metadata.path}}),d.push(V);case 57:P++,e.next=48;break;case 60:return e.next=62,t.cell_labelling.fetchResults();case 62:for(m[l].cell_labelling=e.sent,Y=0,J=Object.entries(p);Y<J.length;Y++)X=(0,k.Z)(J[Y],2),$=X[0],K=X[1],ee=ht(m[$],K+"other"),v[$].summarized_experiment.other_data.resource.path=ee.metadata.path,ee.metadata.is_child=!0,d.push(ee);for(te=0,ne=o;te<ne.length;te++)(re=ne[te])!==l&&d.push({metadata:v[re]});return e.abrupt("return",{metadata:v[l],files:d});case 66:case"end":return e.stop()}}),e)}))),pt.apply(this,arguments)}var mt=n(8109);function wt(e){return Zt.apply(this,arguments)}function Zt(){return(Zt=(0,T.Z)((0,U.Z)().mark((function e(t){var n,i,a;return(0,U.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(0,r.Z)(t),e.prev=1,n.s();case 3:if((i=n.n()).done){e.next=12;break}if("contents"in(a=i.value)){e.next=7;break}return e.abrupt("continue",10);case 7:return e.next=9,(0,mt.FB)(a.contents);case 9:a.metadata.md5sum=e.sent;case 10:e.next=3;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),n.e(e.t0);case 17:return e.prev=17,n.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[1,14,17,20]])})))).apply(this,arguments)}function _t(e,t){throw new Error("cannot realize files into a directory in a web context")}var gt=n(5587);function bt(e,t){return yt.apply(this,arguments)}function yt(){return yt=(0,T.Z)((0,U.Z)().mark((function e(t,n){var r,i,a,s,o,l,u,c,h=arguments;return(0,U.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(r=h.length>2&&void 0!==h[2]?h[2]:{}).forceBuffer,a=void 0===i?null:i,s=r.directory,null!==(o=void 0===s?null:s)&&(a=!1),e.next=4,vt(t,n,{forceBuffer:a});case 4:return l=e.sent,u=l.metadata,(c=l.files).push({metadata:u}),c.push({metadata:{$schema:"redirection/v1.json",path:n,redirection:{targets:[{type:"local",location:u.path}]}}}),e.next=11,wt(c);case 11:if(a||null===o){e.next=14;break}return e.next=14,_t(0,0);case 14:return e.abrupt("return",c);case 15:case"end":return e.stop()}}),e)}))),yt.apply(this,arguments)}function kt(e){var t,n,i=new gt,a=(0,r.Z)(e);try{for(a.s();!(t=a.n()).done;){var s=t.value,o=void 0;"contents"in s?(o=".json",s.contents instanceof Uint8Array?i.file(s.metadata.path,s.contents):i.file(s.metadata.path,(n=s.contents,C.pJ(n)))):o=s.metadata.$schema.startsWith("redirection/")?".json":"",i.file(s.metadata.path+o,JSON.stringify(s.metadata,null,2)+"\n")}}catch(l){a.e(l)}finally{a.f()}return i.generateAsync({type:"uint8array"})}var At=n(4071);function xt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.numberOfThreads,n=void 0===t?1:t,r=e.localFile,i=void 0!==r&&r,a=C.j2({numberOfThreads:n,localFile:i});return At.yc.localFile=i,a.then((function(e){return null}))}},9489:function(e,t,n){n.d(t,{Fl:function(){return T},zD:function(){return Z.z},H$:function(){return Ce},By:function(){return r.B},en:function(){return Y.e},cO:function(){return ze},bw:function(){return m.bw},Qr:function(){return m.Qr}});var r=n(2152),i=n(4165),a=n(5861),s=n(5671),o=n(3144),l=n(8652),u=n(2346),c=n(3889),h=n(2793),f=n(8916),d=n(3324),v=n(5831),p=n(7462),m=n(7173),w=n(3121),Z=n(6016);function _(e,t){var n=[];if("X"in e.children&&n.push("X"),"layers"in e.children){var r=e.open("layers");if(!(r instanceof v.Fv))throw new Error("expected a 'layers' group in a H5AD file");for(var i=0,a=Object.keys(r.children);i<a.length;i++){var s=a[i];n.push("layers/"+s)}}if(0==n.length)throw new Error("failed to find any assay in the H5AD file");var o=v.N6(t,n[0]);return{names:n,rows:o.rows,columns:o.columns}}function g(e){for(var t={},n=0,r=Object.entries(e.children);n<r.length;n++){var i=(0,d.Z)(r[n],2),a=i[0],s=i[1];if("DataSet"==s){var o=e.open(a,{load:!0});t[a]=o.values}else if("Group"==s){var l=e.open(a);if("categories"in l.children&&"codes"in l.children){var u=m.vp(l,"categories"),c=l.open("codes",{load:!0}).values;t[a]=p.Nd(u,c)}}}if("__categories"in e.children&&"Group"==e.children.__categories)for(var h=e.open("__categories"),f=0,v=Object.entries(h.children);f<v.length;f++){var w=(0,d.Z)(v[f],2),Z=w[0];w[1];if(Z in t){var _=m.vp(h,Z);t[Z]=p.Nd(_,t[Z])}}if(0==Object.keys(t).length)return null;var g=null;return"_index"in t&&(g=t._index,delete t._index),new p.NE(t,{rowNames:g})}function b(e){return"var"in e.children&&"Group"==e.children.var?g(e.open("var")):null}function y(e){return"obs"in e.children&&"Group"==e.children.obs?g(e.open("obs")):null}var k=new WeakMap,A=new WeakMap,x=new WeakMap,E=new WeakMap,S=new WeakMap,C=new WeakMap,I=new WeakMap,B=new WeakMap,R=new WeakMap,F=new WeakMap,z=new WeakMap,N=new WeakMap,D=new WeakMap,M=new WeakMap,O=new WeakMap,W=new WeakSet,Q=new WeakSet,j=new WeakSet,q=new WeakSet,U=new WeakSet,T=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.countMatrixName,i=void 0===r?null:r,a=n.featureTypeColumnName,o=void 0===a?null:a,c=n.featureTypeRnaName,f=void 0===c?"Gene Expression":c,d=n.featureTypeAdtName,v=void 0===d?"Antibody Capture":d,p=n.featureTypeCrisprName,m=void 0===p?"CRISPR Guide Capture":p,w=n.primaryRnaFeatureIdColumn,_=void 0===w?"_index":w,g=n.primaryAdtFeatureIdColumn,b=void 0===g?"_index":g,y=n.primaryCrisprFeatureIdColumn,T=void 0===y?"_index":y;(0,s.Z)(this,e),(0,l.Z)(this,U),(0,l.Z)(this,q),(0,l.Z)(this,j),(0,l.Z)(this,Q),(0,l.Z)(this,W),(0,u.Z)(this,k,{writable:!0,value:void 0}),(0,u.Z)(this,A,{writable:!0,value:void 0}),(0,u.Z)(this,x,{writable:!0,value:void 0}),(0,u.Z)(this,E,{writable:!0,value:void 0}),(0,u.Z)(this,S,{writable:!0,value:void 0}),(0,u.Z)(this,C,{writable:!0,value:void 0}),(0,u.Z)(this,I,{writable:!0,value:void 0}),(0,u.Z)(this,B,{writable:!0,value:void 0}),(0,u.Z)(this,R,{writable:!0,value:void 0}),(0,u.Z)(this,F,{writable:!0,value:void 0}),(0,u.Z)(this,z,{writable:!0,value:void 0}),(0,u.Z)(this,N,{writable:!0,value:void 0}),(0,u.Z)(this,D,{writable:!0,value:void 0}),(0,u.Z)(this,M,{writable:!0,value:void 0}),(0,u.Z)(this,O,{writable:!0,value:void 0}),t instanceof Z.z?(0,h.Z)(this,k,t):(0,h.Z)(this,k,new Z.z(t)),(0,h.Z)(this,B,i),(0,h.Z)(this,R,o),(0,h.Z)(this,F,f),(0,h.Z)(this,z,v),(0,h.Z)(this,N,m),(0,h.Z)(this,D,_),(0,h.Z)(this,M,b),(0,h.Z)(this,O,T),this.clear()}return(0,o.Z)(e,[{key:"setCountMatrixName",value:function(e){(0,h.Z)(this,B,e)}},{key:"setFeatureTypeColumnName",value:function(e){(0,h.Z)(this,R,e)}},{key:"setFeatureTypeRnaName",value:function(e){(0,h.Z)(this,F,e)}},{key:"setFeatureTypeAdtName",value:function(e){(0,h.Z)(this,z,e)}},{key:"setFeatureTypeCrisprName",value:function(e){(0,h.Z)(this,N,e)}},{key:"setPrimaryRnaFeatureIdColumn",value:function(e){(0,h.Z)(this,D,e)}},{key:"setPrimaryAdtFeatureIdColumn",value:function(e){(0,h.Z)(this,M,e)}},{key:"setPrimaryCrisprFeatureIdColumn",value:function(e){(0,h.Z)(this,O,e)}},{key:"clear",value:function(){"function"==typeof(0,f.Z)(this,x)&&(0,f.Z)(this,x).call(this),(0,h.Z)(this,x,null),(0,h.Z)(this,A,null),(0,h.Z)(this,E,null),(0,h.Z)(this,S,null),(0,h.Z)(this,C,null),(0,h.Z)(this,I,null)}},{key:"abbreviate",value:function(){return(0,c.Z)(this,W,P).call(this,(function(e){return{name:e.name(),size:e.size()}}))}},{key:"summary",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).cache,t=void 0!==e&&e;(0,c.Z)(this,q,H).call(this),(0,c.Z)(this,U,V).call(this),(0,c.Z)(this,j,L).call(this);var n={all_features:(0,f.Z)(this,S),cells:(0,f.Z)(this,C),all_assay_names:(0,f.Z)(this,I).names};return t||this.clear(),n}},{key:"load",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).cache,t=void 0!==e&&e;(0,c.Z)(this,q,H).call(this),(0,c.Z)(this,U,V).call(this),(0,c.Z)(this,j,L).call(this);var n=(0,f.Z)(this,B);null==n&&(n=(0,f.Z)(this,I).names[0]);var r=v.EF((0,f.Z)(this,A),n),i={RNA:(0,f.Z)(this,F),ADT:(0,f.Z)(this,z),CRISPR:(0,f.Z)(this,N)},a=w.Bs(r,(0,f.Z)(this,S),(0,f.Z)(this,R),i,"RNA");a.cells=(0,f.Z)(this,C);var s={RNA:(0,f.Z)(this,D),ADT:(0,f.Z)(this,M),CRISPR:(0,f.Z)(this,O)};return a.primary_ids=w.P2(a.features,s),t||this.clear(),a}},{key:"serialize",value:function(){return(0,c.Z)(this,W,P).call(this,(function(e){return e}))}}],[{key:"format",value:function(){return"H5AD"}},{key:"unserialize",value:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(n,r){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1==n.length&&"h5"==n[0].type){t.next=2;break}throw new Error("expected exactly one file of type 'h5' for H5AD unserialization");case 2:return t.abrupt("return",new e(n[0].file,r));case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}]),e}();function P(e){return{files:[{type:"h5",file:e((0,f.Z)(this,k))}],options:{countMatrixName:(0,f.Z)(this,B),featureTypeColumnName:(0,f.Z)(this,R),featureTypeRnaName:(0,f.Z)(this,F),featureTypeAdtName:(0,f.Z)(this,z),featureTypeCrisprName:(0,f.Z)(this,N),primaryRnaFeatureIdColumn:(0,f.Z)(this,D),primaryAdtFeatureIdColumn:(0,f.Z)(this,M),primaryCrisprFeatureIdColumn:(0,f.Z)(this,O)}}}function G(){if(null==(0,f.Z)(this,A)){var e=v.$H((0,f.Z)(this,k).content());(0,h.Z)(this,A,e.path),(0,h.Z)(this,x,e.flush),(0,h.Z)(this,E,new v.pT((0,f.Z)(this,A)))}}function L(){null===(0,f.Z)(this,I)&&((0,c.Z)(this,Q,G).call(this),(0,h.Z)(this,I,_((0,f.Z)(this,E),(0,f.Z)(this,A))))}function H(){if(null===(0,f.Z)(this,S)){(0,c.Z)(this,Q,G).call(this);var e=b((0,f.Z)(this,E));null==e&&((0,c.Z)(this,j,L).call(this),e=new p.NE({},{numberOfRows:(0,f.Z)(this,I).rows})),(0,h.Z)(this,S,e)}}function V(){if(null===(0,f.Z)(this,C)){(0,c.Z)(this,Q,G).call(this);var e=y((0,f.Z)(this,E));null===e&&((0,c.Z)(this,j,L).call(this),e=new p.NE({},{numberOfRows:(0,f.Z)(this,I).columns})),(0,h.Z)(this,C,e)}}var Y=n(7355);function J(e){var t,n,r=e.findAttribute("names");if(r<0)return null;try{n=(t=e.attribute(r)).values()}catch(i){throw new Error("failed to load listData names; "+i.message)}finally{v.gd(t)}if(n.length!=e.length())throw new Error("expected names to have same length as listData");return n}var X={DFrame:"S4Vectors"};function $(e){ee(e,X,"DFrame");var t,n,r={},i=[];try{if(!((t=e.attribute("listData"))instanceof v.SV))throw new Error("listData slot should be a generic list");if(null==(i=J(t)))throw new Error("expected the listData list to be named");for(var a=function(){var e;try{if((e=t.load(s))instanceof v.qu&&!(e instanceof v.SV)){var n,a,o=e.values();if(e.findAttribute("class")>=0)try{if((n=e.attribute("class")).values().indexOf("factor")>=0&&e.findAttribute("levels")>=0){a=e.attribute("levels");var l=o.slice();l.forEach((function(e,t){l[t]=e-1})),o=p.Nd(a.values(),l)}}finally{v.gd(n),v.gd(a)}r[i[s]]=o}else e instanceof v.BA&&K(e,X)&&(r[i[s]]=$(e))}finally{v.gd(e)}},s=0;s<t.length();s++)a()}catch(h){throw new Error("failed to retrieve data from DataFrame's listData; "+h.message)}finally{v.gd(t)}var o=null;try{(n=e.attribute("rownames"))instanceof v.II&&(o=n.values())}catch(h){throw new Error("failed to retrieve row names from DataFrame; "+h.message)}finally{v.gd(n)}var l,u=null;if(0==i.length&&null==o)try{if(!((l=e.attribute("nrows"))instanceof v.D6))throw new Error("expected an integer vector as the 'nrows' slot");var c=l.values();if(1!=c.length)throw new Error("expected an integer vector of length 1 as the 'nrows' slot");u=c[0]}catch(h){throw new Error("failed to retrieve nrows from DataFrame; "+h.message)}finally{v.gd(l)}return new p.NE(r,{columnOrder:i,rowNames:o,numberOfRows:u})}function K(e,t){for(var n=0,r=Object.entries(t);n<r.length;n++){var i=(0,d.Z)(r[n],2),a=i[0],s=i[1];if(e.className()==a&&e.packageName()==s)return!0}return!1}function ee(e,t,n){if(!(e instanceof v.BA))throw new Error("expected an S4 object as the data frame");if(!K(e,t))throw new Error("object is not a "+n+" or one of its recognized subclasses")}function te(e){var t,n=e.findAttribute("NAMES");if(n<0)return null;var r=null;try{(t=e.attribute(n))instanceof v.II&&(r=t.values())}catch(i){throw new Error("failed to extract NAMES; "+i.message)}finally{v.gd(t)}return r}function ne(e){var t,n=null,r=e.findAttribute("rowRanges");if(r<0){var i;try{t=$(i=e.attribute("elementMetadata"))}catch(c){throw new Error("failed to extract features from the rowData; "+c.message)}finally{v.gd(i)}n=te(e)}else{var a;try{var s=(a=e.attribute(r)).attribute("elementMetadata");try{t=$(s)}catch(c){throw new Error("failed to extract mcols from the rowRanges; "+c.message)}finally{v.gd(s)}var o,l,u=a.findAttribute("partitioning");if(u<0)try{n=te(o=a.attribute("ranges"))}catch(c){throw new Error("failed to extract names from the rowRanges; "+c.message)}finally{v.gd(o)}else try{n=te(l=a.attribute(u))}catch(c){throw new Error("failed to extract names from the rowRanges; "+c.message)}finally{v.gd(l)}}catch(c){throw new Error("failed to extract features from the rowRanges; "+c.message)}finally{v.gd(a)}}return null!==n&&t.$setRowNames(n),t}function re(e){var t,n,r,i;try{null==(t=J(i=(r=(n=e.attribute("assays")).attribute("data")).attribute("listData")))&&(t=new Array(i.length())).fill(null)}catch(a){throw new Error("failed to extract assay data; "+a.message)}finally{v.gd(n),v.gd(i),v.gd(r)}return t}function ie(e,t,n){var r,i,a,s;try{s=(a=(i=e.attribute("assays")).attribute("data")).attribute("listData");var o,l=null;if("string"==typeof t){var u=J(s);if(null!==t&&null!=u)for(var c=0;c<u.length;c++)if(u[c]==t){l=c;break}if(null==l)throw new Error("no assay named '"+t+"'")}else{if(t>=s.length())throw new Error("assay index "+String(t)+" out of range");l=t}try{o=s.load(l),r=v.Bp(o,{forceInteger:n})}catch(h){throw new Error("failed to initialize sparse matrix from assay; "+h.message)}finally{v.gd(o)}}catch(h){throw new Error("failed to extract assay data; "+h.message)}finally{v.gd(i),v.gd(s),v.gd(a)}return r}function ae(e){var t,n,r,i,a,s,o={handles:{},order:[]},l=e.findAttribute("int_colData");if(l<0)return o;try{var u=(t=e.attribute(l)).findAttribute("listData");if(u<0)return o;var c=(n=t.attribute(u)).findAttribute("names");if(c<0)return o;var h=(r=n.attribute(c)).values().indexOf("altExps");if(h<0)return o;var f=(i=n.load(h)).findAttribute("listData");if(f<0)return o;var d=(a=i.attribute(f)).findAttribute("names");if(d<0)return o;for(var p=(s=a.attribute(d)).values(),m=0;m<p.length;m++){var w=void 0;try{var Z=(w=a.load(m)).attribute("se");o.handles[p[m]]=Z,o.order.push(p[m]),se(Z)}catch(y){throw new Error("failed to load alternative Experiment '"+p[m]+"'; "+y.message)}finally{v.gd(w)}}}catch(y){for(var _=0,g=Object.values(o.handles);_<g.length;_++){var b=g[_];v.gd(b)}throw y}finally{v.gd(s),v.gd(a),v.gd(r),v.gd(n),v.gd(t)}return o}function se(e){ee(e,{SummarizedExperiment:"SummarizedExperiment",RangedSummarizedExperiment:"SummarizedExperiment",SingleCellExperiment:"SingleCellExperiment",SpatialExperiment:"SpatialExperiment"},"SummarizedExperiment")}var oe="",le=new WeakMap,ue=new WeakMap,ce=new WeakMap,he=new WeakMap,fe=new WeakMap,de=new WeakMap,ve=new WeakMap,pe=new WeakMap,me=new WeakMap,we=new WeakMap,Ze=new WeakMap,_e=new WeakMap,ge=new WeakMap,be=new WeakMap,ye=new WeakMap,ke=new WeakMap,Ae=new WeakSet,xe=new WeakSet,Ee=new WeakSet,Se=new WeakSet,Ce=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.rnaCountAssay,i=void 0===r?0:r,a=n.adtCountAssay,o=void 0===a?0:a,c=n.crisprCountAssay,f=void 0===c?0:c,d=n.rnaExperiment,v=void 0===d?"":d,p=n.adtExperiment,m=void 0===p?"Antibody Capture":p,w=n.crisprExperiment,_=void 0===w?"CRISPR Guide Capture":w,g=n.primaryRnaFeatureIdColumn,b=void 0===g?null:g,y=n.primaryAdtFeatureIdColumn,k=void 0===y?null:y,A=n.primaryCrisprFeatureIdColumn,x=void 0===A?null:A;(0,s.Z)(this,e),(0,l.Z)(this,Se),(0,l.Z)(this,Ee),(0,l.Z)(this,xe),(0,l.Z)(this,Ae),(0,u.Z)(this,le,{writable:!0,value:void 0}),(0,u.Z)(this,ue,{writable:!0,value:void 0}),(0,u.Z)(this,ce,{writable:!0,value:void 0}),(0,u.Z)(this,he,{writable:!0,value:void 0}),(0,u.Z)(this,fe,{writable:!0,value:void 0}),(0,u.Z)(this,de,{writable:!0,value:void 0}),(0,u.Z)(this,ve,{writable:!0,value:void 0}),(0,u.Z)(this,pe,{writable:!0,value:void 0}),(0,u.Z)(this,me,{writable:!0,value:void 0}),(0,u.Z)(this,we,{writable:!0,value:void 0}),(0,u.Z)(this,Ze,{writable:!0,value:void 0}),(0,u.Z)(this,_e,{writable:!0,value:void 0}),(0,u.Z)(this,ge,{writable:!0,value:void 0}),(0,u.Z)(this,be,{writable:!0,value:void 0}),(0,u.Z)(this,ye,{writable:!0,value:void 0}),(0,u.Z)(this,ke,{writable:!0,value:void 0}),t instanceof Z.z?(0,h.Z)(this,le,t):(0,h.Z)(this,le,new Z.z(t)),(0,h.Z)(this,pe,i),(0,h.Z)(this,me,o),(0,h.Z)(this,we,f),(0,h.Z)(this,Ze,v),(0,h.Z)(this,_e,m),(0,h.Z)(this,ge,_),(0,h.Z)(this,be,b),(0,h.Z)(this,ye,k),(0,h.Z)(this,ke,x),this.clear()}return(0,o.Z)(e,[{key:"setRnaCountAssay",value:function(e){(0,h.Z)(this,pe,e)}},{key:"setAdtCountAssay",value:function(e){(0,h.Z)(this,me,e)}},{key:"setCrisprCountAssay",value:function(e){(0,h.Z)(this,me,e)}},{key:"setRnaExperiment",value:function(e){(0,h.Z)(this,Ze,e)}},{key:"setAdtExperiment",value:function(e){(0,h.Z)(this,_e,e)}},{key:"setCrisprExperiment",value:function(e){(0,h.Z)(this,ge,e)}},{key:"setPrimaryRnaFeatureIdColumn",value:function(e){(0,h.Z)(this,be,e)}},{key:"setPrimaryAdtFeatureIdColumn",value:function(e){(0,h.Z)(this,ye,e)}},{key:"setPrimaryCrisprFeatureIdColumn",value:function(e){(0,h.Z)(this,ke,e)}},{key:"clear",value:function(){if(v.gd((0,f.Z)(this,ce)),"undefined"!=typeof(0,f.Z)(this,he)&&null!==(0,f.Z)(this,he))for(var e=0,t=Object.values((0,f.Z)(this,he));e<t.length;e++){var n=t[e];v.gd(n)}v.gd((0,f.Z)(this,ue)),(0,h.Z)(this,ce,null),(0,h.Z)(this,he,null),(0,h.Z)(this,ue,null),(0,h.Z)(this,de,null),(0,h.Z)(this,ve,null)}},{key:"abbreviate",value:function(){return(0,c.Z)(this,Ae,Ie).call(this,(function(e){return{name:e.name(),size:e.size()}}))}},{key:"summary",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).cache,t=void 0!==e&&e;(0,c.Z)(this,xe,Be).call(this),(0,c.Z)(this,Ee,Re).call(this),(0,c.Z)(this,Se,Fe).call(this);var n={};n[oe]=re((0,f.Z)(this,ce));for(var r=0,i=Object.entries((0,f.Z)(this,he));r<i.length;r++){var a=(0,d.Z)(i[r],2),s=a[0],o=a[1];try{n[s]=re(o)}catch(u){console.warn("failed to extract features for alternative Experiment '"+s+"'; "+u.message)}}var l={modality_features:(0,f.Z)(this,de),cells:(0,f.Z)(this,ve),modality_assay_names:n};return t||this.clear(),l}},{key:"load",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).cache,t=void 0!==e&&e;(0,c.Z)(this,xe,Be).call(this),(0,c.Z)(this,Ee,Re).call(this),(0,c.Z)(this,Se,Fe).call(this);var n={matrix:new v.VU,row_ids:{},features:{},cells:(0,f.Z)(this,ve)},r={RNA:{exp:(0,f.Z)(this,Ze),assay:(0,f.Z)(this,pe)},ADT:{exp:(0,f.Z)(this,_e),assay:(0,f.Z)(this,me)},CRISPR:{exp:(0,f.Z)(this,ge),assay:(0,f.Z)(this,we)}};try{for(var i=0,a=Object.entries(r);i<a.length;i++){var s=(0,d.Z)(a[i],2),o=s[0],l=s[1];if(null!==l.exp){var u=void 0,h=l.exp;if("string"==typeof l.exp)if(""===l.exp)u=(0,f.Z)(this,ce);else{if(!(l.exp in(0,f.Z)(this,he)))continue;u=(0,f.Z)(this,he)[l.exp]}else{if(l.exp>=(0,f.Z)(this,fe).length)continue;h=(0,f.Z)(this,fe)[l.exp],u=(0,f.Z)(this,he)[h]}var m=ie(u,l.assay,!0);n.matrix.add(o,m.matrix);var Z=m.row_ids;n.row_ids[o]=Z,n.features[o]=p.Nd((0,f.Z)(this,de)[h],Z)}}var _={RNA:(0,f.Z)(this,be),ADT:(0,f.Z)(this,ye),CRISPR:(0,f.Z)(this,ke)};n.primary_ids=w.P2(n.features,_)}catch(g){throw v.gd(n.matrix),g}return t||this.clear(),n}},{key:"serialize",value:function(){return(0,c.Z)(this,Ae,Ie).call(this,(function(e){return e}))}}],[{key:"format",value:function(){return"SummarizedExperiment"}},{key:"unserialize",value:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(n,r){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1==n.length&&"rds"==n[0].type){t.next=2;break}throw new Error("expected exactly one file of type 'rds' for SummarizedExperiment unserialization");case 2:return t.abrupt("return",new e(n[0].file,r));case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}]),e}();function Ie(e){return{files:[{type:"rds",file:e((0,f.Z)(this,le))}],options:{rnaCountAssay:(0,f.Z)(this,pe),adtCountAssay:(0,f.Z)(this,me),crisprCountAssay:(0,f.Z)(this,we),rnaExperiment:(0,f.Z)(this,Ze),adtExperiment:(0,f.Z)(this,_e),crisprExperiment:(0,f.Z)(this,ge),primaryRnaFeatureIdColumn:(0,f.Z)(this,be),primaryAdtFeatureIdColumn:(0,f.Z)(this,ye),primaryCrisprFeatureIdColumn:(0,f.Z)(this,ke)}}}function Be(){if(null===(0,f.Z)(this,ue)){(0,h.Z)(this,ue,v.p$((0,f.Z)(this,le).content())),(0,h.Z)(this,ce,(0,f.Z)(this,ue).value());try{se((0,f.Z)(this,ce));var e=ae((0,f.Z)(this,ce)),t=e.handles,n=e.order;(0,h.Z)(this,he,t),(0,h.Z)(this,fe,n)}catch(r){throw(0,f.Z)(this,ce).free(),(0,f.Z)(this,ue).free(),r}}}function Re(){if(null===(0,f.Z)(this,de)){(0,c.Z)(this,xe,Be).call(this),(0,h.Z)(this,de,{}),(0,f.Z)(this,de)[oe]=ne((0,f.Z)(this,ce));for(var e=0,t=Object.entries((0,f.Z)(this,he));e<t.length;e++){var n=(0,d.Z)(t[e],2),r=n[0],i=n[1];try{(0,f.Z)(this,de)[r]=ne(i)}catch(a){console.warn("failed to extract features for alternative Experiment '"+r+"'; "+a.message)}}}}function Fe(){if(null===(0,f.Z)(this,ve)){(0,c.Z)(this,xe,Be).call(this);var e=(0,f.Z)(this,ce).attribute("colData");try{(0,h.Z)(this,ve,$(e))}catch(t){throw new Error("failed to extract colData from a SummarizedExperiment; "+t.message)}finally{v.gd(e)}}}n(5173),n(2121);var ze={"10X":r.B,MatrixMarket:Y.e,H5AD:T,SummarizedExperiment:Ce}},6546:function(e,t,n){n.d(t,{Cy:function(){return _},ED:function(){return U},tq:function(){return E}});var r=n(7762),i=n(4165),a=n(3324),s=n(5861),o=n(1413),l=n(5671),u=n(3144),c=n(8652),h=n(2346),f=n(3889),d=n(2415),v=n(8916),p=n(2793),m=n(5831),w=n(7462),Z=n(7891),_=(n(9489),"inputs"),g="raw_subset_indices",b=new WeakMap,y=new WeakMap,k=new WeakMap,A=new WeakMap,x=new WeakSet,E=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(0,l.Z)(this,e),(0,c.Z)(this,x),(0,h.Z)(this,b,{writable:!0,value:void 0}),(0,h.Z)(this,y,{writable:!0,value:void 0}),(0,h.Z)(this,k,{writable:!0,value:void 0}),(0,h.Z)(this,A,{writable:!0,value:void 0}),(0,p.Z)(this,b,null===t?{}:t),(0,p.Z)(this,y,null===n?{}:n),(0,p.Z)(this,k,null===r?{}:r),(0,p.Z)(this,A,!1),this.changed=!1}return(0,u.Z)(e,[{key:"free",value:function(){Z.Yl((0,v.Z)(this,y).matrix),Z.Yl((0,v.Z)(this,y).raw_matrix),Z.Yl((0,v.Z)(this,y).block_ids),Z.Yl((0,v.Z)(this,y).raw_block_ids),Z.Yl((0,v.Z)(this,y).multi_block_ids)}},{key:"fetchCountMatrix",value:function(){return(0,v.Z)(this,y).matrix}},{key:"fetchFeatureAnnotations",value:function(){return(0,v.Z)(this,y).genes}},{key:"fetchRowIds",value:function(){return(0,v.Z)(this,y).row_ids}},{key:"fetchCellAnnotations",value:function(){return(0,v.Z)(this,y).annotations}},{key:"fetchBlock",value:function(){return(0,v.Z)(this,y).block_ids}},{key:"fetchBlockLevels",value:function(){return(0,v.Z)(this,y).block_levels}},{key:"fetchParameters",value:function(){var t,n=(0,o.Z)({},(0,v.Z)(this,b));return n.subset=(0,d.Z)(t=this.constructor,e,S).call(t,n.subset),n}},{key:"fetchDatasets",value:function(){return(0,v.Z)(this,y).datasets}},{key:"fetchDirectSubset",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).copy,t=void 0===e||e;if(g in(0,v.Z)(this,y)){var n=(0,v.Z)(this,y)[g];return t?n.slice():n}return null}},{key:"guessRnaFeatureTypes",value:function(){return"RNA"in(0,v.Z)(this,y).genes?("inferred_rna_types"in(0,v.Z)(this,y)||((0,v.Z)(this,y).inferred_rna_types=Z.zS((0,v.Z)(this,y).genes.RNA)),(0,v.Z)(this,y).inferred_rna_types):null}},{key:"enableDatasetCache",value:function(e){(0,p.Z)(this,A,e)}},{key:"compute",value:function(){var t=(0,s.Z)((0,i.Z)().mark((function t(n,r){var s,l,u,c,h,f,m,w,_;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=r.block_factor,l=r.subset,this.changed=!1,null===n){t.next=12;break}for(u={},c=0,h=Object.entries(n);c<h.length;c++)f=(0,a.Z)(h[c],2),m=f[0],w=f[1],u[m]={format:w.constructor.format(),details:w.abbreviate()};if(!Z.xi(u,(0,v.Z)(this,k))){t.next=12;break}return t.next=8,O(n,(0,v.Z)(this,y),(0,v.Z)(this,A));case 8:(0,p.Z)(this,k,u),(0,v.Z)(this,y).datasets=(0,o.Z)({},n),delete(0,v.Z)(this,y).inferred_rna_types,this.changed=!0;case 12:return(this.changed||(0,v.Z)(this,b).block_factor!==s)&&(Q(s,(0,v.Z)(this,y)),(0,v.Z)(this,b).block_factor=s,this.changed=!0),(this.changed||!(g in(0,v.Z)(this,y))&&Z.xi(l,(0,v.Z)(this,b).subset)||!("matrix"in(0,v.Z)(this,y)))&&(j(l,(0,v.Z)(this,y)),(0,v.Z)(this,b).subset=(0,d.Z)(_=this.constructor,e,S).call(_,l),this.changed=!0),t.abrupt("return",null);case 15:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"undoSubset",value:function(e){if("matrix"in(0,v.Z)(this,y)){var t,n=this.fetchCountMatrix().numberOfColumns(),i=(0,r.Z)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a<0||a>=n)throw new Error("entries of 'indices' should be less than the number of cells in the dataset")}}catch(l){i.e(l)}finally{i.f()}}var s=null;"subset"in(0,v.Z)(this,b)&&(s=(0,v.Z)(this,b).subset);var o=M(s,(0,v.Z)(this,y));null!==o&&e.forEach((function(t,n){e[n]=o[t]}))}},{key:"setDirectSubset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.copy,r=void 0===n||n,i=t.onOriginal,a=void 0!==i&&i;null!==e?(0,v.Z)(this,y)[g]=(0,f.Z)(this,x,C).call(this,e,r,a):delete(0,v.Z)(this,y)[g],m.gd((0,v.Z)(this,y).matrix),delete(0,v.Z)(this,y).matrix}},{key:"createDirectSubset",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.copy,i=void 0===r||r,a=n.onOriginal,s=void 0!==a&&a,o={};o[g]=(0,f.Z)(this,x,C).call(this,t,i,s),o.raw_matrix=(0,v.Z)(this,y).raw_matrix.clone();for(var l=0,u=["multi_block_ids","raw_block_ids"];l<u.length;l++){var c=u[l];c in(0,v.Z)(this,y)&&(null===(0,v.Z)(this,y)[c]?o[c]=null:o[c]=(0,v.Z)(this,y)[c].clone())}for(var h=0,d=["row_ids","raw_annotations","genes","multi_block_levels","raw_block_levels"];h<d.length;h++){var p=d[h];p in(0,v.Z)(this,y)&&(o[p]=(0,v.Z)(this,y)[p])}j(null,o);var m=this.fetchParameters();return m.subset=null,new e(m,o,(0,v.Z)(this,k))}}],[{key:"defaults",value:function(){return{block_factor:null,subset:null}}}]),e}();function S(e){if(null==e)return e;var t=(0,o.Z)({},e);return"values"in t&&(t.values=t.values.slice()),"ranges"in t&&(t.ranges=t.ranges.map((function(e){return e.slice()}))),t}function C(e,t,n){return Z.N2(e,null),t&&(e=e.slice()),n||this.undoSubset(e),e}var I=["RNA","ADT","CRISPR"];function B(e,t){var n={};try{for(var r=[],i=[],a=0;a<t.length;a++){i.push(t[a].matrix.get(e));var s=t[a].primary_ids[e];if(null==s)throw new Error("modality '"+e+"' lacks a primary identifier for dataset "+String(a));r.push(s)}var o=m.KV(i,r);n.matrix=o.matrix,n.features=w.Nd(t[0].features[e],o.indices),n.row_ids=w.Nd(t[0].row_ids[e],o.indices)}catch(l){throw Z.Yl(n.matrix),l}return n}function R(e,t){var n,i,a=[],s=(0,r.Z)(I);try{for(s.s();!(n=s.n()).done;){var o,l=n.value,u=!0,c=(0,r.Z)(t);try{for(c.s();!(o=c.n()).done;){if(!o.value.matrix.has(l)){u=!1;break}}}catch(y){c.e(y)}finally{c.f()}u&&a.push(l)}}catch(y){s.e(y)}finally{s.f()}if(0==a.length)throw new Error("failed to find common modalities across all datasets");var h={matrix:new m.VU,features:{},row_ids:{}};try{for(var f=0,d=a;f<d.length;f++){var v=d[f],p=B(v,t);h.matrix.add(v,p.matrix),h.features[v]=p.features,h.row_ids[v]=p.row_ids}var _=t.map((function(e){return e.cells}));h.cells=w.sj(_);var g=new Array(t.length);t.forEach((function(e,t){g[t]=e.matrix.numberOfColumns()})),i=m.j4(g),h.block_ids=i,h.block_levels=e;var b=new Array(i.length);i.forEach((function(t,n){b[n]=e[t]})),h.cells.$setColumn("__batch__",b)}catch(k){throw Z.Yl(i),Z.Yl(h.matrix),k}return h}function F(e){if(0==e.matrix.available().length)throw new Error("");var t={matrix:new m.VU,features:{},row_ids:{}};try{var n,i=(0,r.Z)(I);try{for(i.s();!(n=i.n()).done;){var a=n.value;e.matrix.has(a)&&(t.matrix.add(a,e.matrix.get(a)),t.features[a]=e.features[a],t.row_ids[a]=e.row_ids[a])}}catch(s){i.e(s)}finally{i.f()}}catch(o){throw m.gd(t.matrix),o}return t.cells=e.cells,t.block_ids=null,t.block_levels=null,t}function z(e,t){return N.apply(this,arguments)}function N(){return(N=(0,s.Z)((0,i.Z)().mark((function e(t,n){var a,s,o,l,u,c,h,f,d,v,p,w;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(a=Object.keys(t)).sort(),s=[],e.prev=3,o=0,l=a;case 5:if(!(o<l.length)){e.next=15;break}return u=l[o],e.t0=s,e.next=10,t[u].load({cache:n});case 10:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 12:o++,e.next=5;break;case 15:e.next=22;break;case 17:e.prev=17,e.t2=e.catch(3),c=(0,r.Z)(s);try{for(c.s();!(h=c.n()).done;)f=h.value,m.gd(f.matrix)}catch(i){c.e(i)}finally{c.f()}throw e.t2;case 22:if(1!=a.length){e.next=33;break}e.prev=23,d=F(s[0]),e.next=31;break;case 27:throw e.prev=27,e.t3=e.catch(23),m.gd(s[0].matrix),e.t3;case 31:e.next=34;break;case 33:try{d=R(a,s)}finally{v=(0,r.Z)(s);try{for(v.s();!(p=v.n()).done;)w=p.value,m.gd(w.matrix)}catch(i){v.e(i)}finally{v.f()}}case 34:return e.abrupt("return",d);case 35:case"end":return e.stop()}}),e,null,[[3,17],[23,27]])})))).apply(this,arguments)}var D=-1;function M(e,t){var n;if(g in t)n=t[g];else if(null==e)n=null;else{if(!t.raw_annotations.hasColumn(e.field))throw new Error("failed to find '"+e.field+"' in the column annotations");var i=t.raw_annotations.column(e.field);if(n=[],"values"in e){var a=new Set(e.values);i.forEach((function(e,t){a.has(e)&&n.push(t)}))}else i.forEach((function(t,i){var a,s=(0,r.Z)(e.ranges);try{for(s.s();!(a=s.n()).done;){var o=a.value;if(t>=o[0]&&t<=o[1])return void n.push(i)}}catch(l){s.e(l)}finally{s.f()}}))}if("raw_block_ids"in t&&null!==t.raw_block_ids){var s=t.raw_block_ids.array(),o=[];if(null!==n){var l,u=(0,r.Z)(n);try{for(u.s();!(l=u.n()).done;){var c=l.value;s[c]!==D&&o.push(c)}}catch(f){u.e(f)}finally{u.f()}}else for(var h=0;h<s.length;h++)s[h]!==D&&o.push(h);n=o}return n}function O(e,t,n){return W.apply(this,arguments)}function W(){return(W=(0,s.Z)((0,i.Z)().mark((function e(t,n,r){var a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Z.Yl(n.raw_matrix),Z.Yl(n.matrix),Z.Yl(n.multi_block_ids),e.next=5,z(t,r);case 5:a=e.sent,n.raw_matrix=a.matrix,n.row_ids=a.row_ids,n.raw_annotations=a.cells,n.multi_block_ids=a.block_ids,n.multi_block_levels=a.block_levels,n.genes=a.features;case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e,t){Z.Yl(t.raw_block_ids);var n=null,r=null;if(null!==e)try{var i=t.raw_annotations.column(e);if(i.length!=t.raw_matrix.numberOfColumns())throw new Error("length of blocking factor '"+e+"' should be equal to the number of cells");var a=m.Yh(i,{action:"none",placeholder:D});n=a.ids,r=a.levels}catch(s){throw Z.Yl(n),s}else n=null!==t.multi_block_ids?t.multi_block_ids.view():null,r=t.multi_block_levels;t.raw_block_ids=n,t.raw_block_levels=r}function j(e,t){Z.Yl(t.matrix),Z.Yl(t.block_ids);var n,i,a,s,o=M(e,t);try{if(null===o)n=t.raw_annotations,i=t.raw_matrix.clone(),null!==t.raw_block_ids?(a=t.raw_block_ids.view(),s=t.raw_block_levels):(a=null,s=null);else{if(n=w.Nd(t.raw_annotations,o),null!==t.raw_block_ids)a=m.DS(t.raw_block_ids,o),s=m.D4(a).map((function(e){return t.raw_block_levels[e]}));else a=null,s=null;i=new m.VU;var l,u=(0,r.Z)(t.raw_matrix.available());try{for(u.s();!(l=u.n()).done;){var c=l.value,h=t.raw_matrix.get(c);i.add(c,m.ZW(h,o))}}catch(f){u.e(f)}finally{u.f()}}}catch(d){throw Z.Yl(i),Z.Yl(a),d}t.annotations=n,t.block_levels=s,t.block_ids=a,t.matrix=i}var q=null;function U(e){var t=q;return q=e,t}},4071:function(e,t,n){n.d(t,{$p:function(){return l},AB:function(){return c},Ig:function(){return m},Vi:function(){return _},cE:function(){return p},qM:function(){return w},yc:function(){return u}});var r=n(4165),i=n(5861),a=n(5831),s=(n(7891),n(8794)),o=function(e,t,n){return null};function l(e){var t=o;return o=e,t}var u={numberOfThreads:1};function c(e,t){var n=e.fetchIndex(),r={num_obs:n.numberOfCells()},i=null,s=null,o=null,l=null;try{i=a.wf(n,t),s=a.Wf(i.numberOfCells()),o=a.Wf(i.size()),l=a.RJ(i.size()),i.serialize({runs:s,indices:o,distances:l}),r.size=i.size(),r.runs=s.array().slice(),r.indices=o.array().slice(),r.distances=l.array().slice()}finally{null!==i&&i.free(),null!==s&&s.free(),null!==o&&o.free(),null!==l&&l.free()}return r}var h=[],f=[];function d(e){return e.type}function v(e,t){"error"==d(t)?e.reject(t.error):e.resolve(t.data)}function p(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=h[e],i=f[e],a=i.counter,o=new Promise((function(e,t){var n={resolve:e,reject:t};a in i.promises?(v(n,i.promises[a]),delete i.promises[a]):i.promises[a]=n}));return i.counter++,t.id=a,s.bG(r,t,n),o}function m(e,t){var n=h.length;h.push(e);var r={counter:0,promises:{}};return f.push(r),s.jC(e,(function(e){var t=d(e.data);if(t.endsWith("_iter"))o(t.slice(0,-5),e.data.x,e.data.y,e.data.iteration);else{var n=e.data.id;n in r.promises?(v(r.promises[n],e.data),delete r.promises[n]):r.promises[n]=e.data}})),{worker_id:n,ready:p(n,{cmd:"INIT",scranOptions:t})}}function w(e){return Z.apply(this,arguments)}function Z(){return(Z=(0,i.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(t,{cmd:"KILL"});case 2:return n=h[t],h[t]=null,e.abrupt("return",s.Ae(n));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t,n){var r={cmd:"RUN",params:t},i=[];return null!==n&&(i=[n.runs.buffer,n.indices.buffer,n.distances.buffer],r.neighbors=n),p(e,r,i)}},8795:function(e,t,n){n.d(t,{i:function(){return r}});var r="2.0.8"},714:function(e,t,n){n.d(t,{T_:function(){return gn},ec:function(){return yn},iv:function(){return _n},rr:function(){return bn}});function r(e){for(var t=e.length;--t>=0;)e[t]=0}var i=256,a=286,s=30,o=15,l=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),u=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),c=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),h=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),f=new Array(576);r(f);var d=new Array(60);r(d);var v=new Array(512);r(v);var p=new Array(256);r(p);var m=new Array(29);r(m);var w,Z,_,g=new Array(s);function b(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function y(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}r(g);var k=function(e){return e<256?v[e]:v[256+(e>>>7)]},A=function(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},x=function(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,A(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},E=function(e,t,n){x(e,n[2*t],n[2*t+1])},S=function(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},C=function(e,t,n){var r,i,a=new Array(16),s=0;for(r=1;r<=o;r++)s=s+n[r-1]<<1,a[r]=s;for(i=0;i<=t;i++){var l=e[2*i+1];0!==l&&(e[2*i]=S(a[l]++,l))}},I=function(e){var t;for(t=0;t<a;t++)e.dyn_ltree[2*t]=0;for(t=0;t<s;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},B=function(e){e.bi_valid>8?A(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},R=function(e,t,n,r){var i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]},F=function(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&R(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!R(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},z=function(e,t,n){var r,a,s,o,c=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+c++],r+=(255&e.pending_buf[e.sym_buf+c++])<<8,a=e.pending_buf[e.sym_buf+c++],0===r?E(e,a,t):(s=p[a],E(e,s+i+1,t),0!==(o=l[s])&&(a-=m[s],x(e,a,o)),r--,s=k(r),E(e,s,n),0!==(o=u[s])&&(r-=g[s],x(e,r,o)))}while(c<e.sym_next);E(e,256,t)},N=function(e,t){var n,r,i,a=t.dyn_tree,s=t.stat_desc.static_tree,l=t.stat_desc.has_stree,u=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<u;n++)0!==a[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[i]=0,e.opt_len--,l&&(e.static_len-=s[2*i+1]);for(t.max_code=c,n=e.heap_len>>1;n>=1;n--)F(e,a,n);i=u;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],F(e,a,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,a[2*i]=a[2*n]+a[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,a[2*n+1]=a[2*r+1]=i,e.heap[1]=i++,F(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,a,s,l,u=t.dyn_tree,c=t.max_code,h=t.stat_desc.static_tree,f=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,v=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(a=0;a<=o;a++)e.bl_count[a]=0;for(u[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(a=u[2*u[2*(r=e.heap[n])+1]+1]+1)>p&&(a=p,m++),u[2*r+1]=a,r>c||(e.bl_count[a]++,s=0,r>=v&&(s=d[r-v]),l=u[2*r],e.opt_len+=l*(a+s),f&&(e.static_len+=l*(h[2*r+1]+s)));if(0!==m){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(a=p;0!==a;a--)for(r=e.bl_count[a];0!==r;)(i=e.heap[--n])>c||(u[2*i+1]!==a&&(e.opt_len+=(a-u[2*i+1])*u[2*i],u[2*i+1]=a),r--)}}(e,t),C(a,c,e.bl_count)},D=function(e,t,n){var r,i,a=-1,s=t[1],o=0,l=7,u=4;for(0===s&&(l=138,u=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=s,s=t[2*(r+1)+1],++o<l&&i===s||(o<u?e.bl_tree[2*i]+=o:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,a=i,0===s?(l=138,u=3):i===s?(l=6,u=3):(l=7,u=4))},M=function(e,t,n){var r,i,a=-1,s=t[1],o=0,l=7,u=4;for(0===s&&(l=138,u=3),r=0;r<=n;r++)if(i=s,s=t[2*(r+1)+1],!(++o<l&&i===s)){if(o<u)do{E(e,i,e.bl_tree)}while(0!==--o);else 0!==i?(i!==a&&(E(e,i,e.bl_tree),o--),E(e,16,e.bl_tree),x(e,o-3,2)):o<=10?(E(e,17,e.bl_tree),x(e,o-3,3)):(E(e,18,e.bl_tree),x(e,o-11,7));o=0,a=i,0===s?(l=138,u=3):i===s?(l=6,u=3):(l=7,u=4)}},O=!1,W=function(e,t,n,r){x(e,0+(r?1:0),3),B(e),A(e,n),A(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n},Q=function(e,t,n,r){var a,s,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<i;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),N(e,e.l_desc),N(e,e.d_desc),o=function(e){var t;for(D(e,e.dyn_ltree,e.l_desc.max_code),D(e,e.dyn_dtree,e.d_desc.max_code),N(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*h[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),a=e.opt_len+3+7>>>3,(s=e.static_len+3+7>>>3)<=a&&(a=s)):a=s=n+5,n+4<=a&&-1!==t?W(e,t,n,r):4===e.strategy||s===a?(x(e,2+(r?1:0),3),z(e,f,d)):(x(e,4+(r?1:0),3),function(e,t,n,r){var i;for(x(e,t-257,5),x(e,n-1,5),x(e,r-4,4),i=0;i<r;i++)x(e,e.bl_tree[2*h[i]+1],3);M(e,e.dyn_ltree,t-1),M(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),z(e,e.dyn_ltree,e.dyn_dtree)),I(e),r&&B(e)},j={_tr_init:function(e){O||(!function(){var e,t,n,r,i,h=new Array(16);for(n=0,r=0;r<28;r++)for(m[r]=n,e=0;e<1<<l[r];e++)p[n++]=r;for(p[n-1]=r,i=0,r=0;r<16;r++)for(g[r]=i,e=0;e<1<<u[r];e++)v[i++]=r;for(i>>=7;r<s;r++)for(g[r]=i<<7,e=0;e<1<<u[r]-7;e++)v[256+i++]=r;for(t=0;t<=o;t++)h[t]=0;for(e=0;e<=143;)f[2*e+1]=8,e++,h[8]++;for(;e<=255;)f[2*e+1]=9,e++,h[9]++;for(;e<=279;)f[2*e+1]=7,e++,h[7]++;for(;e<=287;)f[2*e+1]=8,e++,h[8]++;for(C(f,287,h),e=0;e<s;e++)d[2*e+1]=5,d[2*e]=S(e,5);w=new b(f,l,257,a,o),Z=new b(d,u,0,s,o),_=new b(new Array(0),c,0,19,7)}(),O=!0),e.l_desc=new y(e.dyn_ltree,w),e.d_desc=new y(e.dyn_dtree,Z),e.bl_desc=new y(e.bl_tree,_),e.bi_buf=0,e.bi_valid=0,I(e)},_tr_stored_block:W,_tr_flush_block:Q,_tr_tally:function(e,t,n){return e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(p[n]+i+1)]++,e.dyn_dtree[2*k(t)]++),e.sym_next===e.sym_end},_tr_align:function(e){x(e,2,3),E(e,256,f),function(e){16===e.bi_valid?(A(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},q=function(e,t,n,r){for(var i=65535&e|0,a=e>>>16&65535|0,s=0;0!==n;){n-=s=n>2e3?2e3:n;do{a=a+(i=i+t[r++]|0)|0}while(--s);i%=65521,a%=65521}return i|a<<16|0},U=new Uint32Array(function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}()),T=function(e,t,n,r){var i=U,a=r+n;e^=-1;for(var s=r;s<a;s++)e=e>>>8^i[255&(e^t[s])];return-1^e},P={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},G={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},L=j._tr_init,H=j._tr_stored_block,V=j._tr_flush_block,Y=j._tr_tally,J=j._tr_align,X=G.Z_NO_FLUSH,$=G.Z_PARTIAL_FLUSH,K=G.Z_FULL_FLUSH,ee=G.Z_FINISH,te=G.Z_BLOCK,ne=G.Z_OK,re=G.Z_STREAM_END,ie=G.Z_STREAM_ERROR,ae=G.Z_DATA_ERROR,se=G.Z_BUF_ERROR,oe=G.Z_DEFAULT_COMPRESSION,le=G.Z_FILTERED,ue=G.Z_HUFFMAN_ONLY,ce=G.Z_RLE,he=G.Z_FIXED,fe=G.Z_DEFAULT_STRATEGY,de=G.Z_UNKNOWN,ve=G.Z_DEFLATED,pe=286,me=30,we=19,Ze=2*pe+1,_e=15,ge=258,be=262,ye=42,ke=113,Ae=666,xe=function(e,t){return e.msg=P[t],t},Ee=function(e){return 2*e-(e>4?9:0)},Se=function(e){for(var t=e.length;--t>=0;)e[t]=0},Ce=function(e){var t,n,r,i=e.w_size;r=t=e.hash_size;do{n=e.head[--r],e.head[r]=n>=i?n-i:0}while(--t);r=t=i;do{n=e.prev[--r],e.prev[r]=n>=i?n-i:0}while(--t)},Ie=function(e,t,n){return(t<<e.hash_shift^n)&e.hash_mask},Be=function(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},Re=function(e,t){V(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Be(e.strm)},Fe=function(e,t){e.pending_buf[e.pending++]=t},ze=function(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Ne=function(e,t,n,r){var i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=q(e.adler,t,i,n):2===e.state.wrap&&(e.adler=T(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},De=function(e,t){var n,r,i=e.max_chain_length,a=e.strstart,s=e.prev_length,o=e.nice_match,l=e.strstart>e.w_size-be?e.strstart-(e.w_size-be):0,u=e.window,c=e.w_mask,h=e.prev,f=e.strstart+ge,d=u[a+s-1],v=u[a+s];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(u[(n=t)+s]===v&&u[n+s-1]===d&&u[n]===u[a]&&u[++n]===u[a+1]){a+=2,n++;do{}while(u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&a<f);if(r=ge-(f-a),a=f-ge,r>s){if(e.match_start=t,s=r,r>=o)break;d=u[a+s-1],v=u[a+s]}}}while((t=h[t&c])>l&&0!==--i);return s<=e.lookahead?s:e.lookahead},Me=function(e){var t,n,r,i=e.w_size;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=i+(i-be)&&(e.window.set(e.window.subarray(i,i+i-n),0),e.match_start-=i,e.strstart-=i,e.block_start-=i,e.insert>e.strstart&&(e.insert=e.strstart),Ce(e),n+=i),0===e.strm.avail_in)break;if(t=Ne(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=t,e.lookahead+e.insert>=3)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=Ie(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=Ie(e,e.ins_h,e.window[r+3-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<be&&0!==e.strm.avail_in)},Oe=function(e,t){var n,r,i,a=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s=0,o=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,n>(r=e.strstart-e.block_start)+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<a&&(0===n&&t!==ee||t===X||n!==r+e.strm.avail_in))break;s=t===ee&&n===r+e.strm.avail_in?1:0,H(e,0,0,s),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,Be(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(Ne(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===s);return(o-=e.strm.avail_in)&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?4:t!==X&&t!==ee&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(Ne(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,a=(i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i)>e.w_size?e.w_size:i,((r=e.strstart-e.block_start)>=a||(r||t===ee)&&t!==X&&0===e.strm.avail_in&&r<=i)&&(n=r>i?i:r,s=t===ee&&0===e.strm.avail_in&&n===r?1:0,H(e,e.block_start,n,s),e.block_start+=n,Be(e.strm)),s?3:1)},We=function(e,t){for(var n,r;;){if(e.lookahead<be){if(Me(e),e.lookahead<be&&t===X)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=Ie(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-be&&(e.match_length=De(e,n)),e.match_length>=3)if(r=Y(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Ie(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Ie(e,e.ins_h,e.window[e.strstart+1]);else r=Y(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(Re(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===ee?(Re(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Re(e,!1),0===e.strm.avail_out)?1:2},Qe=function(e,t){for(var n,r,i;;){if(e.lookahead<be){if(Me(e),e.lookahead<be&&t===X)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=Ie(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-be&&(e.match_length=De(e,n),e.match_length<=5&&(e.strategy===le||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=Y(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=Ie(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(Re(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=Y(e,0,e.window[e.strstart-1]))&&Re(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=Y(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===ee?(Re(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Re(e,!1),0===e.strm.avail_out)?1:2};function je(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}var qe=[new je(0,0,0,0,Oe),new je(4,4,8,4,We),new je(4,5,16,8,We),new je(4,6,32,32,We),new je(4,4,16,16,Qe),new je(8,16,32,32,Qe),new je(8,16,128,128,Qe),new je(8,32,128,256,Qe),new je(32,128,258,1024,Qe),new je(32,258,258,4096,Qe)];function Ue(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ve,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Ze),this.dyn_dtree=new Uint16Array(2*(2*me+1)),this.bl_tree=new Uint16Array(2*(2*we+1)),Se(this.dyn_ltree),Se(this.dyn_dtree),Se(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(_e+1),this.heap=new Uint16Array(2*pe+1),Se(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*pe+1),Se(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Te=function(e){if(!e)return 1;var t=e.state;return!t||t.strm!==e||t.status!==ye&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==ke&&t.status!==Ae?1:0},Pe=function(e){if(Te(e))return xe(e,ie);e.total_in=e.total_out=0,e.data_type=de;var t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?ye:ke,e.adler=2===t.wrap?0:1,t.last_flush=-2,L(t),ne},Ge=function(e){var t,n=Pe(e);return n===ne&&((t=e.state).window_size=2*t.w_size,Se(t.head),t.max_lazy_match=qe[t.level].max_lazy,t.good_match=qe[t.level].good_length,t.nice_match=qe[t.level].nice_length,t.max_chain_length=qe[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n},Le=function(e,t,n,r,i,a){if(!e)return ie;var s=1;if(t===oe&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),i<1||i>9||n!==ve||r<8||r>15||t<0||t>9||a<0||a>he||8===r&&1!==s)return xe(e,ie);8===r&&(r=9);var o=new Ue;return e.state=o,o.strm=e,o.status=ye,o.wrap=s,o.gzhead=null,o.w_bits=r,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=a,o.method=n,Ge(e)},He={deflateInit:function(e,t){return Le(e,t,ve,15,8,fe)},deflateInit2:Le,deflateReset:Ge,deflateResetKeep:Pe,deflateSetHeader:function(e,t){return Te(e)||2!==e.state.wrap?ie:(e.state.gzhead=t,ne)},deflate:function(e,t){if(Te(e)||t>te||t<0)return e?xe(e,ie):ie;var n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===Ae&&t!==ee)return xe(e,0===e.avail_out?se:ie);var r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(Be(e),0===e.avail_out)return n.last_flush=-1,ne}else if(0===e.avail_in&&Ee(t)<=Ee(r)&&t!==ee)return xe(e,se);if(n.status===Ae&&0!==e.avail_in)return xe(e,se);if(n.status===ye&&0===n.wrap&&(n.status=ke),n.status===ye){var i=ve+(n.w_bits-8<<4)<<8;if(i|=(n.strategy>=ue||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(i|=32),ze(n,i+=31-i%31),0!==n.strstart&&(ze(n,e.adler>>>16),ze(n,65535&e.adler)),e.adler=1,n.status=ke,Be(e),0!==n.pending)return n.last_flush=-1,ne}if(57===n.status)if(e.adler=0,Fe(n,31),Fe(n,139),Fe(n,8),n.gzhead)Fe(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Fe(n,255&n.gzhead.time),Fe(n,n.gzhead.time>>8&255),Fe(n,n.gzhead.time>>16&255),Fe(n,n.gzhead.time>>24&255),Fe(n,9===n.level?2:n.strategy>=ue||n.level<2?4:0),Fe(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Fe(n,255&n.gzhead.extra.length),Fe(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=T(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Fe(n,0),Fe(n,0),Fe(n,0),Fe(n,0),Fe(n,0),Fe(n,9===n.level?2:n.strategy>=ue||n.level<2?4:0),Fe(n,3),n.status=ke,Be(e),0!==n.pending)return n.last_flush=-1,ne;if(69===n.status){if(n.gzhead.extra){for(var a=n.pending,s=(65535&n.gzhead.extra.length)-n.gzindex;n.pending+s>n.pending_buf_size;){var o=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+o),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>a&&(e.adler=T(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex+=o,Be(e),0!==n.pending)return n.last_flush=-1,ne;a=0,s-=o}var l=new Uint8Array(n.gzhead.extra);n.pending_buf.set(l.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>a&&(e.adler=T(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){var u,c=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>c&&(e.adler=T(e.adler,n.pending_buf,n.pending-c,c)),Be(e),0!==n.pending)return n.last_flush=-1,ne;c=0}u=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Fe(n,u)}while(0!==u);n.gzhead.hcrc&&n.pending>c&&(e.adler=T(e.adler,n.pending_buf,n.pending-c,c)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){var h,f=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>f&&(e.adler=T(e.adler,n.pending_buf,n.pending-f,f)),Be(e),0!==n.pending)return n.last_flush=-1,ne;f=0}h=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Fe(n,h)}while(0!==h);n.gzhead.hcrc&&n.pending>f&&(e.adler=T(e.adler,n.pending_buf,n.pending-f,f))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Be(e),0!==n.pending))return n.last_flush=-1,ne;Fe(n,255&e.adler),Fe(n,e.adler>>8&255),e.adler=0}if(n.status=ke,Be(e),0!==n.pending)return n.last_flush=-1,ne}if(0!==e.avail_in||0!==n.lookahead||t!==X&&n.status!==Ae){var d=0===n.level?Oe(n,t):n.strategy===ue?function(e,t){for(var n;;){if(0===e.lookahead&&(Me(e),0===e.lookahead)){if(t===X)return 1;break}if(e.match_length=0,n=Y(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(Re(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===ee?(Re(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Re(e,!1),0===e.strm.avail_out)?1:2}(n,t):n.strategy===ce?function(e,t){for(var n,r,i,a,s=e.window;;){if(e.lookahead<=ge){if(Me(e),e.lookahead<=ge&&t===X)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=s[i=e.strstart-1])===s[++i]&&r===s[++i]&&r===s[++i]){a=e.strstart+ge;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<a);e.match_length=ge-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=Y(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=Y(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(Re(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===ee?(Re(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Re(e,!1),0===e.strm.avail_out)?1:2}(n,t):qe[n.level].func(n,t);if(3!==d&&4!==d||(n.status=Ae),1===d||3===d)return 0===e.avail_out&&(n.last_flush=-1),ne;if(2===d&&(t===$?J(n):t!==te&&(H(n,0,0,!1),t===K&&(Se(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),Be(e),0===e.avail_out))return n.last_flush=-1,ne}return t!==ee?ne:n.wrap<=0?re:(2===n.wrap?(Fe(n,255&e.adler),Fe(n,e.adler>>8&255),Fe(n,e.adler>>16&255),Fe(n,e.adler>>24&255),Fe(n,255&e.total_in),Fe(n,e.total_in>>8&255),Fe(n,e.total_in>>16&255),Fe(n,e.total_in>>24&255)):(ze(n,e.adler>>>16),ze(n,65535&e.adler)),Be(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?ne:re)},deflateEnd:function(e){if(Te(e))return ie;var t=e.state.status;return e.state=null,t===ke?xe(e,ae):ne},deflateSetDictionary:function(e,t){var n=t.length;if(Te(e))return ie;var r=e.state,i=r.wrap;if(2===i||1===i&&r.status!==ye||r.lookahead)return ie;if(1===i&&(e.adler=q(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(Se(r.head),r.strstart=0,r.block_start=0,r.insert=0);var a=new Uint8Array(r.w_size);a.set(t.subarray(n-r.w_size,n),0),t=a,n=r.w_size}var s=e.avail_in,o=e.next_in,l=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Me(r);r.lookahead>=3;){var u=r.strstart,c=r.lookahead-2;do{r.ins_h=Ie(r,r.ins_h,r.window[u+3-1]),r.prev[u&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=u,u++}while(--c);r.strstart=u,r.lookahead=2,Me(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=o,e.input=l,e.avail_in=s,r.wrap=i,ne},deflateInfo:"pako deflate (from Nodeca project)"},Ve=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},Ye={assign:function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!==typeof n)throw new TypeError(n+"must be non-object");for(var r in n)Ve(n,r)&&(e[r]=n[r])}}return e},flattenChunks:function(e){for(var t=0,n=0,r=e.length;n<r;n++)t+=e[n].length;for(var i=new Uint8Array(t),a=0,s=0,o=e.length;a<o;a++){var l=e[a];i.set(l,s),s+=l.length}return i}},Je=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(kn){Je=!1}for(var Xe=new Uint8Array(256),$e=0;$e<256;$e++)Xe[$e]=$e>=252?6:$e>=248?5:$e>=240?4:$e>=224?3:$e>=192?2:1;Xe[254]=Xe[254]=1;var Ke={string2buf:function(e){if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);var t,n,r,i,a,s=e.length,o=0;for(i=0;i<s;i++)55296===(64512&(n=e.charCodeAt(i)))&&i+1<s&&56320===(64512&(r=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(o),a=0,i=0;a<o;i++)55296===(64512&(n=e.charCodeAt(i)))&&i+1<s&&56320===(64512&(r=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},buf2string:function(e,t){var n,r,i=t||e.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));var a=new Array(2*i);for(r=0,n=0;n<i;){var s=e[n++];if(s<128)a[r++]=s;else{var o=Xe[s];if(o>4)a[r++]=65533,n+=o-1;else{for(s&=2===o?31:3===o?15:7;o>1&&n<i;)s=s<<6|63&e[n++],o--;o>1?a[r++]=65533:s<65536?a[r++]=s:(s-=65536,a[r++]=55296|s>>10&1023,a[r++]=56320|1023&s)}}}return function(e,t){if(t<65534&&e.subarray&&Je)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));for(var n="",r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n}(a,r)},utf8border:function(e,t){(t=t||e.length)>e.length&&(t=e.length);for(var n=t-1;n>=0&&128===(192&e[n]);)n--;return n<0||0===n?t:n+Xe[e[n]]>t?n:t}};var et=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},tt=Object.prototype.toString,nt=G.Z_NO_FLUSH,rt=G.Z_SYNC_FLUSH,it=G.Z_FULL_FLUSH,at=G.Z_FINISH,st=G.Z_OK,ot=G.Z_STREAM_END,lt=G.Z_DEFAULT_COMPRESSION,ut=G.Z_DEFAULT_STRATEGY,ct=G.Z_DEFLATED;function ht(e){this.options=Ye.assign({level:lt,method:ct,chunkSize:16384,windowBits:15,memLevel:8,strategy:ut},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new et,this.strm.avail_out=0;var n=He.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==st)throw new Error(P[n]);if(t.header&&He.deflateSetHeader(this.strm,t.header),t.dictionary){var r;if(r="string"===typeof t.dictionary?Ke.string2buf(t.dictionary):"[object ArrayBuffer]"===tt.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=He.deflateSetDictionary(this.strm,r))!==st)throw new Error(P[n]);this._dict_set=!0}}function ft(e,t){var n=new ht(t);if(n.push(e,!0),n.err)throw n.msg||P[n.err];return n.result}ht.prototype.push=function(e,t){var n,r,i=this.strm,a=this.options.chunkSize;if(this.ended)return!1;for(r=t===~~t?t:!0===t?at:nt,"string"===typeof e?i.input=Ke.string2buf(e):"[object ArrayBuffer]"===tt.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(a),i.next_out=0,i.avail_out=a),(r===rt||r===it)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if((n=He.deflate(i,r))===ot)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),n=He.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===st;if(0!==i.avail_out){if(r>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},ht.prototype.onData=function(e){this.chunks.push(e)},ht.prototype.onEnd=function(e){e===st&&(this.result=Ye.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var dt={Deflate:ht,deflate:ft,deflateRaw:function(e,t){return(t=t||{}).raw=!0,ft(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,ft(e,t)},constants:G},vt=16209,pt=function(e,t){var n,r,i,a,s,o,l,u,c,h,f,d,v,p,m,w,Z,_,g,b,y,k,A,x,E=e.state;n=e.next_in,A=e.input,r=n+(e.avail_in-5),i=e.next_out,x=e.output,a=i-(t-e.avail_out),s=i+(e.avail_out-257),o=E.dmax,l=E.wsize,u=E.whave,c=E.wnext,h=E.window,f=E.hold,d=E.bits,v=E.lencode,p=E.distcode,m=(1<<E.lenbits)-1,w=(1<<E.distbits)-1;e:do{d<15&&(f+=A[n++]<<d,d+=8,f+=A[n++]<<d,d+=8),Z=v[f&m];t:for(;;){if(f>>>=_=Z>>>24,d-=_,0===(_=Z>>>16&255))x[i++]=65535&Z;else{if(!(16&_)){if(0===(64&_)){Z=v[(65535&Z)+(f&(1<<_)-1)];continue t}if(32&_){E.mode=16191;break e}e.msg="invalid literal/length code",E.mode=vt;break e}g=65535&Z,(_&=15)&&(d<_&&(f+=A[n++]<<d,d+=8),g+=f&(1<<_)-1,f>>>=_,d-=_),d<15&&(f+=A[n++]<<d,d+=8,f+=A[n++]<<d,d+=8),Z=p[f&w];n:for(;;){if(f>>>=_=Z>>>24,d-=_,!(16&(_=Z>>>16&255))){if(0===(64&_)){Z=p[(65535&Z)+(f&(1<<_)-1)];continue n}e.msg="invalid distance code",E.mode=vt;break e}if(b=65535&Z,d<(_&=15)&&(f+=A[n++]<<d,(d+=8)<_&&(f+=A[n++]<<d,d+=8)),(b+=f&(1<<_)-1)>o){e.msg="invalid distance too far back",E.mode=vt;break e}if(f>>>=_,d-=_,b>(_=i-a)){if((_=b-_)>u&&E.sane){e.msg="invalid distance too far back",E.mode=vt;break e}if(y=0,k=h,0===c){if(y+=l-_,_<g){g-=_;do{x[i++]=h[y++]}while(--_);y=i-b,k=x}}else if(c<_){if(y+=l+c-_,(_-=c)<g){g-=_;do{x[i++]=h[y++]}while(--_);if(y=0,c<g){g-=_=c;do{x[i++]=h[y++]}while(--_);y=i-b,k=x}}}else if(y+=c-_,_<g){g-=_;do{x[i++]=h[y++]}while(--_);y=i-b,k=x}for(;g>2;)x[i++]=k[y++],x[i++]=k[y++],x[i++]=k[y++],g-=3;g&&(x[i++]=k[y++],g>1&&(x[i++]=k[y++]))}else{y=i-b;do{x[i++]=x[y++],x[i++]=x[y++],x[i++]=x[y++],g-=3}while(g>2);g&&(x[i++]=x[y++],g>1&&(x[i++]=x[y++]))}break}}break}}while(n<r&&i<s);n-=g=d>>3,f&=(1<<(d-=g<<3))-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<s?s-i+257:257-(i-s),E.hold=f,E.bits=d},mt=15,wt=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Zt=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),_t=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),gt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),bt=function(e,t,n,r,i,a,s,o){var l,u,c,h,f,d,v,p,m,w=o.bits,Z=0,_=0,g=0,b=0,y=0,k=0,A=0,x=0,E=0,S=0,C=null,I=new Uint16Array(16),B=new Uint16Array(16),R=null;for(Z=0;Z<=mt;Z++)I[Z]=0;for(_=0;_<r;_++)I[t[n+_]]++;for(y=w,b=mt;b>=1&&0===I[b];b--);if(y>b&&(y=b),0===b)return i[a++]=20971520,i[a++]=20971520,o.bits=1,0;for(g=1;g<b&&0===I[g];g++);for(y<g&&(y=g),x=1,Z=1;Z<=mt;Z++)if(x<<=1,(x-=I[Z])<0)return-1;if(x>0&&(0===e||1!==b))return-1;for(B[1]=0,Z=1;Z<mt;Z++)B[Z+1]=B[Z]+I[Z];for(_=0;_<r;_++)0!==t[n+_]&&(s[B[t[n+_]]++]=_);if(0===e?(C=R=s,d=20):1===e?(C=wt,R=Zt,d=257):(C=_t,R=gt,d=0),S=0,_=0,Z=g,f=a,k=y,A=0,c=-1,h=(E=1<<y)-1,1===e&&E>852||2===e&&E>592)return 1;for(;;){v=Z-A,s[_]+1<d?(p=0,m=s[_]):s[_]>=d?(p=R[s[_]-d],m=C[s[_]-d]):(p=96,m=0),l=1<<Z-A,g=u=1<<k;do{i[f+(S>>A)+(u-=l)]=v<<24|p<<16|m|0}while(0!==u);for(l=1<<Z-1;S&l;)l>>=1;if(0!==l?(S&=l-1,S+=l):S=0,_++,0===--I[Z]){if(Z===b)break;Z=t[n+s[_]]}if(Z>y&&(S&h)!==c){for(0===A&&(A=y),f+=g,x=1<<(k=Z-A);k+A<b&&!((x-=I[k+A])<=0);)k++,x<<=1;if(E+=1<<k,1===e&&E>852||2===e&&E>592)return 1;i[c=S&h]=y<<24|k<<16|f-a|0}}return 0!==S&&(i[f+S]=Z-A<<24|64<<16|0),o.bits=y,0},yt=G.Z_FINISH,kt=G.Z_BLOCK,At=G.Z_TREES,xt=G.Z_OK,Et=G.Z_STREAM_END,St=G.Z_NEED_DICT,Ct=G.Z_STREAM_ERROR,It=G.Z_DATA_ERROR,Bt=G.Z_MEM_ERROR,Rt=G.Z_BUF_ERROR,Ft=G.Z_DEFLATED,zt=16180,Nt=16190,Dt=16191,Mt=16192,Ot=16194,Wt=16199,Qt=16200,jt=16206,qt=16209,Ut=function(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)};function Tt(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var Pt,Gt,Lt=function(e){if(!e)return 1;var t=e.state;return!t||t.strm!==e||t.mode<zt||t.mode>16211?1:0},Ht=function(e){if(Lt(e))return Ct;var t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=zt,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,xt},Vt=function(e){if(Lt(e))return Ct;var t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Ht(e)},Yt=function(e,t){var n;if(Lt(e))return Ct;var r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Ct:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,Vt(e))},Jt=function(e,t){if(!e)return Ct;var n=new Tt;e.state=n,n.strm=e,n.window=null,n.mode=zt;var r=Yt(e,t);return r!==xt&&(e.state=null),r},Xt=!0,$t=function(e){if(Xt){Pt=new Int32Array(512),Gt=new Int32Array(32);for(var t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(bt(1,e.lens,0,288,Pt,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;bt(2,e.lens,0,32,Gt,0,e.work,{bits:5}),Xt=!1}e.lencode=Pt,e.lenbits=9,e.distcode=Gt,e.distbits=5},Kt=function(e,t,n,r){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(a.window.set(t.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>r&&(i=r),a.window.set(t.subarray(n-r,n-r+i),a.wnext),(r-=i)?(a.window.set(t.subarray(n-r,n),0),a.wnext=r,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0},en={inflateReset:Vt,inflateReset2:Yt,inflateResetKeep:Ht,inflateInit:function(e){return Jt(e,15)},inflateInit2:Jt,inflate:function(e,t){var n,r,i,a,s,o,l,u,c,h,f,d,v,p,m,w,Z,_,g,b,y,k,A,x,E=0,S=new Uint8Array(4),C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Lt(e)||!e.output||!e.input&&0!==e.avail_in)return Ct;(n=e.state).mode===Dt&&(n.mode=Mt),s=e.next_out,i=e.output,l=e.avail_out,a=e.next_in,r=e.input,o=e.avail_in,u=n.hold,c=n.bits,h=o,f=l,k=xt;e:for(;;)switch(n.mode){case zt:if(0===n.wrap){n.mode=Mt;break}for(;c<16;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}if(2&n.wrap&&35615===u){0===n.wbits&&(n.wbits=15),n.check=0,S[0]=255&u,S[1]=u>>>8&255,n.check=T(n.check,S,2,0),u=0,c=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",n.mode=qt;break}if((15&u)!==Ft){e.msg="unknown compression method",n.mode=qt;break}if(c-=4,y=8+(15&(u>>>=4)),0===n.wbits&&(n.wbits=y),y>15||y>n.wbits){e.msg="invalid window size",n.mode=qt;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&u?16189:Dt,u=0,c=0;break;case 16181:for(;c<16;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}if(n.flags=u,(255&n.flags)!==Ft){e.msg="unknown compression method",n.mode=qt;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=qt;break}n.head&&(n.head.text=u>>8&1),512&n.flags&&4&n.wrap&&(S[0]=255&u,S[1]=u>>>8&255,n.check=T(n.check,S,2,0)),u=0,c=0,n.mode=16182;case 16182:for(;c<32;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}n.head&&(n.head.time=u),512&n.flags&&4&n.wrap&&(S[0]=255&u,S[1]=u>>>8&255,S[2]=u>>>16&255,S[3]=u>>>24&255,n.check=T(n.check,S,4,0)),u=0,c=0,n.mode=16183;case 16183:for(;c<16;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&n.flags&&4&n.wrap&&(S[0]=255&u,S[1]=u>>>8&255,n.check=T(n.check,S,2,0)),u=0,c=0,n.mode=16184;case 16184:if(1024&n.flags){for(;c<16;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}n.length=u,n.head&&(n.head.extra_len=u),512&n.flags&&4&n.wrap&&(S[0]=255&u,S[1]=u>>>8&255,n.check=T(n.check,S,2,0)),u=0,c=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&((d=n.length)>o&&(d=o),d&&(n.head&&(y=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(a,a+d),y)),512&n.flags&&4&n.wrap&&(n.check=T(n.check,r,d,a)),o-=d,a+=d,n.length-=d),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===o)break e;d=0;do{y=r[a+d++],n.head&&y&&n.length<65536&&(n.head.name+=String.fromCharCode(y))}while(y&&d<o);if(512&n.flags&&4&n.wrap&&(n.check=T(n.check,r,d,a)),o-=d,a+=d,y)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===o)break e;d=0;do{y=r[a+d++],n.head&&y&&n.length<65536&&(n.head.comment+=String.fromCharCode(y))}while(y&&d<o);if(512&n.flags&&4&n.wrap&&(n.check=T(n.check,r,d,a)),o-=d,a+=d,y)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;c<16;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}if(4&n.wrap&&u!==(65535&n.check)){e.msg="header crc mismatch",n.mode=qt;break}u=0,c=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Dt;break;case 16189:for(;c<32;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}e.adler=n.check=Ut(u),u=0,c=0,n.mode=Nt;case Nt:if(0===n.havedict)return e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,n.hold=u,n.bits=c,St;e.adler=n.check=1,n.mode=Dt;case Dt:if(t===kt||t===At)break e;case Mt:if(n.last){u>>>=7&c,c-=7&c,n.mode=jt;break}for(;c<3;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}switch(n.last=1&u,c-=1,3&(u>>>=1)){case 0:n.mode=16193;break;case 1:if($t(n),n.mode=Wt,t===At){u>>>=2,c-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=qt}u>>>=2,c-=2;break;case 16193:for(u>>>=7&c,c-=7&c;c<32;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}if((65535&u)!==(u>>>16^65535)){e.msg="invalid stored block lengths",n.mode=qt;break}if(n.length=65535&u,u=0,c=0,n.mode=Ot,t===At)break e;case Ot:n.mode=16195;case 16195:if(d=n.length){if(d>o&&(d=o),d>l&&(d=l),0===d)break e;i.set(r.subarray(a,a+d),s),o-=d,a+=d,l-=d,s+=d,n.length-=d;break}n.mode=Dt;break;case 16196:for(;c<14;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}if(n.nlen=257+(31&u),u>>>=5,c-=5,n.ndist=1+(31&u),u>>>=5,c-=5,n.ncode=4+(15&u),u>>>=4,c-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=qt;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;c<3;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}n.lens[C[n.have++]]=7&u,u>>>=3,c-=3}for(;n.have<19;)n.lens[C[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,A={bits:n.lenbits},k=bt(0,n.lens,0,19,n.lencode,0,n.work,A),n.lenbits=A.bits,k){e.msg="invalid code lengths set",n.mode=qt;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;w=(E=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,Z=65535&E,!((m=E>>>24)<=c);){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}if(Z<16)u>>>=m,c-=m,n.lens[n.have++]=Z;else{if(16===Z){for(x=m+2;c<x;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}if(u>>>=m,c-=m,0===n.have){e.msg="invalid bit length repeat",n.mode=qt;break}y=n.lens[n.have-1],d=3+(3&u),u>>>=2,c-=2}else if(17===Z){for(x=m+3;c<x;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}c-=m,y=0,d=3+(7&(u>>>=m)),u>>>=3,c-=3}else{for(x=m+7;c<x;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}c-=m,y=0,d=11+(127&(u>>>=m)),u>>>=7,c-=7}if(n.have+d>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=qt;break}for(;d--;)n.lens[n.have++]=y}}if(n.mode===qt)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=qt;break}if(n.lenbits=9,A={bits:n.lenbits},k=bt(1,n.lens,0,n.nlen,n.lencode,0,n.work,A),n.lenbits=A.bits,k){e.msg="invalid literal/lengths set",n.mode=qt;break}if(n.distbits=6,n.distcode=n.distdyn,A={bits:n.distbits},k=bt(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,A),n.distbits=A.bits,k){e.msg="invalid distances set",n.mode=qt;break}if(n.mode=Wt,t===At)break e;case Wt:n.mode=Qt;case Qt:if(o>=6&&l>=258){e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,n.hold=u,n.bits=c,pt(e,f),s=e.next_out,i=e.output,l=e.avail_out,a=e.next_in,r=e.input,o=e.avail_in,u=n.hold,c=n.bits,n.mode===Dt&&(n.back=-1);break}for(n.back=0;w=(E=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,Z=65535&E,!((m=E>>>24)<=c);){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}if(w&&0===(240&w)){for(_=m,g=w,b=Z;w=(E=n.lencode[b+((u&(1<<_+g)-1)>>_)])>>>16&255,Z=65535&E,!(_+(m=E>>>24)<=c);){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}u>>>=_,c-=_,n.back+=_}if(u>>>=m,c-=m,n.back+=m,n.length=Z,0===w){n.mode=16205;break}if(32&w){n.back=-1,n.mode=Dt;break}if(64&w){e.msg="invalid literal/length code",n.mode=qt;break}n.extra=15&w,n.mode=16201;case 16201:if(n.extra){for(x=n.extra;c<x;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,c-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;w=(E=n.distcode[u&(1<<n.distbits)-1])>>>16&255,Z=65535&E,!((m=E>>>24)<=c);){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}if(0===(240&w)){for(_=m,g=w,b=Z;w=(E=n.distcode[b+((u&(1<<_+g)-1)>>_)])>>>16&255,Z=65535&E,!(_+(m=E>>>24)<=c);){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}u>>>=_,c-=_,n.back+=_}if(u>>>=m,c-=m,n.back+=m,64&w){e.msg="invalid distance code",n.mode=qt;break}n.offset=Z,n.extra=15&w,n.mode=16203;case 16203:if(n.extra){for(x=n.extra;c<x;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,c-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=qt;break}n.mode=16204;case 16204:if(0===l)break e;if(d=f-l,n.offset>d){if((d=n.offset-d)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=qt;break}d>n.wnext?(d-=n.wnext,v=n.wsize-d):v=n.wnext-d,d>n.length&&(d=n.length),p=n.window}else p=i,v=s-n.offset,d=n.length;d>l&&(d=l),l-=d,n.length-=d;do{i[s++]=p[v++]}while(--d);0===n.length&&(n.mode=Qt);break;case 16205:if(0===l)break e;i[s++]=n.length,l--,n.mode=Qt;break;case jt:if(n.wrap){for(;c<32;){if(0===o)break e;o--,u|=r[a++]<<c,c+=8}if(f-=l,e.total_out+=f,n.total+=f,4&n.wrap&&f&&(e.adler=n.check=n.flags?T(n.check,i,f,s-f):q(n.check,i,f,s-f)),f=l,4&n.wrap&&(n.flags?u:Ut(u))!==n.check){e.msg="incorrect data check",n.mode=qt;break}u=0,c=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;c<32;){if(0===o)break e;o--,u+=r[a++]<<c,c+=8}if(4&n.wrap&&u!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=qt;break}u=0,c=0}n.mode=16208;case 16208:k=Et;break e;case qt:k=It;break e;case 16210:return Bt;default:return Ct}return e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,n.hold=u,n.bits=c,(n.wsize||f!==e.avail_out&&n.mode<qt&&(n.mode<jt||t!==yt))&&Kt(e,e.output,e.next_out,f-e.avail_out),h-=e.avail_in,f-=e.avail_out,e.total_in+=h,e.total_out+=f,n.total+=f,4&n.wrap&&f&&(e.adler=n.check=n.flags?T(n.check,i,f,e.next_out-f):q(n.check,i,f,e.next_out-f)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Dt?128:0)+(n.mode===Wt||n.mode===Ot?256:0),(0===h&&0===f||t===yt)&&k===xt&&(k=Rt),k},inflateEnd:function(e){if(Lt(e))return Ct;var t=e.state;return t.window&&(t.window=null),e.state=null,xt},inflateGetHeader:function(e,t){if(Lt(e))return Ct;var n=e.state;return 0===(2&n.wrap)?Ct:(n.head=t,t.done=!1,xt)},inflateSetDictionary:function(e,t){var n,r=t.length;return Lt(e)||0!==(n=e.state).wrap&&n.mode!==Nt?Ct:n.mode===Nt&&q(1,t,r,0)!==n.check?It:Kt(e,t,r,r)?(n.mode=16210,Bt):(n.havedict=1,xt)},inflateInfo:"pako inflate (from Nodeca project)"};var tn=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},nn=Object.prototype.toString,rn=G.Z_NO_FLUSH,an=G.Z_FINISH,sn=G.Z_OK,on=G.Z_STREAM_END,ln=G.Z_NEED_DICT,un=G.Z_STREAM_ERROR,cn=G.Z_DATA_ERROR,hn=G.Z_MEM_ERROR;function fn(e){this.options=Ye.assign({chunkSize:65536,windowBits:15,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new et,this.strm.avail_out=0;var n=en.inflateInit2(this.strm,t.windowBits);if(n!==sn)throw new Error(P[n]);if(this.header=new tn,en.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"===typeof t.dictionary?t.dictionary=Ke.string2buf(t.dictionary):"[object ArrayBuffer]"===nn.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=en.inflateSetDictionary(this.strm,t.dictionary))!==sn))throw new Error(P[n])}function dn(e,t){var n=new fn(t);if(n.push(e),n.err)throw n.msg||P[n.err];return n.result}fn.prototype.push=function(e,t){var n,r,i,a=this.strm,s=this.options.chunkSize,o=this.options.dictionary;if(this.ended)return!1;for(r=t===~~t?t:!0===t?an:rn,"[object ArrayBuffer]"===nn.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(s),a.next_out=0,a.avail_out=s),(n=en.inflate(a,r))===ln&&o&&((n=en.inflateSetDictionary(a,o))===sn?n=en.inflate(a,r):n===cn&&(n=ln));a.avail_in>0&&n===on&&a.state.wrap>0&&0!==e[a.next_in];)en.inflateReset(a),n=en.inflate(a,r);switch(n){case un:case cn:case ln:case hn:return this.onEnd(n),this.ended=!0,!1}if(i=a.avail_out,a.next_out&&(0===a.avail_out||n===on))if("string"===this.options.to){var l=Ke.utf8border(a.output,a.next_out),u=a.next_out-l,c=Ke.buf2string(a.output,l);a.next_out=u,a.avail_out=s-u,u&&a.output.set(a.output.subarray(l,l+u),0),this.onData(c)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(n!==sn||0!==i){if(n===on)return n=en.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},fn.prototype.onData=function(e){this.chunks.push(e)},fn.prototype.onEnd=function(e){e===sn&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ye.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var vn={Inflate:fn,inflate:dn,inflateRaw:function(e,t){return(t=t||{}).raw=!0,dn(e,t)},ungzip:dn,constants:G},pn=dt.gzip,mn=vn.Inflate,wn=vn.inflate,Zn=vn.ungzip,_n=pn,gn=mn,bn=wn,yn=Zn},5941:function(e,t,n){n.d(t,{NC:function(){return i},Yd:function(){return s},pJ:function(){return a},xW:function(){return o}});var r=n(8782);function i(e,t){r.RE((function(n){return n.FS.writeFile(e,t)}))}function a(e){return r.RE((function(t){return t.FS.readFile(e,{encoding:"binary"})}))}function s(e){r.RE((function(t){return t.FS.unlink(e)}))}function o(e){return r.RE((function(t){return t.FS.analyzePath(e).exists}))}},489:function(e,t,n){n.d(t,{NC:function(){return i},Yd:function(){return s},pJ:function(){return a},xW:function(){return o}});var r=n(5941);function i(e,t){r.NC(e,t)}function a(e){return r.pJ(e)}function s(e){o(e)&&r.Yd(e)}function o(e){return r.xW(e)}},6126:function(e,t,n){n.d(t,{Fv:function(){return F},ll:function(){return D},pT:function(){return N}});var r=n(2415),i=n(7326),a=n(136),s=n(9388),o=n(3324),l=n(5671),u=n(3144),c=n(8652),h=n(2346),f=n(3889),d=n(8916),v=n(2793),p=n(7762),m=n(6635),w=n(8782),Z=n(6774);function _(e,t){if(t.length>0){var n=t.reduce((function(e,t){return e*t}));if(e.length!=n)throw new Error("length of 'x' must be equal to the product of 'shape'")}else if(e instanceof Array||ArrayBuffer.isView(e)){if(1!=e.length)throw new Error("length of 'x' should be 1 for a scalar dataset")}else e=[e];return e}function g(e,t){return null===t?"string"==typeof e||"number"==typeof e?(e=[e],t=[]):t=[e.length]:e=_(e,t),{x:e,shape:t}}function b(e){if(Array.isArray(e)){var t,n=(0,p.Z)(e);try{for(n.s();!(t=n.n()).done;){if("string"===typeof t.value)throw new Error("'x' should not contain any strings for a non-string HDF5 dataset")}}catch(r){n.e(r)}finally{n.f()}}}function y(e){var t=0;return e.array().forEach((function(e){t<e&&(t=e)})),t}var k=new WeakMap,A=new WeakMap,x=new WeakMap,E=new WeakSet,S=function(){function e(t,n){(0,l.Z)(this,e),(0,c.Z)(this,E),(0,h.Z)(this,k,{writable:!0,value:void 0}),(0,h.Z)(this,A,{writable:!0,value:void 0}),(0,h.Z)(this,x,{writable:!0,value:void 0}),(0,v.Z)(this,k,t),(0,v.Z)(this,A,n)}return(0,u.Z)(e,[{key:"file",get:function(){return(0,d.Z)(this,k)}},{key:"name",get:function(){return(0,d.Z)(this,A)}},{key:"attributes",get:function(){return(0,d.Z)(this,x)}},{key:"set_attributes",value:function(e){(0,v.Z)(this,x,e)}},{key:"readAttribute",value:function(e){var t,n,r=this,i=w.RE((function(t){return new t.LoadedH5Attr(r.file,r.name,e)}));try{n=Array.from(i.shape());var a=i.type();if("other"==a)throw new Error("cannot load dataset for an unsupported type");t="String"==a?Z.b(i.values(),i.lengths()):i.values().slice()}finally{i.delete()}return{values:t,shape:n}}},{key:"writeAttribute",value:function(e,t,n,r){var i=this,a=(arguments.length>4&&void 0!==arguments[4]?arguments[4]:{}).maxStringLength,s=void 0===a?null:a;if(null===r)throw new Error("cannot write 'null' to HDF5");var l=g(r,n);if(r=l.x,n=l.shape,"String"==t){var u=Z.C(r),c=(0,o.Z)(u,2),h=c[0],d=c[1];try{null==s&&(s=y(h)),(0,f.Z)(this,E,C).call(this,e,t,n,{maxStringLength:s}),w.RE((function(t){return t.write_string_hdf5_attribute(i.file,i.name,e,h.length,h.offset,d.offset)}))}finally{m.gd(d),m.gd(h)}}else{b(r);var v=m.de(r,null);try{(0,f.Z)(this,E,C).call(this,e,t,n),w.RE((function(t){return t.write_numeric_hdf5_attribute(i.file,i.name,e,v.constructor.className,v.offset)}))}finally{v.free()}}}}]),e}();function C(e,t,n){var r=this,i=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).maxStringLength,a=void 0===i?10:i,s=m.de(n,"Int32WasmArray");try{w.RE((function(n){return n.create_hdf5_attribute(r.file,r.name,e,t,s.length,s.offset,a)})),(0,d.Z)(this,x).push(e)}finally{s.free()}}var I=new WeakMap,B=new WeakMap,R=new WeakSet,F=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,r){var a,s=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).newlyCreated,o=void 0!==s&&s;if((0,l.Z)(this,n),a=t.call(this,e,r),(0,c.Z)((0,i.Z)(a),R),(0,h.Z)((0,i.Z)(a),I,{writable:!0,value:void 0}),(0,h.Z)((0,i.Z)(a),B,{writable:!0,value:void 0}),o)(0,v.Z)((0,i.Z)(a),I,{}),a.set_attributes([]);else{var u=w.RE((function(t){return new t.H5GroupDetails(e,r)}));try{var f=Z.b(u.child_buffer(),u.child_lengths()),p=u.child_types(),m=["Group","DataSet","Other"];(0,v.Z)((0,i.Z)(a),I,{});for(var _=0;_<f.length;_++)(0,d.Z)((0,i.Z)(a),I)[f[_]]=m[p[_]];var g=Z.b(u.attr_buffer(),u.attr_lengths());a.set_attributes(g)}finally{u.delete()}}return a}return(0,u.Z)(n,[{key:"children",get:function(){return(0,d.Z)(this,I)}},{key:"open",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(0,f.Z)(this,R,z).call(this,e);if(e in(0,d.Z)(this,I)){if("Group"==(0,d.Z)(this,I)[e])return new n(this.file,r,t);if("DataSet"==(0,d.Z)(this,I)[e])return new j(this.file,r,t);throw new Error("don't know how to open '"+e+"'")}throw new Error("no '"+e+"' child in this HDF5 Group")}},{key:"createGroup",value:function(e){var t=this,r=(0,f.Z)(this,R,z).call(this,e);if(e in this.children){if("Group"==this.children[e])return new n(this.file,r);throw new Error("existing child '"+r+"' is not a HDF5 group")}return w.RE((function(e){return e.create_hdf5_group(t.file,r)})),this.children[e]="Group",new n(this.file,r,{newlyCreated:!0})}},{key:"createDataSet",value:function(e,t,n){var r,i,a=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=s.maxStringLength,l=void 0===o?10:o,u=s.compression,c=void 0===u?6:u,h=s.chunks,d=void 0===h?null:h,v=(0,f.Z)(this,R,z).call(this,e);try{var p=(r=m.de(n,"Int32WasmArray")).offset;if(null!==d){if((i=m.de(d,"Int32WasmArray")).length!=r.length)throw new Error("'chunks' and 'shape' should have the same dimensions");p=i.offset}w.RE((function(e){return e.create_hdf5_dataset(a.file,v,t,r.length,r.offset,l,c,p)}))}finally{r.free()}return this.children[e]="DataSet",new j(this.file,v,{newlyCreated:!0,type:t,shape:n})}},{key:"writeDataSet",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=i.compression,s=void 0===a?6:a,l=i.chunks,u=void 0===l?null:l,c=i.cache,h=void 0!==c&&c;if(null===r)throw new Error("cannot write 'null' to HDF5");var f,d=g(r,n);if(r=d.x,n=d.shape,"String"==t){var v=Z.C(r),p=(0,o.Z)(v,2),_=p[0],b=p[1];try{var k=y(_);f=this.createDataSet(e,"String",n,{maxStringLength:k,compression:s,chunks:u}),w.RE((function(e){return e.write_string_hdf5_dataset(f.file,f.name,_.length,_.offset,b.offset)}))}finally{m.gd(_),m.gd(b)}f.cache_loaded(r,h)}else(f=this.createDataSet(e,t,n,{compression:s,chunks:u})).write(r,{cache:h});return f}}]),n}(S);function z(e){var t=this.name;return"/"!=t&&(t+="/"),t+=e}var N=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,l.Z)(this,n),t.call(this,e,"/",r)}return(0,u.Z)(n)}(F);function D(e){return w.RE((function(t){return t.create_hdf5_file(e)})),new N(e,{newlyCreated:!0})}var M=new WeakMap,O=new WeakMap,W=new WeakMap,Q=new WeakMap,j=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,a){var s,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=o.load,c=void 0!==u&&u,f=o.newlyCreated,d=void 0!==f&&f,p=o.shape,m=void 0===p?null:p,_=o.type,g=void 0===_?null:_,b=o.values,y=void 0===b?null:b;if((0,l.Z)(this,n),s=t.call(this,e,a),(0,h.Z)((0,i.Z)(s),M,{writable:!0,value:void 0}),(0,h.Z)((0,i.Z)(s),O,{writable:!0,value:void 0}),(0,h.Z)((0,i.Z)(s),W,{writable:!0,value:void 0}),(0,h.Z)((0,i.Z)(s),Q,{writable:!0,value:void 0}),d){if(null===m||null===g)throw new Error("need to pass 'shape' and 'type' if 'newlyCreated = true'");(0,v.Z)((0,i.Z)(s),M,m),(0,v.Z)((0,i.Z)(s),O,g),(0,v.Z)((0,i.Z)(s),W,y),(0,v.Z)((0,i.Z)(s),Q,null!==y),s.set_attributes([])}else{if(c){var k=(0,r.Z)(n,n,q).call(n,e,a);(0,v.Z)((0,i.Z)(s),O,k.type),(0,v.Z)((0,i.Z)(s),M,k.shape),(0,v.Z)((0,i.Z)(s),W,k.values),s.set_attributes(k.attributes)}else{var A=w.RE((function(t){return new t.H5DataSetDetails(e,a)}));try{(0,v.Z)((0,i.Z)(s),O,A.type()),(0,v.Z)((0,i.Z)(s),M,Array.from(A.shape())),(0,v.Z)((0,i.Z)(s),W,null),s.set_attributes(Z.b(A.attr_buffer(),A.attr_lengths()))}finally{A.delete()}}(0,v.Z)((0,i.Z)(s),Q,c)}return s}return(0,u.Z)(n,[{key:"type",get:function(){return(0,d.Z)(this,O)}},{key:"shape",get:function(){return(0,d.Z)(this,M)}},{key:"loaded",get:function(){return(0,d.Z)(this,Q)}},{key:"values",get:function(){return(0,d.Z)(this,W)}},{key:"load",value:function(){if(!(0,d.Z)(this,Q)){var e=(0,r.Z)(n,n,q).call(n,this.file,this.name);(0,v.Z)(this,W,e.values),(0,v.Z)(this,Q,!0)}return(0,d.Z)(this,W)}},{key:"cache_loaded",value:function(e,t){t?((0,v.Z)(this,W,e.slice()),(0,v.Z)(this,Q,!0)):((0,v.Z)(this,Q,!1),(0,v.Z)(this,W,null))}},{key:"write",value:function(e){var t=this,n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).cache,r=void 0!==n&&n;if(null===e)throw new Error("cannot write 'null' to HDF5");if(e=_(e,this.shape),"String"==this.type){var i=Z.C(e),a=(0,o.Z)(i,2),s=a[0],l=a[1];try{w.RE((function(e){return e.write_string_hdf5_dataset(t.file,t.name,s.length,s.offset,l.offset)}))}finally{m.gd(l),m.gd(s)}this.cache_loaded(e,r)}else{b(e);var u=m.de(e,null);try{w.RE((function(e){return e.write_numeric_hdf5_dataset(t.file,t.name,u.constructor.className,u.offset)})),this.cache_loaded(u,r)}finally{u.free()}}}}]),n}(S);function q(e,t){var n,r,i,a,s=w.RE((function(n){return new n.LoadedH5DataSet(e,t)}));try{if("other"==(r=s.type()))throw new Error("cannot load dataset for an unsupported type");n="String"==r?Z.b(s.values(),s.lengths()):s.values().slice(),i=Array.from(s.shape()),a=Z.b(s.attr_buffer(),s.attr_lengths())}finally{s.delete()}return{values:n,type:r,shape:i,attributes:a}}},5831:function(e,t,n){n.d(t,{$H:function(){return Q.$},BA:function(){return s.BA},Bp:function(){return a.Bp},Bs:function(){return D.B},Cb:function(){return y.C},D4:function(){return h.D4},D6:function(){return s.D6},DS:function(){return h.DS},EF:function(){return a.EF},F5:function(){return R.F},Fu:function(){return S.Fu},Fv:function(){return l.Fv},I9:function(){return O.X},II:function(){return s.II},J4:function(){return w.J4},KV:function(){return d.KV},Lw:function(){return Z.Lw},N6:function(){return a.N6},Os:function(){return N.Os},Qj:function(){return N.Qj},RJ:function(){return i.RJ},SV:function(){return s.SV},St:function(){return N.St},TS:function(){return i.TS},Tk:function(){return I.Tk},VU:function(){return W.V},Wf:function(){return i.Wf},XU:function(){return g.XU},Y8:function(){return x.Y},Yd:function(){return o.Yd},Yh:function(){return f.Y},ZI:function(){return C.ZI},ZW:function(){return v.ZW},_3:function(){return a._3},_u:function(){return Q._},aG:function(){return E.dO},bD:function(){return C.bD},b_:function(){return b.b},eu:function(){return B.eu},f:function(){return u.f},fw:function(){return h.fw},gd:function(){return i.gd},gk:function(){return k.g},gn:function(){return c.g},j2:function(){return r.j2},j4:function(){return h.j4},jX:function(){return F.j},ll:function(){return l.ll},nO:function(){return _.nO},p$:function(){return s.p$},pG:function(){return N.pG},pJ:function(){return o.pJ},pT:function(){return l.pT},qu:function(){return s.qu},rY:function(){return A.rY},tY:function(){return N.tY},us:function(){return a.us},uv:function(){return O.u},v_:function(){return k.v},vc:function(){return v.vc},vy:function(){return m.dH},wf:function(){return S.wf},wj:function(){return p.wj},xw:function(){return M.x},y5:function(){return z.y5}});var r=n(8782),i=n(6635),a=n(8311),s=n(6663),o=n(489),l=n(6126),u=n(118),c=n(2284),h=n(5644),f=n(4292),d=n(5470),v=n(1196),p=(n(5219),n(5448)),m=n(9206),w=n(2945),Z=n(7339),_=n(6757),g=n(4609),b=n(8420),y=(n(845),n(9283),n(6974)),k=n(1184),A=n(4812),x=n(6199),E=n(5159),S=n(7067),C=n(9273),I=n(4181),B=(n(5319),n(2494)),R=n(5696),F=n(2732),z=n(9249),N=n(3779),D=n(7039),M=n(5538),O=n(7644),W=(n(2306),n(4021)),Q=n(4755)},4755:function(e,t,n){n.d(t,{$:function(){return s},_:function(){return a}});var r=n(489),i=n(3102);function a(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).extension,t=void 0===e?"":e;return i.E("temp_",t)}function s(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).extension,n=void 0===t?"":t;if("string"==typeof e)return i.z(e);var s=a({extension:n});return r.NC(s,e),{path:s,flush:function(){return r.Yd(s)}}}},7644:function(e,t,n){n.d(t,{X:function(){return a},u:function(){return s}});var r=n(7762),i=n(5538);n(6635);function a(e,t,n){var a,s=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).numberOfThreads,o=void 0===s?null:s,l=(0,r.Z)(e);try{for(l.s();!(a=l.n()).done;){var u=a.value;if(u>=n)throw new Error("'markers' contains out-of-range indices ("+String(u)+")")}}catch(g){l.e(g)}finally{l.f()}for(var c=new Set(e),h=t.length,f=new Int32Array(h),d=new Int32Array(h),v=0;v<h;v++){var p,m=t[v],w=0,Z=(0,r.Z)(m);try{for(Z.s();!(p=Z.n()).done;){var _=p.value;if(_>=n)throw new Error("feature set "+String(v)+" contains out-of-range indices ("+String(_)+")");c.has(_)&&w++}}catch(g){Z.e(g)}finally{Z.f()}f[v]=w,d[v]=m.length}return{count:f,size:d,pvalue:(0,i.x)(f,c.size,d,n,{numberOfThreads:o})}}function s(e,t,n){for(var i=new Map,a=0;a<e.length;a++)null!==e[a]&&i.set(e[a],a);var s=[],o=new Map;for(a=0;a<t.length;a++){var l=t[a];if(null!==l){var u=i.get(l);"number"===typeof u&&(o.set(a,s.length),s.push(u))}}var c,h=[],f=(0,r.Z)(n);try{for(f.s();!(c=f.n()).done;){var d,v=c.value,p=[],m=(0,r.Z)(v);try{for(m.s();!(d=m.n()).done;){var w=d.value,Z=o.get(w);"number"===typeof Z&&p.push(Z)}}catch(_){m.e(_)}finally{m.f()}h.push(new Int32Array(p))}}catch(_){f.e(_)}finally{f.f()}return{target_indices:new Int32Array(s),reference_indices:new Int32Array(o.keys()),sets:h}}},118:function(e,t,n){n.d(t,{f:function(){return a}});var r=n(6126),i=n(8782);function a(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=a.format,o=void 0===s?null:s,l=a.forceInteger,u=void 0!==l&&l;null==o&&(o="automatic"),o=i.RE((function(r){return r.write_sparse_matrix_to_hdf5(e.matrix,t,n,o,u)}));var c=new r.Fv(t,n),h=[e.numberOfRows(),e.numberOfColumns()];if("tenx_matrix"==o)c.writeDataSet("shape","Int32",null,h);else if("csr_matrix"==o)c.writeAttribute("encoding-type","String",null,"csr_matrix"),c.writeAttribute("shape","Int32",null,h.reverse());else{if("csc_matrix"!=o)throw new Error("unknown format '"+o+"'");c.writeAttribute("encoding-type","String",null,"csc_matrix"),c.writeAttribute("shape","Int32",null,h.reverse())}}}}]);
//# sourceMappingURL=776.06e8cffa.chunk.js.map